<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-zh="用户管理" data-en="User Management">用户管理</title>
    <link rel="stylesheet" href="assets/css/common.css">
    <link rel="stylesheet" href="assets/css/navbar.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <img src="logo.png" alt="Logo" class="nav-logo">
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link" data-zh="仪表盘" data-en="Dashboard">仪表盘</a>
                <a href="pricing-templates.html" class="nav-link" data-zh="电价模版" data-en="Pricing Templates">电价模版</a>
                <a href="space-management.html" class="nav-link" data-zh="空间管理" data-en="Space Management">空间管理</a>
                <a href="device-management.html" class="nav-link" data-zh="设备管理" data-en="Device Management">设备管理</a>
                <a href="user-management.html" class="nav-link active" data-zh="用户管理" data-en="User Management">用户管理</a>
                <a href="bills.html" class="nav-link" data-zh="账单管理" data-en="Bill Management">账单管理</a>
            </div>
            <div class="nav-actions">
                <div class="lang-dropdown">
                    <select id="language-select" class="form-select lang-select">
                        <option value="zh" data-zh="中文" data-en="Chinese">中文</option>
                        <option value="en" data-zh="English" data-en="English">English</option>
                    </select>
                </div>
                <div class="user-menu">
                    <div class="user-avatar">管</div>
                    <span data-zh="管理员" data-en="Admin">管理员</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <div class="content-layout">
            <div class="main-container">

                <!-- 搜索和操作区域 -->
                <div class="search-section">
                    <div class="search-controls">
                        <input type="text" id="user-search" class="form-input" placeholder="租户姓名/电话/房号..." data-zh-placeholder="租户姓名/电话/房号..." data-en-placeholder="Name/Phone/Room...">
                        <select id="user-status-filter" class="form-select">
                            <option value="all" data-zh="全部状态" data-en="All Status">全部状态</option>
                            <option value="active" data-zh="入驻中" data-en="Checked In">入驻中</option>
                            <option value="inactive" data-zh="已退租" data-en="Checked Out">已退租</option>
                            <option value="pending" data-zh="未入驻" data-en="Not Checked In">未入驻</option>
                        </select>
                    </div>
                    <div class="search-actions">
                        <button class="btn btn-primary" onclick="searchUsers()">
                            <span data-zh="查询" data-en="Search">查询</span>
                        </button>
                        <button class="btn btn-secondary" onclick="resetFilters()">
                            <span data-zh="重置" data-en="Reset">重置</span>
                        </button>
                    </div>
                </div>

                <!-- 用户列表表格 -->
                <div class="table-container">
                    <div class="table-header">
                        <button class="btn btn-success" onclick="showAddModal()">
                            <span data-zh="+ 添加租户" data-en="+ Add Tenant">+ 添加租户</span>
                        </button>
                    </div>
                    <table class="table" id="users-table">
                        <thead>
                            <tr>
                                <th data-sortable data-zh="姓名" data-en="Name">姓名</th>
                                <th data-sortable data-zh="房间" data-en="Room">房间</th>
                                <th data-sortable data-zh="入驻时间（开始读数）" data-en="Check-in Time (Start Reading)">入驻时间（开始读数）</th>
                                <th data-sortable data-zh="退租时间（结束读数）" data-en="Check-out Time (End Reading)">退租时间（结束读数）</th>
                                <th data-sortable data-zh="状态" data-en="Status">状态</th>
                                <th data-zh="操作" data-en="Actions">操作</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <!-- 数据由JavaScript生成 -->
                        </tbody>
                    </table>

                    <!-- 分页 -->
                    <div class="pagination">
                        <button class="btn btn-secondary" id="prev-page" disabled>
                            <span>‹</span>
                            <span data-zh="上一页" data-en="Previous">上一页</span>
                        </button>
                        <div class="page-info">
                            <span data-zh="第" data-en="Page">第</span>
                            <span id="current-page">1</span>
                            <span data-zh="页，共" data-en="of">页，共</span>
                            <span id="total-pages">3</span>
                            <span data-zh="页" data-en="pages">页</span>
                        </div>
                        <button class="btn btn-secondary" id="next-page">
                            <span data-zh="下一页" data-en="Next">下一页</span>
                            <span>›</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 添加租户模态框 -->
    <div id="user-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title" data-zh="添加租户" data-en="Add Tenant">添加租户</h3>
                <button class="modal-close" onclick="hideModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="user-form" class="user-form">
                        <div class="form-row">
                            <div class="form-group">
                                <div style="display: flex; align-items: center;">
                                    <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                    <label for="tenant-name" data-zh="姓名" data-en="Name">姓名</label>
                                </div>
                                <input type="text" id="tenant-name" name="tenantName" class="form-input"
                                       data-zh-placeholder="张三" data-en-placeholder="John Doe" placeholder="张三" required>
                            </div>
                            <div class="form-group">
                                <div style="display: flex; align-items: center;">
                                    <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                    <label for="tenant-email" data-zh="邮箱" data-en="Email">邮箱</label>
                                </div>
                                <input type="email" id="tenant-email" name="tenantEmail" class="form-input"
                                       placeholder="tenant@example.com" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="tenant-phone" data-zh="联系电话" data-en="Phone">联系电话</label>
                                <input type="tel" id="tenant-phone" name="tenantPhone" class="form-input"
                                       data-zh-placeholder="+91 98765 43210" data-en-placeholder="+91 98765 43210" placeholder="+91 98765 43210" required>
                            </div>
                            <div class="form-group">
                                <label for="tenant-notes" data-zh="备注" data-en="Notes">备注</label>
                                <textarea id="tenant-notes" name="tenantNotes" class="form-textarea"
                                          rows="2" data-zh-placeholder="租户相关备注信息..." data-en-placeholder="Tenant related notes..." placeholder="租户相关备注信息..."></textarea>
                            </div>
                        </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideModal()" data-zh="取消" data-en="Cancel">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveUser()" data-zh="保存" data-en="Save">保存</button>
            </div>
        </div>
    </div>

    <!-- 入驻弹窗 -->
    <div id="checkin-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-zh="租户入驻" data-en="Tenant Check-in">租户入驻</h3>
                <button class="modal-close" onclick="hideCheckinModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="checkin-form" class="user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label data-zh="租户姓名" data-en="Tenant Name">租户姓名</label>
                            <div id="checkin-user-name" style="padding: 12px; background: #f5f5f5; border-radius: 6px; color: #666;">--</div>
                            <input type="hidden" id="checkin-user-id">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <div style="display: flex; align-items: center;">
                                <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                <label for="checkin-room" data-zh="选择房间" data-en="Select Room">选择房间</label>
                            </div>
                            <select id="checkin-room" name="room" class="form-input" required>
                                <option value="" data-zh="请选择房间" data-en="Please select room">请选择房间</option>
                                <option value="101">101室</option>
                                <option value="102">102室</option>
                                <option value="103">103室</option>
                                <option value="201">201室</option>
                                <option value="202">202室</option>
                                <option value="203">203室</option>
                                <option value="301">301室</option>
                                <option value="302">302室</option>
                                <option value="303">303室</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div style="display: flex; align-items: center;">
                                <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                <label for="checkin-date" data-zh="入驻时间" data-en="Check-in Date">入驻时间</label>
                            </div>
                            <input type="date" id="checkin-date" name="checkinDate" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <div style="display: flex; align-items: center;">
                                <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                <label for="electricity-reading" data-zh="电表读数" data-en="Electricity Reading">电表读数 (kWh)</label>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="electricity-reading" name="electricityReading" class="form-input"
                                       data-zh-placeholder="输入当前电表读数" data-en-placeholder="Enter current electricity reading" placeholder="输入当前电表读数" step="0.01" min="0" required style="flex: 1;">
                                <button type="button" class="btn btn-secondary" onclick="readCurrentMeter()" style="flex-shrink: 0;" data-zh="读取" data-en="Read">读取</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideCheckinModal()" data-zh="取消" data-en="Cancel">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveCheckin()" data-zh="确认入驻" data-en="Confirm Check-in">确认入驻</button>
            </div>
        </div>
    </div>

    <!-- 退租弹窗 -->
    <div id="checkout-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-zh="租户退租" data-en="Tenant Check-out">租户退租</h3>
                <button class="modal-close" onclick="hideCheckoutModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="checkout-form" class="user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label data-zh="租户姓名" data-en="Tenant Name">租户姓名</label>
                            <div id="checkout-user-name" style="padding: 12px; background: #f5f5f5; border-radius: 6px; color: #666;">--</div>
                            <input type="hidden" id="checkout-user-id">
                        </div>
                        <div class="form-group">
                            <label data-zh="当前房间" data-en="Current Room">当前房间</label>
                            <div id="checkout-user-room" style="padding: 12px; background: #f5f5f5; border-radius: 6px; color: #666;">--</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <div style="display: flex; align-items: center;">
                                <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                <label for="checkout-date" data-zh="退租时间" data-en="Check-out Date">退租时间</label>
                            </div>
                            <input type="date" id="checkout-date" name="checkoutDate" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <div style="display: flex; align-items: center;">
                                <span style="color: red; font-size: 14px; margin-right: 2px;">*</span>
                                <label for="checkout-electricity-reading" data-zh="电表读数" data-en="Electricity Reading">电表读数 (kWh)</label>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="checkout-electricity-reading" name="electricityReading" class="form-input"
                                       data-zh-placeholder="输入当前电表读数" data-en-placeholder="Enter current electricity reading" placeholder="输入当前电表读数" step="0.01" min="0" required style="flex: 1;">
                                <button type="button" class="btn btn-secondary" onclick="readCurrentMeterForCheckout()" style="flex-shrink: 0;" data-zh="读取" data-en="Read">读取</button>
                            </div>
                            <div style="margin-top: 6px; font-size: 12px; color: #999;">
                                <span data-zh="提示：退租后，请前往账单管理查看账单" data-en="Tip: After check-out, go to Bills Management to view bills">提示：退租后，请前往账单管理查看账单</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideCheckoutModal()" data-zh="取消" data-en="Cancel">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveCheckout()" data-zh="确认退租" data-en="Confirm Check-out">确认退租</button>
            </div>
        </div>
    </div>

    <!-- 删除确认弹窗 -->
    <div id="delete-confirm-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content delete-confirm-modal">
            <div class="modal-header">
                <h3 data-zh="确认删除" data-en="Confirm Delete">确认删除</h3>
                <button class="modal-close" onclick="hideDeleteConfirm()">&times;</button>
            </div>
            <div class="modal-body">
                <p><span data-zh="确定要删除租户" data-en="Are you sure you want to delete tenant">确定要删除租户</span> "<span id="delete-user-name">--</span>"<span data-zh="吗？" data-en="?">吗？</span></p>
                <p class="delete-warning" data-zh="此操作不可撤销。" data-en="This action cannot be undone.">此操作不可撤销。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideDeleteConfirm()" data-zh="取消" data-en="Cancel">取消</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()" data-zh="删除" data-en="Delete">删除</button>
            </div>
        </div>
    </div>

    <script src="assets/js/navbar.js"></script>
    <script src="assets/js/common.js"></script>
    <script>
        // 租户数据
        // 获取当前语言
        function getCurrentLanguage() {
            return document.getElementById('language-select')?.value || 'zh';
        }

        // 强制翻译所有静态文本
        function forceTranslateStaticText() {
            const currentLang = getCurrentLanguage();
            console.log('强制翻译静态文本，当前语言:', currentLang);

            // 翻译所有带有data-zh和data-en属性的元素
            document.querySelectorAll('[data-zh][data-en]').forEach(element => {
                const zhText = element.getAttribute('data-zh');
                const enText = element.getAttribute('data-en');
                if (zhText && enText) {
                    element.textContent = currentLang === 'en' ? enText : zhText;
                }
            });

            // 翻译占位符
            document.querySelectorAll('[data-zh-placeholder][data-en-placeholder]').forEach(element => {
                const zhPlaceholder = element.getAttribute('data-zh-placeholder');
                const enPlaceholder = element.getAttribute('data-en-placeholder');
                if (zhPlaceholder && enPlaceholder) {
                    element.placeholder = currentLang === 'en' ? enPlaceholder : zhPlaceholder;
                }
            });

            console.log('静态文本翻译完成');
        }

        const usersData = [
            {
                id: 'TNT001',
                name: '张明华',
                nameEn: 'Zhang Minghua',
                phone: '+91 98765 43210',
                email: 'zhang@example.com',
                room: 'A-101',
                building: 'A',
                floor: 1,
                type: 'residential',
                status: 'active',
                checkinDate: '2024-01-15',
                electricityReading: 1250.5,
                moveInDate: '2024-01-15',
                leaseEndDate: '2025-01-14',
                rent: 15000,
                deposit: 30000
            },
            {
                id: 'TNT002',
                name: '李小红',
                nameEn: 'Li Xiaohong',
                phone: '+91 87654 32109',
                email: 'li@example.com',
                room: 'B-205',
                building: 'B',
                floor: 2,
                type: 'commercial',
                status: 'inactive',
                checkinDate: '2024-03-01',
                electricityReading: 890.2,
                checkoutDate: '2024-12-15',
                finalElectricityReading: 2145.8,
                moveInDate: '2024-03-01',
                leaseEndDate: '2025-02-28',
                rent: 25000,
                deposit: 50000
            },
            {
                id: 'TNT003',
                name: '王建国',
                nameEn: 'Wang Jianguo',
                phone: '+91 76543 21098',
                email: 'wang@example.com',
                room: 'C-302',
                building: 'C',
                floor: 3,
                type: 'office',
                status: 'active',
                checkinDate: '2024-05-10',
                electricityReading: 675.3,
                moveInDate: '2024-05-10',
                leaseEndDate: '2025-05-09',
                rent: 20000,
                deposit: 40000
            },
            {
                id: 'TNT004',
                name: '陈美丽',
                nameEn: 'Chen Meili',
                phone: '+91 65432 10987',
                email: 'chen@example.com',
                building: 'A',
                floor: 2,
                type: 'residential',
                status: 'pending',
                notes: '待入驻'
            }
        ];

        function renderUsersTable() {
            console.log('开始渲染用户表格, 用户数据数量:', usersData.length);
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '';

            const currentLang = getCurrentLanguage();
            console.log('当前语言:', currentLang);

            usersData.forEach(user => {
                const row = document.createElement('tr');

                const statusClass = user.status === 'active' ? 'status-online' :
                                   user.status === 'inactive' ? 'status-offline' : 'status-pending';

                const statusText = user.status === 'active'
                    ? (currentLang === 'zh' ? '入驻中' : 'Checked In')
                    : user.status === 'inactive'
                    ? (currentLang === 'zh' ? '已退租' : 'Checked Out')
                    : (currentLang === 'zh' ? '未入驻' : 'Not Checked In');

                // 格式化入驻时间和开始读数
                const checkinInfo = user.checkinDate && user.electricityReading
                    ? `${user.checkinDate}<br><small style="color: #666;">${currentLang === 'zh' ? '开始' : 'Start'}: ${user.electricityReading}</small>`
                    : user.checkinDate || '--';

                // 格式化退租时间和结束读数
                const checkoutInfo = user.checkoutDate && user.finalElectricityReading
                    ? `${user.checkoutDate}<br><small style="color: #666;">${currentLang === 'zh' ? '结束' : 'End'}: ${user.finalElectricityReading}</small>`
                    : user.checkoutDate || '--';

                // Use appropriate name based on language
                const displayName = currentLang === 'zh' ? user.name : (user.nameEn || user.name);

                row.innerHTML = `
                    <td>${displayName}</td>
                    <td>${user.room || '--'}</td>
                    <td>${checkinInfo}</td>
                    <td>${checkoutInfo}</td>
                    <td><span class="device-status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editUser('${user.id}')">${currentLang === 'zh' ? '编辑' : 'Edit'}</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')" data-user-id="${user.id}">${currentLang === 'zh' ? '删除' : 'Delete'}</button>
                        ${user.status === 'active'
                            ? `<button class="btn btn-sm btn-warning" onclick="moveOutUser('${user.id}')">${currentLang === 'zh' ? '退租' : 'Check-out'}</button>`
                            : `<button class="btn btn-sm btn-success" onclick="moveInUser('${user.id}')">${currentLang === 'zh' ? '入驻' : 'Check-in'}</button>`
                        }
                    </td>
                `;

                tbody.appendChild(row);
            });
            console.log('用户表格渲染完成');
        }

        // Translation helper function
        function getTranslation(zh, en) {
            const currentLang = getCurrentLanguage();
            return currentLang === 'en' ? en : zh;
        }

        // Update placeholders based on current language
        function updatePlaceholders() {
            const currentLang = getCurrentLanguage();
            const elements = document.querySelectorAll('[data-zh-placeholder]');

            elements.forEach(element => {
                const zhPlaceholder = element.getAttribute('data-zh-placeholder');
                const enPlaceholder = element.getAttribute('data-en-placeholder');
                element.placeholder = currentLang === 'en' ? enPlaceholder : zhPlaceholder;
            });
        }

        window.searchUsers = function() {
            alert(getTranslation('搜索功能', 'Search function'));
        }

        window.resetFilters = function() {
            alert(getTranslation('重置功能', 'Reset function'));
        }


        window.showAddModal = function() {
            // 重置编辑模式
            isEditMode = false;
            editingUserId = null;

            // 重置表单和UI
            document.getElementById('modal-title').textContent = '添加租户';
            document.getElementById('user-form').reset();

            // 重置邮箱字段状态
            const emailField = document.getElementById('tenant-email');
            emailField.readOnly = false;
            emailField.disabled = false;
            emailField.style.backgroundColor = '';
            emailField.style.color = '';
            emailField.style.cursor = '';

            // 显示弹窗
            document.getElementById('user-modal').style.display = 'flex';
            document.body.classList.add('modal-open');
        }

        window.hideModal = function() {
            document.getElementById('user-modal').style.display = 'none';
            document.body.classList.remove('modal-open');

            // 重置编辑模式
            isEditMode = false;
            editingUserId = null;

            // 重置邮箱字段状态
            const emailField = document.getElementById('tenant-email');
            emailField.readOnly = false;
            emailField.disabled = false;
            emailField.style.backgroundColor = '';
            emailField.style.color = '';
            emailField.style.cursor = '';
        }

        window.saveUser = function() {
            const formData = new FormData(document.getElementById('user-form'));

            // 获取表单数据
            const userData = {
                name: formData.get('tenantName').trim(),
                phone: formData.get('tenantPhone').trim(),
                email: formData.get('tenantEmail').trim(),
                notes: formData.get('tenantNotes').trim()
            };

            // 验证必填字段
            if (!userData.name || !userData.email) {
                alert(getTranslation('请填写所有必填字段', 'Please fill in all required fields'));
                return;
            }

            try {
                if (isEditMode && editingUserId) {
                    // 编辑模式：更新现有用户
                    const userIndex = usersData.findIndex(u => u.id === editingUserId);
                    if (userIndex > -1) {
                        // 保留原有数据，只更新允许编辑的字段
                        usersData[userIndex].name = userData.name;
                        usersData[userIndex].phone = userData.phone;
                        usersData[userIndex].notes = userData.notes;
                        // 邮箱不允许编辑，保持原值

                        // 重新渲染表格
                        renderUsersTable();
                        // 关闭模态框
                        hideModal();

                        // 显示成功消息
                        console.log('租户信息更新成功！');
                    }
                } else {
                    // 添加模式：创建新用户
                    const newUser = {
                        id: 'TNT' + String(Math.floor(Math.random() * 900) + 100),
                        name: userData.name,
                        phone: userData.phone,
                        email: userData.email,
                        type: 'residential',
                        notes: userData.notes,
                        status: 'inactive'
                    };

                    // 添加到租户列表
                    usersData.push(newUser);
                    // 重新渲染表格
                    renderUsersTable();
                    // 关闭模态框
                    hideModal();

                    // 显示成功消息
                    if (typeof EnergySystem !== 'undefined') {
                        EnergySystem.showNotification('租户添加成功！', 'success');
                    } else {
                        alert(getTranslation('租户添加成功！', 'Tenant added successfully!'));
                    }

                    // 标记用户流程为完成
                    let workflowProgress = JSON.parse(localStorage.getItem('workflowProgress') || '{}');
                    workflowProgress.user = true;
                    localStorage.setItem('workflowProgress', JSON.stringify(workflowProgress));
                }
            } catch (error) {
                console.error('保存租户时出错:', error);
                alert(getTranslation('保存失败，请重试', 'Save failed, please try again'));
            }
        }

        window.editUser = function(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                // 设置为编辑模式
                isEditMode = true;
                editingUserId = userId;

                // 更新弹窗标题
                document.getElementById('modal-title').textContent = '编辑租户';

                // 填充表单数据 - 根据当前语言显示名字
                const currentLang = document.getElementById('language-select')?.value || 'zh';
                const displayName = currentLang === 'zh' ? user.name : (user.nameEn || user.name);
                document.getElementById('tenant-name').value = displayName || '';
                document.getElementById('tenant-email').value = user.email || '';
                document.getElementById('tenant-phone').value = user.phone || '';
                document.getElementById('tenant-notes').value = user.notes || '';

                // 设置邮箱为只读
                const emailField = document.getElementById('tenant-email');
                emailField.readOnly = true;
                emailField.disabled = false; // 保持可显示但不可编辑
                emailField.style.backgroundColor = '#f5f5f5';
                emailField.style.color = '#666';
                emailField.style.cursor = 'not-allowed';

                // 显示弹窗
                document.getElementById('user-modal').style.display = 'flex';
                document.body.classList.add('modal-open');
            }
        }

        // 编辑和删除功能相关变量
        let isEditMode = false;
        let editingUserId = null;
        let deleteUserId = null;

        // Make sure deleteUser is globally accessible
        window.deleteUser = function(userId) {
            console.log('deleteUser called with userId:', userId);
            const user = usersData.find(u => u.id === userId);
            if (!user) {
                console.log('User not found for ID:', userId);
                return;
            }

            deleteUserId = userId;
            // 使用适当的语言显示名字
            const currentLang = document.getElementById('language-select')?.value || 'zh';
            const displayName = currentLang === 'zh' ? user.name : (user.nameEn || user.name);

            // 等待DOM准备好，然后查找元素
            setTimeout(function() {
                // 尝试多种方式查找元素
                let deleteNameElement = document.getElementById('delete-user-name');
                let deleteModalElement = document.getElementById('delete-confirm-modal');

                // 如果找不到，尝试通过querySelector查找
                if (!deleteNameElement) {
                    deleteNameElement = document.querySelector('#delete-user-name');
                }
                if (!deleteModalElement) {
                    deleteModalElement = document.querySelector('#delete-confirm-modal');
                }

                console.log('Delete name element:', deleteNameElement);
                console.log('Delete modal element:', deleteModalElement);

                // 如果还是找不到，尝试在所有模态框中查找
                if (!deleteNameElement) {
                    const allSpans = document.querySelectorAll('span');
                    console.log('All spans on page:', allSpans);
                    for (let span of allSpans) {
                        if (span.id === 'delete-user-name') {
                            deleteNameElement = span;
                            break;
                        }
                    }
                }

                if (!deleteNameElement) {
                    console.error('Cannot find delete-user-name element anywhere!');
                    // 尝试创建并插入元素
                    const modalBody = document.querySelector('#delete-confirm-modal .modal-body p');
                    if (modalBody) {
                        console.log('Found modal body, trying to update text directly');
                        modalBody.innerHTML = `确定要删除租户 "<span id="delete-user-name">${displayName}</span>" 吗？`;
                        deleteNameElement = document.getElementById('delete-user-name');
                    }
                }

                if (!deleteModalElement) {
                    console.error('Cannot find delete-confirm-modal element!');
                    alert('删除确认窗口找不到，请刷新页面后重试');
                    return;
                }

                // 如果找到了元素，进行操作
                if (deleteNameElement) {
                    deleteNameElement.textContent = displayName;
                } else {
                    console.error('Still cannot find delete-user-name element after all attempts');
                }

                deleteModalElement.style.display = 'flex';
                document.body.classList.add('modal-open');
                console.log('Modal should be visible now');
            }, 50); // 增加延迟
        }

        window.moveInUser = function(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                // 填充入驻表单 - 使用适当的语言显示名字
                const currentLang = document.getElementById('language-select')?.value || 'zh';
                const displayName = currentLang === 'zh' ? user.name : (user.nameEn || user.name);
                document.getElementById('checkin-user-name').textContent = displayName;
                document.getElementById('checkin-user-id').value = userId;

                // 设置默认入驻日期为今天
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('checkin-date').value = today;

                // 显示入驻弹窗
                document.getElementById('checkin-modal').style.display = 'flex';
                document.body.classList.add('modal-open');
            }
        }

        window.moveOutUser = function(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                // 填充退租表单 - 使用适当的语言显示名字
                const currentLang = document.getElementById('language-select')?.value || 'zh';
                const displayName = currentLang === 'zh' ? user.name : (user.nameEn || user.name);
                document.getElementById('checkout-user-name').textContent = displayName;
                document.getElementById('checkout-user-room').textContent = user.room || getTranslation('未分配', 'Unassigned');
                document.getElementById('checkout-user-id').value = userId;

                // 设置默认退租日期为今天
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('checkout-date').value = today;

                // 显示退租弹窗
                document.getElementById('checkout-modal').style.display = 'flex';
                document.body.classList.add('modal-open');
            }
        }

        // 入驻弹窗函数
        window.hideCheckinModal = function() {
            document.getElementById('checkin-modal').style.display = 'none';
            document.body.classList.remove('modal-open');
            // 清空表单
            document.getElementById('checkin-form').reset();
        }

        window.readCurrentMeter = function() {
            // 模拟读取当前电表读数
            const currentReading = (Math.random() * 1000 + 500).toFixed(2);
            document.getElementById('electricity-reading').value = currentReading;

            if (typeof EnergySystem !== 'undefined') {
                EnergySystem.showNotification(getTranslation(`已读取当前电表读数：${currentReading} kWh`, `Current electricity reading: ${currentReading} kWh`), 'success');
            } else {
                alert(getTranslation(`已读取当前电表读数：${currentReading} kWh`, `Current electricity reading: ${currentReading} kWh`));
            }
        }

        window.saveCheckin = function() {
            const formData = new FormData(document.getElementById('checkin-form'));
            const userId = document.getElementById('checkin-user-id').value;

            // 获取表单数据
            const checkinData = {
                room: formData.get('room').trim(),
                checkinDate: formData.get('checkinDate'),
                electricityReading: parseFloat(formData.get('electricityReading'))
            };

            // 验证必填字段
            if (!checkinData.room || !checkinData.checkinDate ||
                isNaN(checkinData.electricityReading)) {
                alert(getTranslation('请填写所有必填字段', 'Please fill in all required fields'));
                return;
            }

            // 验证读数值
            if (checkinData.electricityReading < 0) {
                alert(getTranslation('电表读数不能为负数', 'Electricity reading cannot be negative'));
                return;
            }

            try {
                // 更新租户状态
                const user = usersData.find(u => u.id === userId);
                if (user) {
                    user.status = 'active';
                    user.room = checkinData.room;
                    user.checkinDate = checkinData.checkinDate;
                    user.electricityReading = checkinData.electricityReading;

                    // 重新渲染表格
                    renderUsersTable();

                    // 关闭弹窗
                    hideCheckinModal();

                    // 显示成功消息
                    if (typeof EnergySystem !== 'undefined') {
                        EnergySystem.showNotification(getTranslation(`${user.name} 入驻成功！房间：${checkinData.room}`, `${user.name} checked in successfully! Room: ${checkinData.room}`), 'success');
                    } else {
                        alert(getTranslation(`${user.name} 入驻成功！房间：${checkinData.room}`, `${user.name} checked in successfully! Room: ${checkinData.room}`));
                    }
                }
            } catch (error) {
                console.error('入驻保存失败:', error);
                alert(getTranslation('入驻保存失败，请重试', 'Check-in save failed, please try again'));
            }
        }

        // 退租弹窗函数
        window.hideCheckoutModal = function() {
            document.getElementById('checkout-modal').style.display = 'none';
            document.body.classList.remove('modal-open');
            // 清空表单
            document.getElementById('checkout-form').reset();
        }

        window.readCurrentMeterForCheckout = function() {
            // 模拟读取当前电表读数
            const currentReading = (Math.random() * 1000 + 500).toFixed(2);
            document.getElementById('checkout-electricity-reading').value = currentReading;

            if (typeof EnergySystem !== 'undefined') {
                EnergySystem.showNotification(getTranslation(`已读取当前电表读数：${currentReading} kWh`, `Current electricity reading: ${currentReading} kWh`), 'success');
            } else {
                alert(getTranslation(`已读取当前电表读数：${currentReading} kWh`, `Current electricity reading: ${currentReading} kWh`));
            }
        }

        window.saveCheckout = function() {
            const formData = new FormData(document.getElementById('checkout-form'));
            const userId = document.getElementById('checkout-user-id').value;

            // 获取表单数据
            const checkoutData = {
                checkoutDate: formData.get('checkoutDate'),
                electricityReading: parseFloat(formData.get('electricityReading'))
            };

            // 验证必填字段
            if (!checkoutData.checkoutDate || isNaN(checkoutData.electricityReading)) {
                alert(getTranslation('请填写所有必填字段', 'Please fill in all required fields'));
                return;
            }

            // 验证读数值
            if (checkoutData.electricityReading < 0) {
                alert(getTranslation('电表读数不能为负数', 'Electricity reading cannot be negative'));
                return;
            }

            try {
                // 更新租户状态
                const user = usersData.find(u => u.id === userId);
                if (user) {
                    user.status = 'inactive';
                    user.checkoutDate = checkoutData.checkoutDate;
                    user.finalElectricityReading = checkoutData.electricityReading;
                    // 清除房间信息
                    user.room = null;

                    // 重新渲染表格
                    renderUsersTable();

                    // 关闭弹窗
                    hideCheckoutModal();

                    // 显示成功消息
                    const displayName = (document.getElementById('language-select')?.value || 'zh') === 'zh' ? user.name : (user.nameEn || user.name);
                    if (typeof EnergySystem !== 'undefined') {
                        EnergySystem.showNotification(getTranslation(`${displayName} 退租成功！`, `${displayName} checked out successfully!`), 'success');
                    } else {
                        alert(getTranslation(`${displayName} 退租成功！`, `${displayName} checked out successfully!`));
                    }
                }
            } catch (error) {
                console.error('退租保存失败:', error);
                alert(getTranslation('退租保存失败，请重试', 'Check-out save failed, please try again'));
            }
        }

        window.hideDeleteConfirm = function() {
            document.getElementById('delete-confirm-modal').style.display = 'none';
            document.body.classList.remove('modal-open');
            deleteUserId = null;
        }

        window.confirmDelete = function() {
            if (deleteUserId) {
                const index = usersData.findIndex(u => u.id === deleteUserId);
                if (index > -1) {
                    const user = usersData[index];
                    const currentLang = document.getElementById('language-select')?.value || 'zh';
                    const displayName = currentLang === 'zh' ? user.name : (user.nameEn || user.name);

                    usersData.splice(index, 1);
                    renderUsersTable();
                    hideDeleteConfirm();

                    if (typeof EnergySystem !== 'undefined') {
                        EnergySystem.showNotification(getTranslation(`${displayName} 删除成功！`, `${displayName} deleted successfully!`), 'success');
                    } else {
                        alert(getTranslation(`${displayName} 删除成功！`, `${displayName} deleted successfully!`));
                    }
                }
            }
        }

        // 点击模态框外部关闭
        document.addEventListener('click', function(event) {
            const userModal = document.getElementById('user-modal');

            if (event.target === userModal || event.target === userModal.querySelector('.modal-overlay')) {
                hideModal();
            }

            const checkinModal = document.getElementById('checkin-modal');
            if (event.target === checkinModal || event.target === checkinModal.querySelector('.modal-overlay')) {
                hideCheckinModal();
            }

            const checkoutModal = document.getElementById('checkout-modal');
            if (event.target === checkoutModal || event.target === checkoutModal.querySelector('.modal-overlay')) {
                hideCheckoutModal();
            }

            const deleteModal = document.getElementById('delete-confirm-modal');
            if (event.target === deleteModal || event.target === deleteModal.querySelector('.modal-overlay')) {
                hideDeleteConfirm();
            }
        });

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            console.log('用户管理页面加载开始');

            // 立即应用当前语言
            setTimeout(forceTranslateStaticText, 10);

            // 直接初始化页面
            function waitForNavManager() {
                console.log('开始初始化页面');
                initPage();
            }

            function initPage() {
                // 页面初始化完成
                console.log('User management page loaded successfully');

                // 初始化语言系统
                if (typeof EnergySystem !== 'undefined' && typeof EnergySystem.initLanguageSystem === 'function') {
                    EnergySystem.initLanguageSystem();
                } else if (typeof initLanguageSystem === 'function') {
                    initLanguageSystem();
                }

                // 等待DOM完全加载后再翻译
                setTimeout(function() {
                    // 强制翻译静态文本
                    forceTranslateStaticText();

                    // 渲染表格
                    renderUsersTable();
                }, 50);
                updatePlaceholders(); // 初始化时更新占位符
                console.log('用户管理页面初始化完成');

                // 监听语言切换事件，重新渲染表格
                window.addEventListener('languageChanged', function(event) {
                    console.log('用户管理页面收到语言切换事件:', event.detail.language);
                    setTimeout(function() {
                        console.log('重新渲染用户表格...');
                        renderUsersTable(); // 重新渲染表格以应用新语言
                        updatePlaceholders(); // 更新占位符文本
                    }, 100); // 延迟执行确保语言切换完成
                });

                // 直接监听语言选择器变化
                const languageSelect = document.getElementById('language-select');
                if (languageSelect) {
                    console.log('为语言选择器添加监听器');
                    languageSelect.addEventListener('change', function(e) {
                        console.log('*** 语言选择器变化 ***，新语言:', e.target.value);

                        // 强制翻译静态文本
                        forceTranslateStaticText();

                        // 触发语言系统更新静态翻译
                        if (typeof EnergySystem !== 'undefined' && typeof EnergySystem.applyLanguage === 'function') {
                            EnergySystem.applyLanguage(e.target.value);
                        } else if (typeof applyLanguage === 'function') {
                            applyLanguage(e.target.value);
                        }

                        // 立即渲染动态内容
                        renderUsersTable();
                        updatePlaceholders();

                        // 延迟再次渲染确保更新完成
                        setTimeout(function() {
                            forceTranslateStaticText();
                            renderUsersTable();
                            updatePlaceholders();
                        }, 100);
                        setTimeout(function() {
                            forceTranslateStaticText();
                            renderUsersTable();
                            updatePlaceholders();
                        }, 500);
                    });

                    // 也监听click事件
                    languageSelect.addEventListener('click', function() {
                        console.log('语言选择器被点击');
                        setTimeout(function() {
                            renderUsersTable();
                            updatePlaceholders();
                        }, 100);
                    });
                }

                // 每2秒强制检查并重新渲染一次
                setInterval(function() {
                    const select = document.getElementById('language-select');
                    if (select) {
                        console.log('定时检查，当前语言选择器值:', select.value);
                        renderUsersTable();
                        updatePlaceholders();
                    }
                }, 2000);
            }

            // 开始等待
            waitForNavManager();
        });
    </script>

    <script>
        // 添加用户管理页面特有样式 - 与bills.html保持一致
        const style = document.createElement('style');
        style.textContent = `
            /* 导航栏样式 - 覆盖common.css */
            .navbar {
                height: 56px !important;
                overflow: hidden !important;
                background: rgba(255, 255, 255, 0.8) !important;
                backdrop-filter: blur(20px) !important;
                border-bottom: var(--border) !important;
                position: sticky !important;
                top: 0 !important;
                z-index: 1000 !important;
            }

            .nav-content {
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
                padding: 12px 20px !important;
                gap: 15px !important;
                height: 100% !important;
                max-width: none !important;
                margin: 0 !important;
            }

            .nav-brand {
                display: flex !important;
                align-items: center !important;
                flex-shrink: 0 !important;
            }

            .nav-menu {
                flex: 1 !important;
                display: flex !important;
                justify-content: center !important;
                gap: 20px !important;
            }

            .nav-actions {
                display: flex !important;
                align-items: center !important;
                gap: 15px !important;
            }

            .nav-logo {
                height: 32px !important;
                max-width: 150px !important;
                object-fit: contain !important;
                transition: all 0.2s ease !important;
            }

            .nav-logo:hover {
                transform: scale(1.02) !important;
            }

            /* 布局系统 */
            .content-layout {
                display: flex;
                max-width: 1600px;
                margin: 0 auto;
                padding: var(--space-12) var(--space-8);
                gap: var(--space-6);
            }

            .main-container {
                flex: 1;
                min-width: 0;
                padding-top: 0;
            }

            /* 搜索区域样式 */
            .search-section {
                background: var(--background);
                border: var(--border);
                border-radius: var(--radius);
                padding: var(--space-6);
                margin-bottom: var(--space-6);
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: var(--space-4);
            }

            .search-controls {
                display: flex;
                gap: var(--space-4);
                flex: 1;
            }

            .search-controls .form-input {
                min-width: 300px;
            }

            .search-actions {
                display: flex;
                gap: var(--space-3);
            }

            /* 表单样式 - 从设备管理页面复制 */
            .form-input,
            .form-select,
            .form-textarea {
                padding: 12px 16px !important;
                border: 1px solid #F0F0F0 !important;
                border-radius: 8px !important;
                background: #FFFFFF !important;
                color: #000000 !important;
                font-size: 14px !important;
                transition: all 0.2s ease !important;
                outline: none !important;
                font-family: inherit !important;
                width: 100% !important;
                display: block !important;
            }

            .form-input:focus,
            .form-select:focus,
            .form-textarea:focus {
                border-color: #0066CC !important;
                box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1) !important;
                background: #FFFFFF !important;
            }

            .form-input:hover,
            .form-select:hover {
                border-color: #666666 !important;
            }

            /* 表格头部样式 - 从设备管理页面复制 */
            .table-header {
                background: var(--background);
                border: var(--border);
                border-bottom: none;
                border-radius: var(--radius) var(--radius) 0 0;
                padding: var(--space-4) var(--space-6);
                display: flex;
                justify-content: flex-start;
                align-items: center;
                margin-bottom: 0;
            }

            .table-container {
                background: var(--background);
                border: var(--border);
                border-radius: var(--radius);
                overflow: hidden;
                margin-bottom: var(--space-6);
            }

            .table-container .table {
                border: none;
                margin: 0;
            }

            /* 按钮样式 - 从设备管理页面复制 */
            .btn {
                padding: var(--space-2) var(--space-4);
                border: none;
                border-radius: var(--radius);
                font-family: inherit;
                font-size: 14px;
                font-weight: var(--font-weight-medium);
                cursor: pointer;
                transition: all 0.15s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: var(--space-2);
            }

            .btn-primary {
                background: var(--primary);
                color: white;
            }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: var(--shadow-hover);
            }

            .btn-secondary {
                background: var(--surface);
                color: var(--text-primary);
                border: var(--border);
            }

            .btn-secondary:hover {
                background: var(--divider);
            }

            .btn-success {
                background: #000000 !important;
                color: white !important;
                border: 1px solid #000000 !important;
            }

            .btn-success:hover {
                background: #333333 !important;
                border-color: #333333 !important;
                transform: translateY(-1px) !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            }

            .btn-warning {
                background: #ff9500;
                color: white;
                border: 1px solid #ff9500;
            }

            .btn-warning:hover {
                background: #e6850e;
                border-color: #e6850e;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(255, 149, 0, 0.15);
            }

            .btn-sm {
                padding: 4px 8px;
                font-size: 12px;
            }


            /* 语言下拉列表样式 */
            .lang-dropdown {
                display: flex;
                align-items: center;
            }

            .lang-select {
                min-width: 100px;
                padding: var(--space-2) var(--space-3);
                border: var(--border);
                border-radius: var(--radius);
                background: var(--background);
                font-size: 14px;
                font-weight: var(--font-weight-medium);
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .lang-select:focus {
                outline: 2px solid var(--accent);
                outline-offset: -2px;
            }

            .lang-select:hover {
                background: var(--surface);
            }

            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: var(--space-4);
                padding: var(--space-6);
                background: var(--surface);
                border-top: var(--border);
            }

            .page-info {
                font-size: 14px;
                color: var(--text-secondary);
            }

            /* 用户状态样式 */
            .device-status {
                padding: var(--space-1) var(--space-2);
                border-radius: calc(var(--radius) / 2);
                font-size: 12px;
                font-weight: var(--font-weight-medium);
                display: inline-block;
                min-width: 48px;
                text-align: center;
            }

            .status-online {
                background: rgba(40, 167, 69, 0.1);
                color: var(--success);
            }

            .status-offline {
                background: rgba(255, 149, 0, 0.1);
                color: var(--warning);
            }

            .status-pending {
                background: rgba(108, 117, 125, 0.1);
                color: #6c757d;
            }

            .btn-danger {
                background: #dc2626;
                color: white;
                border: 1px solid #dc2626;
            }

            .btn-danger:hover {
                background: #b91c1c;
                border-color: #b91c1c;
            }

            .btn-success {
                background: #16a34a;
                color: white;
                border: 1px solid #16a34a;
            }

            .btn-success:hover {
                background: #15803d;
                border-color: #15803d;
            }

            /* 右抽屉模态框样式 - 与设备管理页面保持一致 */
            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(8px);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: flex-end;
                padding: 0;
                overflow: hidden;
            }

            .modal[style*="flex"] {
                display: flex !important;
            }

            /* 防止背景页面滚动 */
            body.modal-open {
                overflow: hidden;
            }

            /* 强制显示红色星号 */
            .required-asterisk {
                color: #ff0000 !important;
                font-weight: bold !important;
                margin-left: 3px !important;
                font-size: 14px !important;
                display: inline !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* 覆盖所有可能的样式 */
            label .required-asterisk,
            .form-group label .required-asterisk,
            .modal .required-asterisk,
            * .required-asterisk {
                color: #ff0000 !important;
                font-weight: bold !important;
                margin-left: 3px !important;
                font-size: 14px !important;
                display: inline !important;
                visibility: visible !important;
                opacity: 1 !important;
                text-decoration: none !important;
                background: none !important;
            }

            .modal-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.3);
                z-index: -1;
            }

            .modal-content {
                background: var(--background);
                border-radius: 0;
                box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
                width: 500px;
                height: 100vh;
                overflow: hidden;
                position: relative;
                z-index: 1;
                animation: drawerSlideIn 0.3s ease-out;
                display: flex;
                flex-direction: column;
            }

            @keyframes drawerSlideIn {
                from {
                    opacity: 0;
                    transform: translateX(100%);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            .modal-header {
                padding: 24px 32px;
                background: var(--background);
                color: var(--text-primary);
                border-radius: 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: var(--border);
                flex-shrink: 0;
            }

            .modal-header h3 {
                margin: 0;
                font-size: 20px;
                font-weight: 600;
                color: var(--text-primary);
            }

            .modal-close {
                background: none;
                border: none;
                color: var(--text-secondary);
                font-size: 24px;
                font-weight: bold;
                cursor: pointer;
                padding: 8px;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
            }

            .modal-close:hover {
                background: var(--surface);
                color: var(--text-primary);
                transform: scale(1.1);
            }

            .modal-body {
                padding: 32px;
                flex: 1;
                overflow-y: auto;
            }

            .modal-footer {
                padding: 20px 32px;
                background: var(--surface);
                border-top: var(--border);
                display: flex;
                justify-content: flex-end;
                gap: 12px;
                border-radius: 0;
                flex-shrink: 0;
            }

            /* 表单样式 */
            .user-form {
                display: flex;
                flex-direction: column;
                gap: 24px;
            }

            .form-section {
                background: var(--surface);
                border: var(--border);
                border-radius: var(--radius);
                padding: 24px;
                position: relative;
            }

            .section-title {
                margin: 0 0 20px 0;
                font-size: 16px;
                font-weight: 600;
                color: var(--text-primary);
                display: flex;
                align-items: center;
                gap: 8px;
                padding-bottom: 8px;
                border-bottom: 2px solid var(--primary);
            }

            .section-title::before {
                content: '';
                width: 4px;
                height: 16px;
                background: var(--primary);
                border-radius: 2px;
            }

            .form-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
                margin-bottom: 16px;
            }

            .form-row:last-child {
                margin-bottom: 0;
            }

            .form-group {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }

            .form-group.full-width {
                grid-column: 1 / -1;
            }

            .form-group label {
                font-size: 14px;
                font-weight: 500;
                color: var(--text-primary);
                display: flex;
                align-items: center;
                gap: 4px;
            }


            .form-input,
            .form-select,
            .form-textarea {
                padding: 12px 16px;
                border: 2px solid var(--border-color);
                border-radius: var(--radius);
                background: var(--background);
                color: var(--text-primary);
                font-size: 14px;
                transition: all 0.2s ease;
                outline: none;
                font-family: inherit;
            }

            .form-input:focus,
            .form-select:focus,
            .form-textarea:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
                background: var(--background);
            }

            .form-input:hover,
            .form-select:hover {
                border-color: var(--accent);
            }

            .form-textarea {
                resize: vertical;
                min-height: 80px;
                font-family: inherit;
                line-height: 1.5;
            }

            .form-input::placeholder,
            .form-textarea::placeholder {
                color: var(--text-secondary);
                opacity: 0.7;
            }

            .form-hint {
                font-size: 12px;
                color: var(--text-secondary);
                margin-top: 4px;
                font-style: italic;
            }

            .form-input[required]:invalid {
                border-color: var(--error);
            }

            .form-input[required]:invalid:focus {
                box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
            }

            /* 按钮样式 - 与bills.html保持一致 */
            .btn {
                padding: var(--space-2) var(--space-4);
                border: none;
                border-radius: var(--radius);
                font-family: inherit;
                font-size: 14px;
                font-weight: var(--font-weight-medium);
                cursor: pointer;
                transition: all 0.15s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: var(--space-2);
            }

            .btn-primary {
                background: var(--primary);
                color: white;
            }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: var(--shadow-hover);
            }

            .btn-secondary {
                background: var(--surface);
                color: var(--text-primary);
                border: var(--border);
            }

            .btn-secondary:hover {
                background: var(--divider);
            }

            .actions {
                display: flex;
                gap: var(--space-2);
            }


            /* 响应式设计 */
            @media (max-width: 1200px) {
                .content-layout {
                    flex-direction: column;
                }
            }

            @media (max-width: 768px) {
                .content-layout {
                    padding: var(--space-8) var(--space-4);
                }

                .search-section {
                    flex-direction: column;
                    align-items: stretch;
                }

                .search-controls {
                    flex-direction: column;
                }

                .search-controls .form-input {
                    min-width: auto;
                }

                .modal {
                    padding: 10px;
                }

                .modal-content {
                    margin-top: 20px;
                    max-height: calc(100vh - 20px);
                }

                .modal-header,
                .modal-body,
                .modal-footer {
                    padding: 20px;
                }

                .form-row {
                    grid-template-columns: 1fr;
                    gap: 16px;
                }

                .form-section {
                    padding: 16px;
                }

                .nav-menu {
                    gap: 10px !important;
                }
            }

            /* 删除确认模态框样式 - 与设备管理页面保持一致 */
            #delete-confirm-modal {
                justify-content: center !important;
                align-items: center !important;
            }

            .delete-confirm-modal {
                width: 400px !important;
                height: auto !important;
                max-width: 90vw;
                animation: modalSlideIn 0.3s ease-out !important;
                border-radius: var(--radius) !important;
            }

            .delete-warning {
                color: var(--text-secondary);
                font-size: 14px;
                margin-top: 8px;
            }

            /* 添加modalSlideIn动画 */
            @keyframes modalSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>