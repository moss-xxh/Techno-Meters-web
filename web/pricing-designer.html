<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-zh="Áîµ‰ª∑Ê®°ÁâàËÆæËÆ°Âô®" data-en="Pricing Template Designer">Áîµ‰ª∑Ê®°ÁâàËÆæËÆ°Âô®</title>
    <link rel="stylesheet" href="assets/css/common.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <img src="logo.png" alt="Logo" class="nav-logo">
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link" data-zh="‰ª™Ë°®Áõò" data-en="Dashboard">‰ª™Ë°®Áõò</a>
                <a href="pricing-templates.html" class="nav-link active" data-zh="Áîµ‰ª∑Ê®°Áâà" data-en="Pricing Templates">Áîµ‰ª∑Ê®°Áâà</a>
                <a href="space-management.html" class="nav-link" data-zh="Á©∫Èó¥ÁÆ°ÁêÜ" data-en="Space Management">Á©∫Èó¥ÁÆ°ÁêÜ</a>
                <a href="device-management.html" class="nav-link" data-zh="ËÆæÂ§áÁÆ°ÁêÜ" data-en="Device Management">ËÆæÂ§áÁÆ°ÁêÜ</a>
                <a href="user-management.html" class="nav-link" data-zh="Áî®Êà∑ÁÆ°ÁêÜ" data-en="User Management">Áî®Êà∑ÁÆ°ÁêÜ</a>
                <a href="bills.html" class="nav-link" data-zh="Ë¥¶ÂçïÁÆ°ÁêÜ" data-en="Bill Management">Ë¥¶ÂçïÁÆ°ÁêÜ</a>
            </div>
            <div class="nav-actions">
                <div class="lang-dropdown">
                    <select id="language-select" class="form-select lang-select">
                        <option value="zh" data-zh="‰∏≠Êñá" data-en="Chinese">‰∏≠Êñá</option>
                        <option value="en" data-zh="English" data-en="English">English</option>
                    </select>
                </div>
                <div class="user-menu">
                    <div class="user-avatar">ÁÆ°</div>
                    <span data-zh="ÁÆ°ÁêÜÂëò" data-en="Admin">ÁÆ°ÁêÜÂëò</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <main class="main-content">
        <!-- È°µÈù¢Ê†áÈ¢òÂíåËøîÂõûÊåâÈíÆ -->
        <div class="page-header">
            <div class="header-left">
                <button class="btn btn-secondary" onclick="goBackToPricingTemplates()">
                    <span>‚Üê</span>
                    <span data-zh="ËøîÂõû" data-en="Back">ËøîÂõû</span>
                </button>
            </div>
            <div class="header-center">
                <h1 id="page-title" data-zh="Áîµ‰ª∑Ê®°ÁâàËÆæËÆ°Âô®" data-en="Pricing Template Designer">Áîµ‰ª∑Ê®°ÁâàËÆæËÆ°Âô®</h1>
            </div>
            <div class="header-right"></div>
        </div>

        <div class="designer-layout">
            <!-- Â∑¶‰æßÊ≠•È™§ÂØºËà™ -->
            <div class="steps-sidebar">
                <div class="steps-header">
                    <h3 data-zh="Áîµ‰ª∑Ê®°ÁâàËÆæËÆ°" data-en="Pricing Template Design">Áîµ‰ª∑Ê®°ÁâàËÆæËÆ°</h3>
                    <p data-zh="ÈÅµÂæ™Âç∞Â∫¶ÁîµÂäõÁõëÁÆ°ÂßîÂëò‰ºöÊ†áÂáÜ" data-en="Following CERC Standards">ÈÅµÂæ™Âç∞Â∫¶ÁîµÂäõÁõëÁÆ°ÂßîÂëò‰ºöÊ†áÂáÜ</p>
                </div>

                <div class="steps-container">
                    <div class="step-item active" data-step="1" onclick="switchStep(1)">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title" data-zh="Âü∫Êú¨ÈÖçÁΩÆ" data-en="Basic Configuration">Âü∫Êú¨ÈÖçÁΩÆ</div>
                            <div class="step-desc" data-zh="Ê®°ÁâàÂêçÁß∞„ÄÅË¥¶ÂçïÂë®Êúü„ÄÅË¥¶ÂçïÊó•" data-en="Template Name, Billing Cycle, Billing Date">Ê®°ÁâàÂêçÁß∞„ÄÅË¥¶ÂçïÂë®Êúü„ÄÅË¥¶ÂçïÊó•</div>
                        </div>
                    </div>

                    <div class="step-item" data-step="2" onclick="switchStep(2)">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title" data-zh="Ë¥πÁéáÁªìÊûÑ" data-en="Rate Structure">Ë¥πÁéáÁªìÊûÑ</div>
                            <div class="step-desc" data-zh="ËÆ°Ë¥πÊñπÂºè„ÄÅÈò∂Ê¢ØÁîµ‰ª∑ÈÖçÁΩÆ" data-en="Billing Method, Tiered Rate Config">ËÆ°Ë¥πÊñπÂºè„ÄÅÈò∂Ê¢ØÁîµ‰ª∑ÈÖçÁΩÆ</div>
                        </div>
                    </div>

                    <div class="step-item" data-step="3" onclick="switchStep(3)">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title" data-zh="ÈôÑÂä†Ë¥πÁî®" data-en="Additional Charges">ÈôÑÂä†Ë¥πÁî®</div>
                            <div class="step-desc" data-zh="ÁáÉÊñôÈôÑÂä†Ë¥π„ÄÅÁîµÂäõÁ®éÁ≠â" data-en="Fuel Surcharge, Electricity Duty">ÁáÉÊñôÈôÑÂä†Ë¥π„ÄÅÁîµÂäõÁ®éÁ≠â</div>
                        </div>
                    </div>

                    <div class="step-item" data-step="4" onclick="switchStep(4)">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title" data-zh="Ë¥πÁéáÊ®°Êãü" data-en="Rate Simulation">Ë¥πÁéáÊ®°Êãü</div>
                            <div class="step-desc" data-zh="ÊµãËØï‰∏çÂêåÁî®ÁîµÈáèÁöÑËÆ°Ë¥π" data-en="Test Billing for Different Usage">ÊµãËØï‰∏çÂêåÁî®ÁîµÈáèÁöÑËÆ°Ë¥π</div>
                        </div>
                    </div>

                    <div class="step-item" data-step="5" onclick="switchStep(5)">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <div class="step-title" data-zh="È¢ÑËßàÂèëÂ∏É" data-en="Preview & Publish">È¢ÑËßàÂèëÂ∏É</div>
                            <div class="step-desc" data-zh="ÊúÄÁªàÁ°ÆËÆ§Âπ∂ÂèëÂ∏ÉÊ®°Áâà" data-en="Final Review and Publish">ÊúÄÁªàÁ°ÆËÆ§Âπ∂ÂèëÂ∏ÉÊ®°Áâà</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥‰æßÂÜÖÂÆπÂå∫Âüü -->
            <div class="content-area">
                <!-- Ê≠•È™§1: Ë¥¶ÂçïËÆæÁΩÆ -->
                <div id="step-1" class="step-content-panel active">
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="Ë¥¶ÂçïËÆæÁΩÆ" data-en="Billing Settings">Ë¥¶ÂçïËÆæÁΩÆ</h3>
                            <p data-zh="ÈÖçÁΩÆË¥¶ÂçïÁîüÊàêÂíåÁªìÁÆóËßÑÂàô" data-en="Configure billing generation and settlement rules">ÈÖçÁΩÆË¥¶ÂçïÁîüÊàêÂíåÁªìÁÆóËßÑÂàô</p>
                        </div>

                        <div class="settings-form">
                            <div class="form-group">
                                <label for="template-name" data-zh="ÂêçÁß∞" data-en="Name">ÂêçÁß∞</label>
                                <input type="text" id="template-name" name="templateName" class="form-input"
                                       placeholder="ËØ∑ËæìÂÖ•Áîµ‰ª∑Ê®°ÊùøÂêçÁß∞"
                                       data-zh-placeholder="ËØ∑ËæìÂÖ•Áîµ‰ª∑Ê®°ÊùøÂêçÁß∞"
                                       data-en-placeholder="Enter pricing template name">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="billing-period" data-zh="Ë¥¶Êúü" data-en="Billing Period">Ë¥¶Êúü</label>
                                    <select id="billing-period" name="billingPeriod" class="form-select">
                                        <option value="monthly" data-zh="‰∏ÄÊúà‰∏ÄÊ¨°" data-en="Monthly">‰∏ÄÊúà‰∏ÄÊ¨°</option>
                                        <option value="quarterly" data-zh="‰∏ÄÂ≠£Â∫¶‰∏ÄÊ¨°" data-en="Quarterly">‰∏ÄÂ≠£Â∫¶‰∏ÄÊ¨°</option>
                                        <option value="yearly" data-zh="‰∏ÄÂπ¥‰∏ÄÊ¨°" data-en="Yearly">‰∏ÄÂπ¥‰∏ÄÊ¨°</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="billing-date" data-zh="Ë¥¶ÂçïÊó•" data-en="Billing Date">Ë¥¶ÂçïÊó•</label>
                                    <select id="billing-date" name="billingDate" class="form-select">
                                        <option value="month-end" data-zh="ÊúàÊú´" data-en="Month End">ÊúàÊú´</option>
                                        <option value="current-month" data-zh="ÂΩìÊúà" data-en="Current Month">ÂΩìÊúà</option>
                                        <option value="next-month" data-zh="Ê¨°Êúà" data-en="Next Month">Ê¨°Êúà</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê≠•È™§ÂØºËà™ÊåâÈíÆ -->
                    <div class="step-navigation">
                        <div class="nav-left">
                            <button id="prev-btn-1" class="btn btn-secondary" onclick="previousStep()" style="display: none;">
                                <span data-zh="‰∏ä‰∏ÄÊ≠•" data-en="Previous">‰∏ä‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                        <div class="nav-right">
                            <button class="btn btn-outline" onclick="saveDraft()">
                                <span data-zh="‰øùÂ≠òËçâÁ®ø" data-en="Save Draft">‰øùÂ≠òËçâÁ®ø</span>
                            </button>
                            <button id="next-btn-1" class="btn btn-primary" onclick="nextStep()">
                                <span data-zh="‰∏ã‰∏ÄÊ≠•" data-en="Next">‰∏ã‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê≠•È™§2: Ë¥πÁéáÁªìÊûÑ -->
                <div id="step-2" class="step-content-panel">
                    <!-- ÁîµË¥πËÆæÁΩÆ -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="ÁîµË¥πËÆæÁΩÆ" data-en="Electricity Tariff">ÁîµË¥πËÆæÁΩÆ</h3>
                            <p data-zh="ÈÖçÁΩÆÁîµË¥πÂçï‰ª∑ÂíåËÆ°ÁÆóËßÑÂàô" data-en="Configure electricity rates and calculation rules">ÈÖçÁΩÆÁîµË¥πÂçï‰ª∑ÂíåËÆ°ÁÆóËßÑÂàô</p>
                        </div>

                        <div class="settings-form">
                            <div class="form-group full-width">
                                <label data-zh="ÁîµË¥πÁ±ªÂûã" data-en="Tariff Type">ÁîµË¥πÁ±ªÂûã</label>
                                <div class="tariff-type-cards">
                                    <div class="tariff-card" data-type="flat" onclick="selectTariffType('flat')">
                                        <div class="card-header">
                                            <div class="card-icon">üìè</div>
                                            <h4 data-zh="Âõ∫ÂÆöÂçï‰ª∑" data-en="Flat Rate">Âõ∫ÂÆöÂçï‰ª∑</h4>
                                        </div>
                                        <p class="card-description" data-zh="Áªü‰∏ÄÁîµ‰ª∑Ê†áÂáÜÔºåÁÆÄÂçïÊòé‰∫ÜÁöÑËÆ°Ë¥πÊñπÂºè" data-en="Unified rate standard, simple and clear billing method">Áªü‰∏ÄÁîµ‰ª∑Ê†áÂáÜÔºåÁÆÄÂçïÊòé‰∫ÜÁöÑËÆ°Ë¥πÊñπÂºè</p>
                                        <div class="card-features">
                                            <span class="feature-tag" data-zh="ÁÆÄÂçïÊòìÊáÇ" data-en="Simple">ÁÆÄÂçïÊòìÊáÇ</span>
                                            <span class="feature-tag" data-zh="Âõ∫ÂÆöË¥πÁéá" data-en="Fixed Rate">Âõ∫ÂÆöË¥πÁéá</span>
                                        </div>
                                    </div>
                                    <div class="tariff-card selected" data-type="tiered" onclick="selectTariffType('tiered')">
                                        <div class="card-header">
                                            <div class="card-icon">üìä</div>
                                            <h4 data-zh="Èò∂Ê¢ØÁîµ‰ª∑" data-en="Tiered Rate">Èò∂Ê¢ØÁîµ‰ª∑</h4>
                                        </div>
                                        <p class="card-description" data-zh="ÊåâÁî®ÁîµÈáèÂàÜÈò∂Ê¢ØÂÆö‰ª∑ÔºåÈºìÂä±ËäÇÁ∫¶Áî®Áîµ" data-en="Tiered pricing based on consumption, encouraging energy conservation">ÊåâÁî®ÁîµÈáèÂàÜÈò∂Ê¢ØÂÆö‰ª∑ÔºåÈºìÂä±ËäÇÁ∫¶Áî®Áîµ</p>
                                        <div class="card-features">
                                            <span class="feature-tag" data-zh="ËäÇËÉΩÊøÄÂä±" data-en="Energy Saving">ËäÇËÉΩÊøÄÂä±</span>
                                            <span class="feature-tag" data-zh="Èò∂Ê¢ØÈÄíÂ¢û" data-en="Progressive">Èò∂Ê¢ØÈÄíÂ¢û</span>
                                        </div>
                                    </div>
                                    <div class="tariff-card" data-type="time-of-use" onclick="selectTariffType('time-of-use')">
                                        <div class="card-header">
                                            <div class="card-icon">‚è∞</div>
                                            <h4 data-zh="ÂàÜÊó∂Áîµ‰ª∑" data-en="Time-of-Use">ÂàÜÊó∂Áîµ‰ª∑</h4>
                                        </div>
                                        <p class="card-description" data-zh="Ê†πÊçÆÁî®ÁîµÊó∂ÊÆµÂ∑ÆÂºÇÂåñÂÆö‰ª∑Ôºå‰ºòÂåñÁîµÁΩëË¥üËç∑" data-en="Differentiated pricing by time periods, optimizing grid load">Ê†πÊçÆÁî®ÁîµÊó∂ÊÆµÂ∑ÆÂºÇÂåñÂÆö‰ª∑Ôºå‰ºòÂåñÁîµÁΩëË¥üËç∑</p>
                                        <div class="card-features">
                                            <span class="feature-tag" data-zh="Â≥∞Ë∞∑Ë∞ÉËäÇ" data-en="Peak-Valley">Â≥∞Ë∞∑Ë∞ÉËäÇ</span>
                                            <span class="feature-tag" data-zh="Êó∂ÊÆµÂ∑Æ‰ª∑" data-en="Time-based">Êó∂ÊÆµÂ∑Æ‰ª∑</span>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="tariff-type" name="tariffType" value="tiered">
                            </div>

                            <!-- Èò∂Ê¢ØÁîµ‰ª∑ËÆæÁΩÆ -->
                            <div id="tiered-settings" class="tariff-settings">
                                <div class="settings-header">
                                    <h4 data-zh="Èò∂Ê¢ØÁîµ‰ª∑ËÆæÁΩÆ" data-en="Tiered Rate Settings">Èò∂Ê¢ØÁîµ‰ª∑ËÆæÁΩÆ</h4>
                                    <button type="button" class="btn btn-outline btn-sm" onclick="addTier()">
                                        <span data-zh="+ Êñ∞Â¢ûÈò∂Ê¢Ø" data-en="+ Add Tier">+ Êñ∞Â¢ûÈò∂Ê¢Ø</span>
                                    </button>
                                </div>

                                <div id="tiers-container">
                                    <div class="tier-item" data-tier="1">
                                        <div class="tier-header">
                                            <span class="tier-label" data-zh="Á¨¨‰∏ÄÈò∂Ê¢Ø" data-en="Tier 1">Á¨¨‰∏ÄÈò∂Ê¢Ø</span>
                                            <button type="button" class="btn-remove" onclick="removeTier(1)" style="display: none;">
                                                <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                            </button>
                                        </div>
                                        <div class="tier-config">
                                            <div class="tier-range">
                                                <label data-zh="Áî®ÁîµËåÉÂõ¥ (kWh)" data-en="Usage Range (kWh)">Áî®ÁîµËåÉÂõ¥ (kWh)</label>
                                                <div class="range-inputs">
                                                    <input type="number" class="form-input tier-min" value="0" min="0" readonly>
                                                    <span>-</span>
                                                    <input type="number" class="form-input tier-max" value="100" min="1" onchange="updateTierRanges()">
                                                </div>
                                            </div>
                                            <div class="tier-price">
                                                <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                                                <input type="number" class="form-input tier-rate" value="5.50" min="0" step="0.01">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tier-item" data-tier="2">
                                        <div class="tier-header">
                                            <span class="tier-label" data-zh="Á¨¨‰∫åÈò∂Ê¢Ø" data-en="Tier 2">Á¨¨‰∫åÈò∂Ê¢Ø</span>
                                            <button type="button" class="btn-remove" onclick="removeTier(2)">
                                                <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                            </button>
                                        </div>
                                        <div class="tier-config">
                                            <div class="tier-range">
                                                <label data-zh="Áî®ÁîµËåÉÂõ¥ (kWh)" data-en="Usage Range (kWh)">Áî®ÁîµËåÉÂõ¥ (kWh)</label>
                                                <div class="range-inputs">
                                                    <input type="number" class="form-input tier-min" value="101" min="0" readonly>
                                                    <span>-</span>
                                                    <input type="number" class="form-input tier-max" value="300" min="1" onchange="updateTierRanges()">
                                                </div>
                                            </div>
                                            <div class="tier-price">
                                                <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                                                <input type="number" class="form-input tier-rate" value="7.25" min="0" step="0.01">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tier-item" data-tier="3">
                                        <div class="tier-header">
                                            <span class="tier-label" data-zh="Á¨¨‰∏âÈò∂Ê¢Ø" data-en="Tier 3">Á¨¨‰∏âÈò∂Ê¢Ø</span>
                                            <button type="button" class="btn-remove" onclick="removeTier(3)">
                                                <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                            </button>
                                        </div>
                                        <div class="tier-config">
                                            <div class="tier-range">
                                                <label data-zh="Áî®ÁîµËåÉÂõ¥ (kWh)" data-en="Usage Range (kWh)">Áî®ÁîµËåÉÂõ¥ (kWh)</label>
                                                <div class="range-inputs">
                                                    <input type="number" class="form-input tier-min" value="301" min="0" readonly>
                                                    <span>-</span>
                                                    <input type="text" class="form-input tier-max" value="Êó†ÈôêÂà∂" data-zh="Êó†ÈôêÂà∂" data-en="Unlimited" readonly>
                                                </div>
                                            </div>
                                            <div class="tier-price">
                                                <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                                                <input type="number" class="form-input tier-rate" value="9.00" min="0" step="0.01">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ÂàÜÊó∂Áîµ‰ª∑ËÆæÁΩÆ -->
                            <div id="time-of-use-settings" class="tariff-settings" style="display: none;">
                                <div class="settings-header">
                                    <h4 data-zh="ÂàÜÊó∂Áîµ‰ª∑ËÆæÁΩÆ" data-en="Time-of-Use Rate Settings">ÂàÜÊó∂Áîµ‰ª∑ËÆæÁΩÆ</h4>
                                    <button type="button" class="btn btn-outline btn-sm" onclick="addTimePeriod()">
                                        <span data-zh="+ Êñ∞Â¢ûÊó∂ÊÆµ" data-en="+ Add Period">+ Êñ∞Â¢ûÊó∂ÊÆµ</span>
                                    </button>
                                </div>

                                <div id="time-periods-container">
                                    <div class="time-period-item" data-period="peak">
                                        <div class="period-header">
                                            <div class="period-icon-select">
                                                <select class="form-input period-icon-dropdown" onchange="updatePeriodIcon(this)">
                                                    <option value="üî¥" selected>üî¥</option>
                                                    <option value="üü°">üü°</option>
                                                    <option value="üü¢">üü¢</option>
                                                    <option value="üîµ">üîµ</option>
                                                    <option value="üü†">üü†</option>
                                                    <option value="üü£">üü£</option>
                                                </select>
                                            </div>
                                            <h5 contenteditable="true" class="editable-period-name" data-zh="È´òÂ≥∞Êó∂ÊÆµ" data-en="Peak Period">È´òÂ≥∞Êó∂ÊÆµ</h5>
                                            <button type="button" class="btn-remove-period" onclick="removeTimePeriod('peak')" style="display: none;">
                                                <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                            </button>
                                        </div>
                                        <div class="period-config">
                                            <div class="time-range">
                                                <label data-zh="Êó∂Èó¥ÊÆµ" data-en="Time Range">Êó∂Èó¥ÊÆµ</label>
                                                <div class="time-inputs">
                                                    <input type="time" class="form-input time-start" value="18:00">
                                                    <span>-</span>
                                                    <input type="time" class="form-input time-end" value="22:00">
                                                </div>
                                            </div>
                                            <div class="period-price">
                                                <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                                                <input type="number" class="form-input period-rate" value="9.50" min="0" step="0.01">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="time-period-item" data-period="standard">
                                        <div class="period-header">
                                            <div class="period-icon-select">
                                                <select class="form-input period-icon-dropdown" onchange="updatePeriodIcon(this)">
                                                    <option value="üî¥">üî¥</option>
                                                    <option value="üü°" selected>üü°</option>
                                                    <option value="üü¢">üü¢</option>
                                                    <option value="üîµ">üîµ</option>
                                                    <option value="üü†">üü†</option>
                                                    <option value="üü£">üü£</option>
                                                </select>
                                            </div>
                                            <h5 contenteditable="true" class="editable-period-name" data-zh="Âπ≥Â≥∞Êó∂ÊÆµ" data-en="Standard Period">Âπ≥Â≥∞Êó∂ÊÆµ</h5>
                                            <button type="button" class="btn-remove-period" onclick="removeTimePeriod('standard')">
                                                <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                            </button>
                                        </div>
                                        <div class="period-config">
                                            <div class="time-range">
                                                <label data-zh="Êó∂Èó¥ÊÆµ" data-en="Time Range">Êó∂Èó¥ÊÆµ</label>
                                                <div class="time-inputs">
                                                    <input type="time" class="form-input time-start" value="06:00">
                                                    <span>-</span>
                                                    <input type="time" class="form-input time-end" value="18:00">
                                                </div>
                                            </div>
                                            <div class="period-price">
                                                <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                                                <input type="number" class="form-input period-rate" value="7.00" min="0" step="0.01">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="time-period-item" data-period="valley">
                                        <div class="period-header">
                                            <div class="period-icon-select">
                                                <select class="form-input period-icon-dropdown" onchange="updatePeriodIcon(this)">
                                                    <option value="üî¥">üî¥</option>
                                                    <option value="üü°">üü°</option>
                                                    <option value="üü¢" selected>üü¢</option>
                                                    <option value="üîµ">üîµ</option>
                                                    <option value="üü†">üü†</option>
                                                    <option value="üü£">üü£</option>
                                                </select>
                                            </div>
                                            <h5 contenteditable="true" class="editable-period-name" data-zh="Ë∞∑ÂÄºÊó∂ÊÆµ" data-en="Valley Period">Ë∞∑ÂÄºÊó∂ÊÆµ</h5>
                                            <button type="button" class="btn-remove-period" onclick="removeTimePeriod('valley')">
                                                <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                            </button>
                                        </div>
                                        <div class="period-config">
                                            <div class="time-range">
                                                <label data-zh="Êó∂Èó¥ÊÆµ" data-en="Time Range">Êó∂Èó¥ÊÆµ</label>
                                                <div class="time-inputs">
                                                    <input type="time" class="form-input time-start" value="22:00">
                                                    <span>-</span>
                                                    <input type="time" class="form-input time-end" value="06:00">
                                                </div>
                                            </div>
                                            <div class="period-price">
                                                <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                                                <input type="number" class="form-input period-rate" value="4.50" min="0" step="0.01">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Âõ∫ÂÆöÁîµ‰ª∑ËÆæÁΩÆ -->
                            <div id="flat-settings" class="tariff-settings" style="display: none;">
                                <div class="settings-header">
                                    <h4 data-zh="Âõ∫ÂÆöÁîµ‰ª∑ËÆæÁΩÆ" data-en="Flat Rate Settings">Âõ∫ÂÆöÁîµ‰ª∑ËÆæÁΩÆ</h4>
                                </div>

                                <div class="flat-rate-config">
                                    <div class="form-group">
                                        <label data-zh="Áªü‰∏ÄÁîµ‰ª∑ (‚Çπ/kWh)" data-en="Flat Rate (‚Çπ/kWh)">Áªü‰∏ÄÁîµ‰ª∑ (‚Çπ/kWh)</label>
                                        <input type="number" class="form-input" id="flat-rate" value="6.50" min="0" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label data-zh="ÈÄÇÁî®ËØ¥Êòé" data-en="Description">ÈÄÇÁî®ËØ¥Êòé</label>
                                        <textarea class="form-input" rows="3" placeholder="ËØ∑ËæìÂÖ•Âõ∫ÂÆöÁîµ‰ª∑ÁöÑÈÄÇÁî®ËØ¥Êòé..." data-zh-placeholder="ËØ∑ËæìÂÖ•Âõ∫ÂÆöÁîµ‰ª∑ÁöÑÈÄÇÁî®ËØ¥Êòé..." data-en-placeholder="Enter description for flat rate application..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê≠•È™§ÂØºËà™ÊåâÈíÆ -->
                    <div class="step-navigation">
                        <div class="nav-left">
                            <button id="prev-btn-2" class="btn btn-secondary" onclick="previousStep()">
                                <span data-zh="‰∏ä‰∏ÄÊ≠•" data-en="Previous">‰∏ä‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                        <div class="nav-right">
                            <button class="btn btn-outline" onclick="saveDraft()">
                                <span data-zh="‰øùÂ≠òËçâÁ®ø" data-en="Save Draft">‰øùÂ≠òËçâÁ®ø</span>
                            </button>
                            <button id="next-btn-2" class="btn btn-primary" onclick="nextStep()">
                                <span data-zh="‰∏ã‰∏ÄÊ≠•" data-en="Next">‰∏ã‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê≠•È™§3: ÈôÑÂä†Ë¥πÁî® -->
                <div id="step-3" class="step-content-panel">
                    <!-- ÈôÑÂä†Ë¥πÁî®ËÆæÁΩÆ -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="ÈôÑÂä†Ë¥πÁî®" data-en="Additional Charges">ÈôÑÂä†Ë¥πÁî®</h3>
                            <p data-zh="ÈÖçÁΩÆÂêÑÈ°πÁ®éË¥πÂíåÈôÑÂä†Ë¥πÁî®" data-en="Configure taxes and additional charges">ÈÖçÁΩÆÂêÑÈ°πÁ®éË¥πÂíåÈôÑÂä†Ë¥πÁî®</p>
                        </div>

                        <div class="settings-form">
                            <div class="additional-charges-header">
                                <h4 data-zh="Ë¥πÁî®È°πÁõÆ" data-en="Charge Items">Ë¥πÁî®È°πÁõÆ</h4>
                                <button type="button" class="btn btn-outline btn-sm" onclick="addAdditionalCharge()">
                                    <span data-zh="+ Êñ∞Â¢ûË¥πÁî®" data-en="+ Add Charge">+ Êñ∞Â¢ûË¥πÁî®</span>
                                </button>
                            </div>

                            <div id="additional-charges-container">
                                <!-- Âõ∫ÂÆöË¥π -->
                                <div class="charge-item" data-charge-id="fixed-fee">
                                    <div class="charge-header">
                                        <div class="charge-info">
                                            <h5 data-zh="Âõ∫ÂÆöË¥π" data-en="Fixed Fee">Âõ∫ÂÆöË¥π</h5>
                                            <p data-zh="ÊØèÊúàÂõ∫ÂÆöÊúçÂä°Ë¥π" data-en="Monthly fixed service fee">ÊØèÊúàÂõ∫ÂÆöÊúçÂä°Ë¥π</p>
                                        </div>
                                        <button type="button" class="btn-remove-charge" onclick="removeAdditionalCharge('fixed-fee')" style="display: none;">
                                            <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                        </button>
                                    </div>
                                    <div class="charge-config">
                                        <div class="charge-type">
                                            <label data-zh="ËÆ°Ë¥πÊñπÂºè" data-en="Billing Method">ËÆ°Ë¥πÊñπÂºè</label>
                                            <select class="form-input charge-method" onchange="updateChargeConfig(this)">
                                                <option value="fixed" data-zh="Âõ∫ÂÆöÈáëÈ¢ù" data-en="Fixed Amount">Âõ∫ÂÆöÈáëÈ¢ù</option>
                                                <option value="percentage" data-zh="ÁôæÂàÜÊØî" data-en="Percentage">ÁôæÂàÜÊØî</option>
                                                <option value="per-unit" data-zh="ÊåâÁî®ÁîµÈáè" data-en="Per Unit">ÊåâÁî®ÁîµÈáè</option>
                                            </select>
                                        </div>
                                        <div class="charge-value">
                                            <label data-zh="Ë¥πÁî®ÈáëÈ¢ù" data-en="Amount">Ë¥πÁî®ÈáëÈ¢ù</label>
                                            <div class="value-input-group">
                                                <input type="number" class="form-input charge-amount" value="150" min="0" step="0.01">
                                                <span class="charge-unit" data-zh="‚Çπ/Êúà" data-en="‚Çπ/month">‚Çπ/Êúà</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁáÉÊñôË∞ÉÊï¥Ë¥π -->
                                <div class="charge-item" data-charge-id="fuel-adjustment">
                                    <div class="charge-header">
                                        <div class="charge-info">
                                            <h5 data-zh="ÁáÉÊñôË∞ÉÊï¥Ë¥π" data-en="Fuel Adjustment Fee">ÁáÉÊñôË∞ÉÊï¥Ë¥π</h5>
                                            <p data-zh="8% √ó ÁîµÈáèË¥π" data-en="8% √ó Electricity charges">8% √ó ÁîµÈáèË¥π</p>
                                        </div>
                                        <button type="button" class="btn-remove-charge" onclick="removeAdditionalCharge('fuel-adjustment')">
                                            <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                        </button>
                                    </div>
                                    <div class="charge-config">
                                        <div class="charge-type">
                                            <label data-zh="ËÆ°Ë¥πÊñπÂºè" data-en="Billing Method">ËÆ°Ë¥πÊñπÂºè</label>
                                            <select class="form-input charge-method" onchange="updateChargeConfig(this)">
                                                <option value="fixed" data-zh="Âõ∫ÂÆöÈáëÈ¢ù" data-en="Fixed Amount">Âõ∫ÂÆöÈáëÈ¢ù</option>
                                                <option value="percentage" selected data-zh="ÁôæÂàÜÊØî" data-en="Percentage">ÁôæÂàÜÊØî</option>
                                                <option value="per-unit" data-zh="ÊåâÁî®ÁîµÈáè" data-en="Per Unit">ÊåâÁî®ÁîµÈáè</option>
                                            </select>
                                        </div>
                                        <div class="charge-value">
                                            <label data-zh="Ë¥πÁî®ÈáëÈ¢ù" data-en="Amount">Ë¥πÁî®ÈáëÈ¢ù</label>
                                            <div class="value-input-group">
                                                <input type="number" class="form-input charge-amount" value="8" min="0" step="0.1">
                                                <span class="charge-unit" data-zh="%" data-en="%">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÊîøÂ∫úÁ®é -->
                                <div class="charge-item" data-charge-id="government-tax">
                                    <div class="charge-header">
                                        <div class="charge-info">
                                            <h5 data-zh="ÊîøÂ∫úÁ®é" data-en="Government Tax">ÊîøÂ∫úÁ®é</h5>
                                            <p data-zh="ÊîøÂ∫úÂæÅÊî∂ÁöÑÁîµÂäõÁ®éË¥π" data-en="Government imposed electricity tax">ÊîøÂ∫úÂæÅÊî∂ÁöÑÁîµÂäõÁ®éË¥π</p>
                                        </div>
                                        <button type="button" class="btn-remove-charge" onclick="removeAdditionalCharge('government-tax')">
                                            <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                                        </button>
                                    </div>
                                    <div class="charge-config">
                                        <div class="charge-type">
                                            <label data-zh="ËÆ°Ë¥πÊñπÂºè" data-en="Billing Method">ËÆ°Ë¥πÊñπÂºè</label>
                                            <select class="form-input charge-method" onchange="updateChargeConfig(this)">
                                                <option value="fixed" data-zh="Âõ∫ÂÆöÈáëÈ¢ù" data-en="Fixed Amount">Âõ∫ÂÆöÈáëÈ¢ù</option>
                                                <option value="percentage" selected data-zh="ÁôæÂàÜÊØî" data-en="Percentage">ÁôæÂàÜÊØî</option>
                                                <option value="per-unit" data-zh="ÊåâÁî®ÁîµÈáè" data-en="Per Unit">ÊåâÁî®ÁîµÈáè</option>
                                            </select>
                                        </div>
                                        <div class="charge-value">
                                            <label data-zh="Ë¥πÁî®ÈáëÈ¢ù" data-en="Amount">Ë¥πÁî®ÈáëÈ¢ù</label>
                                            <div class="value-input-group">
                                                <input type="number" class="form-input charge-amount" value="18" min="0" step="0.1">
                                                <span class="charge-unit" data-zh="%" data-en="%">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ë¥πÁî®È¢ÑËßà -->
                            <div class="charges-summary">
                                <h4 data-zh="Ë¥πÁî®È¢ÑËßà" data-en="Charges Preview">Ë¥πÁî®È¢ÑËßà</h4>
                                <div class="summary-table">
                                    <div class="summary-row header">
                                        <span data-zh="Ë¥πÁî®È°πÁõÆ" data-en="Charge Item">Ë¥πÁî®È°πÁõÆ</span>
                                        <span data-zh="ËÆ°Ë¥πÊñπÂºè" data-en="Method">ËÆ°Ë¥πÊñπÂºè</span>
                                        <span data-zh="ÈáëÈ¢ù" data-en="Amount">ÈáëÈ¢ù</span>
                                    </div>
                                    <div id="charges-preview">
                                        <!-- Âä®ÊÄÅÁîüÊàêÈ¢ÑËßàÂÜÖÂÆπ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê≠•È™§ÂØºËà™ÊåâÈíÆ -->
                    <div class="step-navigation">
                        <div class="nav-left">
                            <button id="prev-btn-3" class="btn btn-secondary" onclick="previousStep()">
                                <span data-zh="‰∏ä‰∏ÄÊ≠•" data-en="Previous">‰∏ä‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                        <div class="nav-right">
                            <button class="btn btn-outline" onclick="saveDraft()">
                                <span data-zh="‰øùÂ≠òËçâÁ®ø" data-en="Save Draft">‰øùÂ≠òËçâÁ®ø</span>
                            </button>
                            <button id="next-btn-3" class="btn btn-primary" onclick="nextStep()">
                                <span data-zh="‰∏ã‰∏ÄÊ≠•" data-en="Next">‰∏ã‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê≠•È™§4: Ë¥πÁéáÊµãËØï -->
                <div id="step-4" class="step-content-panel">
                    <!-- ÊµãËØïÂú∫ÊôØÈÖçÁΩÆ -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="Ë¥πÁéáÊµãËØï" data-en="Rate Testing">Ë¥πÁéáÊµãËØï</h3>
                            <p data-zh="ÊµãËØï‰∏çÂêåÁî®ÁîµÂú∫ÊôØ‰∏ãÁöÑË¥πÁî®ËÆ°ÁÆó" data-en="Test cost calculations under different usage scenarios">ÊµãËØï‰∏çÂêåÁî®ÁîµÂú∫ÊôØ‰∏ãÁöÑË¥πÁî®ËÆ°ÁÆó</p>
                        </div>

                        <div class="settings-form">
                            <!-- Âõ∫ÂÆöÁîµ‰ª∑ÊµãËØïËæìÂÖ• -->
                            <div id="flat-test-inputs" class="test-inputs-section" style="display: none;">
                                <div class="form-group">
                                    <label for="flat-test-usage" data-zh="ÊµãËØïÁî®ÁîµÈáè(kWh)" data-en="Test Usage(kWh)">ÊµãËØïÁî®ÁîµÈáè(kWh)</label>
                                    <input type="number" id="flat-test-usage" class="form-input" value="300" min="0" step="1">
                                </div>
                            </div>

                            <!-- Èò∂Ê¢ØÁîµ‰ª∑ÊµãËØïËæìÂÖ• -->
                            <div id="tiered-test-inputs" class="test-inputs-section">
                                <div class="form-group">
                                    <label for="tiered-test-usage" data-zh="ÊµãËØïÁî®ÁîµÈáè(kWh)" data-en="Test Usage(kWh)">ÊµãËØïÁî®ÁîµÈáè(kWh)</label>
                                    <input type="number" id="tiered-test-usage" class="form-input" value="299" min="0" step="1">
                                </div>
                            </div>

                            <!-- ÂàÜÊó∂Áîµ‰ª∑ÊµãËØïËæìÂÖ• -->
                            <div id="time-of-use-test-inputs" class="test-inputs-section" style="display: none;">
                                <div class="time-usage-inputs">
                                    <div class="usage-period">
                                        <label data-zh="È´òÂ≥∞Êó∂ÊÆµÁî®ÁîµÈáè(kWh)" data-en="Peak Period Usage(kWh)">È´òÂ≥∞Êó∂ÊÆµÁî®ÁîµÈáè(kWh)</label>
                                        <input type="number" id="peak-usage" class="form-input" value="50" min="0" step="1" onchange="updateTotalTimeUsageFromInputs()">
                                    </div>
                                    <div class="usage-period">
                                        <label data-zh="Âπ≥Â≥∞Êó∂ÊÆµÁî®ÁîµÈáè(kWh)" data-en="Standard Period Usage(kWh)">Âπ≥Â≥∞Êó∂ÊÆµÁî®ÁîµÈáè(kWh)</label>
                                        <input type="number" id="standard-usage" class="form-input" value="150" min="0" step="1" onchange="updateTotalTimeUsageFromInputs()">
                                    </div>
                                    <div class="usage-period">
                                        <label data-zh="Ë∞∑ÂÄºÊó∂ÊÆµÁî®ÁîµÈáè(kWh)" data-en="Valley Period Usage(kWh)">Ë∞∑ÂÄºÊó∂ÊÆµÁî®ÁîµÈáè(kWh)</label>
                                        <input type="number" id="valley-usage" class="form-input" value="99" min="0" step="1" onchange="updateTotalTimeUsageFromInputs()">
                                    </div>
                                </div>
                                <div class="total-usage">
                                    <span data-zh="ÊÄªÁî®ÁîµÈáè:" data-en="Total Usage:">ÊÄªÁî®ÁîµÈáè:</span>
                                    <span id="total-usage-display">299 kWh</span>
                                </div>
                            </div>

                            <!-- ËÆ°ÁÆóÊåâÈíÆ -->
                            <div class="calculation-section">
                                <button type="button" class="btn btn-primary calculate-btn" onclick="calculateTestResult()">
                                    <span data-zh="ËÆ°ÁÆóË¥πÁî®" data-en="Calculate Cost">ËÆ°ÁÆóË¥πÁî®</span>
                                </button>
                            </div>

                            <!-- ËÆ°ÁÆóÁªìÊûúÊòæÁ§∫ -->
                            <div id="calculation-results" class="calculation-results" style="display: none;">
                                <div class="results-header">
                                    <h4 data-zh="Ë¥¶ÂçïÁÆ°ÁêÜ" data-en="Bill Management">Ë¥¶ÂçïÁÆ°ÁêÜ</h4>
                                </div>

                                <!-- Ë¥πÁî®Ê±áÊÄªË°® -->
                                <div class="bill-summary-table">
                                    <div class="bill-table-header">
                                        <span data-zh="È°πÁõÆ" data-en="Item">È°πÁõÆ</span>
                                        <span data-zh="ÈáëÈ¢ùÔºàÂç¢ÊØîÔºâ" data-en="Amount (Rupees)">ÈáëÈ¢ùÔºàÂç¢ÊØîÔºâ</span>
                                        <span data-zh="ËØ¥Êòé" data-en="Description">ËØ¥Êòé</span>
                                    </div>
                                    <div id="bill-items">
                                        <div class="bill-item">
                                            <span data-zh="ÁîµÈáèË¥π" data-en="Electricity Charges">ÁîµÈáèË¥π</span>
                                            <span id="electricity-cost">‚Çπ1966</span>
                                            <span id="electricity-desc">299 kWh √ó Áîµ‰ª∑</span>
                                        </div>
                                        <div class="bill-item">
                                            <span data-zh="Âõ∫ÂÆöË¥π" data-en="Fixed Fee">Âõ∫ÂÆöË¥π</span>
                                            <span id="fixed-fee-cost">‚Çπ150</span>
                                            <span data-zh="ÊØèÊúàÂõ∫ÂÆöÊúçÂä°Ë¥π" data-en="Monthly fixed service fee">ÊØèÊúàÂõ∫ÂÆöÊúçÂä°Ë¥π</span>
                                        </div>
                                        <div class="bill-item">
                                            <span data-zh="ÁáÉÊñôË∞ÉÊï¥Ë¥π" data-en="Fuel Adjustment Fee">ÁáÉÊñôË∞ÉÊï¥Ë¥π</span>
                                            <span id="fuel-adjustment-cost">‚Çπ157</span>
                                            <span id="fuel-adjustment-desc">8% √ó ÁîµÈáèË¥π</span>
                                        </div>
                                        <div class="bill-item">
                                            <span data-zh="ÊîøÂ∫úÁ®é" data-en="Government Tax">ÊîøÂ∫úÁ®é</span>
                                            <span id="government-tax-cost">‚Çπ273</span>
                                            <span id="government-tax-desc">12% √ó (ÁîµÈáèË¥π + Âõ∫ÂÆöË¥π + ÁáÉÊñôË¥π)</span>
                                        </div>
                                        <div class="bill-item total">
                                            <span data-zh="ÊÄªË¥πÁî®" data-en="Total Cost">ÊÄªË¥πÁî®</span>
                                            <span id="total-cost">‚Çπ2546</span>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÁîµÈáèË¥πÊòéÁªÜ -->
                                <div class="electricity-detail">
                                    <div class="detail-header">
                                        <h5 data-zh="ÁîµÈáèË¥πÊòéÁªÜ" data-en="Electricity Charges Detail">ÁîµÈáèË¥πÊòéÁªÜ</h5>
                                        <button type="button" class="detail-toggle" onclick="toggleElectricityDetail()">
                                            <span data-zh="Êü•ÁúãÊòéÁªÜ" data-en="View Details">Êü•ÁúãÊòéÁªÜ</span>
                                        </button>
                                    </div>

                                    <div id="electricity-breakdown" class="detail-breakdown" style="display: none;">
                                        <!-- Èò∂Ê¢ØÁîµ‰ª∑ÊòéÁªÜ -->
                                        <div id="tiered-breakdown" class="breakdown-content">
                                            <div class="breakdown-table">
                                                <div class="breakdown-header">
                                                    <span data-zh="Èò∂Ê¢Ø" data-en="Tier">Èò∂Ê¢Ø</span>
                                                    <span data-zh="ËåÉÂõ¥(kWh)" data-en="Range(kWh)">ËåÉÂõ¥(kWh)</span>
                                                    <span data-zh="Áîµ‰ª∑(‚Çπ/kWh)" data-en="Rate(‚Çπ/kWh)">Áîµ‰ª∑(‚Çπ/kWh)</span>
                                                    <span data-zh="Áî®Èáè(kWh)" data-en="Usage(kWh)">Áî®Èáè(kWh)</span>
                                                    <span data-zh="ÈáëÈ¢ù(‚Çπ)" data-en="Amount(‚Çπ)">ÈáëÈ¢ù(‚Çπ)</span>
                                                </div>
                                                <div id="tier-breakdown-rows">
                                                    <!-- Âä®ÊÄÅÁîüÊàêÈò∂Ê¢ØÊòéÁªÜ -->
                                                </div>
                                                <div class="breakdown-subtotal">
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                    <span data-zh="Â∞èËÆ°" data-en="Subtotal">Â∞èËÆ°</span>
                                                    <span id="tier-subtotal">‚Çπ1966</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ÂàÜÊó∂Áîµ‰ª∑ÊòéÁªÜ -->
                                        <div id="time-breakdown" class="breakdown-content" style="display: none;">
                                            <div class="breakdown-table">
                                                <div class="breakdown-header">
                                                    <span data-zh="Êó∂ÊÆµ" data-en="Period">Êó∂ÊÆµ</span>
                                                    <span data-zh="Êó∂Èó¥" data-en="Time">Êó∂Èó¥</span>
                                                    <span data-zh="Áîµ‰ª∑(‚Çπ/kWh)" data-en="Rate(‚Çπ/kWh)">Áîµ‰ª∑(‚Çπ/kWh)</span>
                                                    <span data-zh="Áî®Èáè(kWh)" data-en="Usage(kWh)">Áî®Èáè(kWh)</span>
                                                    <span data-zh="ÈáëÈ¢ù(‚Çπ)" data-en="Amount(‚Çπ)">ÈáëÈ¢ù(‚Çπ)</span>
                                                </div>
                                                <div id="time-breakdown-rows">
                                                    <!-- Âä®ÊÄÅÁîüÊàêÊó∂ÊÆµÊòéÁªÜ -->
                                                </div>
                                                <div class="breakdown-subtotal">
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                    <span data-zh="Â∞èËÆ°" data-en="Subtotal">Â∞èËÆ°</span>
                                                    <span id="time-subtotal">‚Çπ1966</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Âõ∫ÂÆöÁîµ‰ª∑ÊòéÁªÜ -->
                                        <div id="flat-breakdown" class="breakdown-content" style="display: none;">
                                            <div class="breakdown-simple">
                                                <span data-zh="Áªü‰∏ÄÁîµ‰ª∑" data-en="Flat Rate">Áªü‰∏ÄÁîµ‰ª∑: </span>
                                                <span id="flat-rate-display">‚Çπ6.50/kWh</span>
                                                <span> √ó </span>
                                                <span id="flat-usage-display">300 kWh</span>
                                                <span> = </span>
                                                <span id="flat-total-display">‚Çπ1950</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê≠•È™§ÂØºËà™ÊåâÈíÆ -->
                    <div class="step-navigation">
                        <div class="nav-left">
                            <button id="prev-btn-4" class="btn btn-secondary" onclick="previousStep()">
                                <span data-zh="‰∏ä‰∏ÄÊ≠•" data-en="Previous">‰∏ä‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                        <div class="nav-right">
                            <button class="btn btn-outline" onclick="saveDraft()">
                                <span data-zh="‰øùÂ≠òËçâÁ®ø" data-en="Save Draft">‰øùÂ≠òËçâÁ®ø</span>
                            </button>
                            <button id="next-btn-4" class="btn btn-primary" onclick="nextStep()">
                                <span data-zh="‰∏ã‰∏ÄÊ≠•" data-en="Next">‰∏ã‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ê≠•È™§5: È¢ÑËßàÂèëÂ∏É -->
                <div id="step-5" class="step-content-panel">
                    <!-- ÈÖçÁΩÆÊ±áÊÄª -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="ÈÖçÁΩÆÊ±áÊÄª" data-en="Configuration Summary">ÈÖçÁΩÆÊ±áÊÄª</h3>
                            <p data-zh="Êü•ÁúãÊâÄÊúâÈÖçÁΩÆÈ°πÁöÑÊ±áÊÄª‰ø°ÊÅØ" data-en="View summary of all configuration items">Êü•ÁúãÊâÄÊúâÈÖçÁΩÆÈ°πÁöÑÊ±áÊÄª‰ø°ÊÅØ</p>
                        </div>

                        <div class="settings-form">
                            <!-- Âü∫Êú¨ÈÖçÁΩÆÊ±áÊÄª -->
                            <div class="summary-section">
                                <h4 data-zh="Âü∫Êú¨ÈÖçÁΩÆ" data-en="Basic Configuration">Âü∫Êú¨ÈÖçÁΩÆ</h4>
                                <div class="summary-grid">
                                    <div class="summary-item">
                                        <div class="summary-label" data-zh="Ê®°ÊùøÂêçÁß∞" data-en="Template Name">Ê®°ÊùøÂêçÁß∞</div>
                                        <div class="summary-value" id="summary-template-name">-</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="summary-label" data-zh="Ë¥¶ÂçïÂë®Êúü" data-en="Billing Cycle">Ë¥¶ÂçïÂë®Êúü</div>
                                        <div class="summary-value" id="summary-billing-cycle">-</div>
                                    </div>
                                    <div class="summary-item">
                                        <div class="summary-label" data-zh="Ë¥¶ÂçïÊó•" data-en="Billing Date">Ë¥¶ÂçïÊó•</div>
                                        <div class="summary-value" id="summary-billing-date">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ë¥πÁéáÁªìÊûÑÊ±áÊÄª -->
                            <div class="summary-section">
                                <h4 data-zh="Ë¥πÁéáÁªìÊûÑ" data-en="Rate Structure">Ë¥πÁéáÁªìÊûÑ</h4>
                                <div class="summary-grid">
                                    <div class="summary-item">
                                        <div class="summary-label" data-zh="ÁîµË¥πÁ±ªÂûã" data-en="Tariff Type">ÁîµË¥πÁ±ªÂûã</div>
                                        <div class="summary-value" id="summary-tariff-type">-</div>
                                    </div>
                                </div>
                                <!-- Èò∂Ê¢ØÁîµ‰ª∑ËØ¶ÊÉÖ -->
                                <div id="tiered-summary" class="tariff-detail-summary" style="display: none;">
                                    <div class="detail-table">
                                        <div class="detail-header">
                                            <span data-zh="Èò∂Ê¢Ø" data-en="Tier">Èò∂Ê¢Ø</span>
                                            <span data-zh="ËåÉÂõ¥(kWh)" data-en="Range(kWh)">ËåÉÂõ¥(kWh)</span>
                                            <span data-zh="Áîµ‰ª∑(‚Çπ/kWh)" data-en="Rate(‚Çπ/kWh)">Áîµ‰ª∑(‚Çπ/kWh)</span>
                                        </div>
                                        <div id="tiered-summary-rows">
                                            <!-- Âä®ÊÄÅÁîüÊàê -->
                                        </div>
                                    </div>
                                </div>
                                <!-- ÂàÜÊó∂Áîµ‰ª∑ËØ¶ÊÉÖ -->
                                <div id="time-of-use-summary" class="tariff-detail-summary" style="display: none;">
                                    <div class="detail-table">
                                        <div class="detail-header">
                                            <span data-zh="Êó∂ÊÆµ" data-en="Period">Êó∂ÊÆµ</span>
                                            <span data-zh="Êó∂Èó¥" data-en="Time">Êó∂Èó¥</span>
                                            <span data-zh="Áîµ‰ª∑(‚Çπ/kWh)" data-en="Rate(‚Çπ/kWh)">Áîµ‰ª∑(‚Çπ/kWh)</span>
                                        </div>
                                        <div id="time-of-use-summary-rows">
                                            <!-- Âä®ÊÄÅÁîüÊàê -->
                                        </div>
                                    </div>
                                </div>
                                <!-- Âõ∫ÂÆöÁîµ‰ª∑ËØ¶ÊÉÖ -->
                                <div id="flat-summary" class="tariff-detail-summary" style="display: none;">
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <div class="summary-label" data-zh="Áªü‰∏ÄÁîµ‰ª∑" data-en="Flat Rate">Áªü‰∏ÄÁîµ‰ª∑</div>
                                            <div class="summary-value" id="summary-flat-rate">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ÈôÑÂä†Ë¥πÁî®Ê±áÊÄª -->
                            <div class="summary-section">
                                <h4 data-zh="ÈôÑÂä†Ë¥πÁî®" data-en="Additional Charges">ÈôÑÂä†Ë¥πÁî®</h4>
                                <div class="detail-table">
                                    <div class="detail-header">
                                        <span data-zh="Ë¥πÁî®È°πÁõÆ" data-en="Charge Item">Ë¥πÁî®È°πÁõÆ</span>
                                        <span data-zh="ËÆ°Ë¥πÊñπÂºè" data-en="Billing Method">ËÆ°Ë¥πÊñπÂºè</span>
                                        <span data-zh="ÈáëÈ¢ù" data-en="Amount">ÈáëÈ¢ù</span>
                                    </div>
                                    <div id="charges-summary-rows">
                                        <!-- Âä®ÊÄÅÁîüÊàê -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ê≠•È™§ÂØºËà™ÊåâÈíÆ -->
                    <div class="step-navigation">
                        <div class="nav-left">
                            <button id="prev-btn-5" class="btn btn-secondary" onclick="previousStep()">
                                <span data-zh="‰∏ä‰∏ÄÊ≠•" data-en="Previous">‰∏ä‰∏ÄÊ≠•</span>
                            </button>
                        </div>
                        <div class="nav-right">
                            <button id="save-draft-btn-5" class="btn btn-outline" onclick="saveDraft()">
                                <span data-zh="‰øùÂ≠òËçâÁ®ø" data-en="Save Draft">‰øùÂ≠òËçâÁ®ø</span>
                            </button>
                            <button id="save-template-btn" class="btn btn-success" onclick="saveTemplate()">
                                <span data-zh="‰øùÂ≠òÊ®°Êùø" data-en="Save Template">‰øùÂ≠òÊ®°Êùø</span>
                            </button>
                            <button id="publish-template-btn" class="btn btn-primary" onclick="publishTemplate()">
                                <span data-zh="ÂèëÂ∏ÉÊ®°Êùø" data-en="Publish Template">ÂèëÂ∏ÉÊ®°Êùø</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/common.js"></script>
    <script src="assets/js/navbar.js"></script>
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentStep = 1;
        let isEditMode = false;
        let editingTemplateId = null;
        let editingTemplateData = null;

        // Ê£ÄÊü•ÁºñËæëÊ®°Âºè
        function checkEditMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const templateId = urlParams.get('id');

            if (templateId) {
                isEditMode = true;
                editingTemplateId = templateId;

                // ‰ªéÊ®°ÊùøÂàóË°®È°µÈù¢Ëé∑ÂèñÊ®°ÊùøÊï∞ÊçÆÔºàÊ®°ÊãüÔºâ
                editingTemplateData = getTemplateById(templateId);

                if (editingTemplateData) {
                    // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
                    const pageTitle = document.getElementById('page-title');
                    if (pageTitle) {
                        const currentLang = getCurrentLanguage();
                        const titleText = currentLang === 'zh' ? 'ÁºñËæëÁîµ‰ª∑Ê®°Áâà' : 'Edit Pricing Template';
                        pageTitle.textContent = titleText;
                        pageTitle.setAttribute('data-zh', 'ÁºñËæëÁîµ‰ª∑Ê®°Áâà');
                        pageTitle.setAttribute('data-en', 'Edit Pricing Template');
                    }

                    // Âä†ËΩΩÊ®°ÊùøÊï∞ÊçÆÂà∞Ë°®Âçï
                    loadTemplateData(editingTemplateData);
                }
            }
        }

        // Ê†πÊçÆIDËé∑ÂèñÊ®°ÊùøÊï∞ÊçÆÔºàÊ®°Êãü‰ªéÊú¨Âú∞Â≠òÂÇ®ÊàñAPIËé∑ÂèñÔºâ
        function getTemplateById(templateId) {
            // ËøôÈáåÂ∫îËØ•‰ªéÂÆûÈôÖÁöÑÊï∞ÊçÆÊ∫êËé∑ÂèñÔºåÁé∞Âú®ÂÖàÊ®°Êãü
            const mockTemplateData = {
                'TMP001': {
                    id: 'TMP001',
                    name: '‰ΩèÂÆÖÈò∂Ê¢ØÁîµ‰ª∑ - Ê≥∞Á±≥Â∞îÁ∫≥Âæ∑ÈÇ¶',
                    nameEn: 'Residential Tiered Rate - Tamil Nadu',
                    state: 'tamil-nadu',
                    customerType: 'residential',
                    billingMethod: 'tiered',
                    billingCycle: 'monthly',
                    description: 'ÈÄÇÁî®‰∫éÊ≥∞Á±≥Â∞îÁ∫≥Âæ∑ÈÇ¶‰ΩèÂÆÖÁî®Êà∑ÁöÑÈò∂Ê¢ØÁîµ‰ª∑Ê®°Áâà',
                    tiers: [
                        { min: 0, max: 100, rate: 2.50 },
                        { min: 100, max: 200, rate: 3.20 },
                        { min: 200, max: 500, rate: 3.85 },
                        { min: 500, max: 999999, rate: 4.20 }
                    ]
                }
            };

            return mockTemplateData[templateId] || null;
        }

        // Âä†ËΩΩÊ®°ÊùøÊï∞ÊçÆÂà∞Ë°®Âçï
        function loadTemplateData(templateData) {
            if (!templateData) return;

            // TODO: Ê†πÊçÆÊ®°ÊùøÊï∞ÊçÆÂ°´ÂÖÖË°®ÂçïÂ≠óÊÆµ
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÁöÑË°®ÂçïÁªìÊûÑÊù•ÂÆûÁé∞
            console.log('Loading template data:', templateData);
        }

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÁºñËæëÊ®°Âºè
            checkEditMode();

            // ËÆæÁΩÆÂàùÂßãÁä∂ÊÄÅ
            showStep(1);

            // ÁõëÂê¨ËØ≠Ë®ÄÂèòÂåñ
            window.addEventListener('languageChanged', function() {
                // ËØ≠Ë®ÄÂèòÂåñÊó∂Êõ¥Êñ∞ÊâÄÊúâÂä®ÊÄÅÂÜÖÂÆπ
                updateConfigurationSummary();
                updateChargesPreview();
                updateUnlimitedTexts();
            });
        });

        // Ê≠•È™§ÂàáÊç¢ÂáΩÊï∞
        function switchStep(step) {
            currentStep = step;
            showStep(step);
        }

        function showStep(step) {
            // ÈöêËóèÊâÄÊúâÊ≠•È™§ÂÜÖÂÆπ
            const panels = document.querySelectorAll('.step-content-panel');
            panels.forEach(panel => {
                panel.classList.remove('active');
            });

            // ÊòæÁ§∫ÂΩìÂâçÊ≠•È™§ÂÜÖÂÆπ
            const currentPanel = document.getElementById(`step-${step}`);
            if (currentPanel) {
                currentPanel.classList.add('active');
            }

            // Êõ¥Êñ∞Ê≠•È™§ÂØºËà™Ê†∑Âºè
            const stepItems = document.querySelectorAll('.step-item');
            stepItems.forEach((item, index) => {
                item.classList.remove('active');
                if (index + 1 === step) {
                    item.classList.add('active');
                }
            });
        }

        function nextStep() {
            if (currentStep < 5) {
                currentStep++;
                showStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        // Êõ¥Êñ∞ÊµãËØïËæìÂÖ•ÁïåÈù¢
        function updateTestInputs() {
            const selectedTariffType = document.getElementById('tariff-type').value;

            // ÈöêËóèÊâÄÊúâÊµãËØïËæìÂÖ•ÁïåÈù¢
            document.querySelectorAll('.test-inputs-section').forEach(section => {
                section.style.display = 'none';
            });

            // ÊòæÁ§∫ÂØπÂ∫îÁöÑÊµãËØïËæìÂÖ•ÁïåÈù¢
            const targetSection = `${selectedTariffType}-test-inputs`;
            const sectionElement = document.getElementById(targetSection);
            if (sectionElement) {
                sectionElement.style.display = 'block';
            }

            // Êõ¥Êñ∞ÁîµÈáèË¥πÊòéÁªÜÊòæÁ§∫
            updateElectricityBreakdownDisplay();
        }

        // Êõ¥Êñ∞ÁîµÈáèË¥πÊòéÁªÜÊòæÁ§∫Á±ªÂûã
        function updateElectricityBreakdownDisplay() {
            const selectedTariffType = document.getElementById('tariff-type').value;

            // ÈöêËóèÊâÄÊúâÊòéÁªÜÁ±ªÂûã
            document.querySelectorAll('.breakdown-content').forEach(content => {
                content.style.display = 'none';
            });

            // ÊòæÁ§∫ÂØπÂ∫îÁöÑÊòéÁªÜÁ±ªÂûã
            const targetBreakdown = `${selectedTariffType}-breakdown`;
            const breakdownElement = document.getElementById(targetBreakdown);
            if (breakdownElement) {
                breakdownElement.style.display = 'block';
            }
        }

        // ËÆ°ÁÆóÂàÜÊó∂ÊÄªÁî®ÁîµÈáè
        function updateTotalTimeUsage() {
            const peak = parseFloat(document.getElementById('peak-usage').value) || 0;
            const standard = parseFloat(document.getElementById('standard-usage').value) || 0;
            const valley = parseFloat(document.getElementById('valley-usage').value) || 0;
            const total = peak + standard + valley;

            document.getElementById('total-usage-display').textContent = `${total} kWh`;
            return total;
        }

        // ÂàáÊç¢ÁîµÈáèË¥πÊòéÁªÜÊòæÁ§∫
        function toggleElectricityDetail() {
            const breakdown = document.getElementById('electricity-breakdown');
            const toggleBtn = document.querySelector('.detail-toggle span');
            const currentLanguage = getCurrentLanguage();

            if (breakdown.style.display === 'none') {
                breakdown.style.display = 'block';
                toggleBtn.textContent = currentLanguage === 'en' ? 'Hide Details' : 'ÈöêËóèÊòéÁªÜ';
            } else {
                breakdown.style.display = 'none';
                toggleBtn.textContent = currentLanguage === 'en' ? 'View Details' : 'Êü•ÁúãÊòéÁªÜ';
            }
        }

        // ËÆ°ÁÆóÊµãËØïÁªìÊûú
        function calculateTestResult() {
            const selectedTariffType = document.getElementById('tariff-type').value;
            let electricityCost = 0;
            let usageDescription = '';
            let totalUsage = 0;

            // Ê†πÊçÆÁîµ‰ª∑Á±ªÂûãËÆ°ÁÆóÁîµÈáèË¥π
            switch (selectedTariffType) {
                case 'flat':
                    totalUsage = parseFloat(document.getElementById('flat-test-usage').value) || 0;
                    const flatRate = parseFloat(document.getElementById('flat-rate').value) || 6.50;
                    electricityCost = totalUsage * flatRate;
                    usageDescription = `${totalUsage} kWh √ó ‚Çπ${flatRate}/kWh`;
                    updateFlatBreakdown(flatRate, totalUsage, electricityCost);
                    break;

                case 'tiered':
                    totalUsage = parseFloat(document.getElementById('tiered-test-usage').value) || 0;
                    electricityCost = calculateTieredCost(totalUsage);
                    usageDescription = `${totalUsage} kWh √ó Èò∂Ê¢ØÁîµ‰ª∑`;
                    updateTieredBreakdown(totalUsage);
                    break;

                case 'time-of-use':
                    totalUsage = updateTotalTimeUsageFromInputs();
                    electricityCost = calculateTimeOfUseCostFromInputs();
                    usageDescription = `${totalUsage} kWh √ó ÂàÜÊó∂Áîµ‰ª∑`;
                    updateTimeBreakdownFromInputs();
                    break;
            }

            // Ëé∑ÂèñÈôÑÂä†Ë¥πÁî®ÈÖçÁΩÆ
            const charges = getAdditionalChargesConfig();

            // ËÆ°ÁÆóÂêÑÈ°πË¥πÁî®
            let fixedFee = charges.fixedFee || 150;
            let fuelAdjustment = Math.round(electricityCost * (charges.fuelAdjustmentRate / 100));
            let governmentTax = Math.round((electricityCost + fixedFee + fuelAdjustment) * (charges.governmentTaxRate / 100));
            let totalCost = electricityCost + fixedFee + fuelAdjustment + governmentTax;

            // Êõ¥Êñ∞ÊòæÁ§∫
            document.getElementById('electricity-cost').textContent = `‚Çπ${Math.round(electricityCost)}`;
            document.getElementById('electricity-desc').textContent = usageDescription;
            document.getElementById('fixed-fee-cost').textContent = `‚Çπ${fixedFee}`;
            document.getElementById('fuel-adjustment-cost').textContent = `‚Çπ${fuelAdjustment}`;
            document.getElementById('fuel-adjustment-desc').textContent = `${charges.fuelAdjustmentRate}% √ó ÁîµÈáèË¥π`;
            document.getElementById('government-tax-cost').textContent = `‚Çπ${governmentTax}`;
            document.getElementById('government-tax-desc').textContent = `${charges.governmentTaxRate}% √ó (ÁîµÈáèË¥π + Âõ∫ÂÆöË¥π + ÁáÉÊñôË¥π)`;
            document.getElementById('total-cost').textContent = `‚Çπ${totalCost}`;

            // ÊòæÁ§∫ËÆ°ÁÆóÁªìÊûú
            document.getElementById('calculation-results').style.display = 'block';
        }

        // ÂàÜÊó∂Áîµ‰ª∑‰ªéËæìÂÖ•Ê°ÜËÆ°ÁÆóË¥πÁî®
        function calculateTimeOfUseCostFromInputs() {
            const periodItems = document.querySelectorAll('.time-period-item');
            let totalCost = 0;

            periodItems.forEach(period => {
                const periodId = period.getAttribute('data-period');
                const usageInput = document.getElementById(`${periodId}-usage`);
                const rateInput = period.querySelector('.period-rate');

                if (usageInput && rateInput) {
                    const usage = parseFloat(usageInput.value) || 0;
                    const rate = parseFloat(rateInput.value) || 0;
                    totalCost += usage * rate;
                }
            });

            return totalCost;
        }

        // ‰ªéËæìÂÖ•Ê°ÜÊõ¥Êñ∞ÂàÜÊó∂Áîµ‰ª∑ÊòéÁªÜ
        function updateTimeBreakdownFromInputs() {
            const periodItems = document.querySelectorAll('.time-period-item');
            const currentLanguage = getCurrentLanguage();
            let html = '';
            let subtotal = 0;

            periodItems.forEach(period => {
                const periodId = period.getAttribute('data-period');
                const periodName = period.querySelector('.editable-period-name').textContent;
                const timeStart = period.querySelector('.time-start').value;
                const timeEnd = period.querySelector('.time-end').value;
                const rate = parseFloat(period.querySelector('.period-rate').value) || 0;

                const usageInput = document.getElementById(`${periodId}-usage`);
                const usage = usageInput ? parseFloat(usageInput.value) || 0 : 0;
                const cost = usage * rate;

                subtotal += cost;

                html += `
                    <div class="breakdown-row">
                        <span>${periodName}</span>
                        <span>${timeStart}-${timeEnd}</span>
                        <span>‚Çπ${rate.toFixed(2)}</span>
                        <span>${usage}</span>
                        <span>‚Çπ${cost.toFixed(2)}</span>
                    </div>
                `;
            });

            document.getElementById('time-breakdown-rows').innerHTML = html;
            document.getElementById('time-subtotal').textContent = `‚Çπ${Math.round(subtotal)}`;
        }

        // ËÆ°ÁÆóÈò∂Ê¢ØÁîµ‰ª∑Ë¥πÁî®
        function calculateTieredCost(totalUsage) {
            const tierItems = document.querySelectorAll('.tier-item');
            let cost = 0;
            let remainingUsage = totalUsage;

            tierItems.forEach((tier, index) => {
                const tierRate = parseFloat(tier.querySelector('.tier-rate').value) || 0;
                const tierMaxInput = tier.querySelector('.tier-max');
                let tierMax;

                if (tierMaxInput.value === 'Êó†ÈôêÂà∂' || tierMaxInput.value === 'Unlimited') {
                    tierMax = Infinity;
                } else {
                    tierMax = parseFloat(tierMaxInput.value) || 0;
                }

                const tierMin = index === 0 ? 0 : parseFloat(tierItems[index - 1].querySelector('.tier-max').value) + 1;
                const tierCapacity = tierMax === Infinity ? remainingUsage : Math.min(tierMax - tierMin + 1, remainingUsage);

                if (remainingUsage > 0 && tierCapacity > 0) {
                    const usageInTier = Math.min(remainingUsage, tierCapacity);
                    cost += usageInTier * tierRate;
                    remainingUsage -= usageInTier;
                }
            });

            return cost;
        }

        // ËÆ°ÁÆóÂàÜÊó∂Áîµ‰ª∑Ë¥πÁî®
        function calculateTimeOfUseCost() {
            const peakUsage = parseFloat(document.getElementById('peak-usage').value) || 0;
            const standardUsage = parseFloat(document.getElementById('standard-usage').value) || 0;
            const valleyUsage = parseFloat(document.getElementById('valley-usage').value) || 0;

            const timePeriodsContainer = document.getElementById('time-periods-container');
            const peakRate = parseFloat(timePeriodsContainer.querySelector('[data-period="peak"] .period-rate').value) || 9.50;
            const standardRate = parseFloat(timePeriodsContainer.querySelector('[data-period="standard"] .period-rate').value) || 7.00;
            const valleyRate = parseFloat(timePeriodsContainer.querySelector('[data-period="valley"] .period-rate').value) || 4.50;

            return (peakUsage * peakRate) + (standardUsage * standardRate) + (valleyUsage * valleyRate);
        }

        // Ëé∑ÂèñÈôÑÂä†Ë¥πÁî®ÈÖçÁΩÆ
        function getAdditionalChargesConfig() {
            const fuelAdjustmentCharge = document.querySelector('[data-charge-id="fuel-adjustment"]');
            const governmentTaxCharge = document.querySelector('[data-charge-id="government-tax"]');
            const fixedFeeCharge = document.querySelector('[data-charge-id="fixed-fee"]');

            return {
                fixedFee: parseFloat(fixedFeeCharge?.querySelector('.charge-amount').value) || 150,
                fuelAdjustmentRate: parseFloat(fuelAdjustmentCharge?.querySelector('.charge-amount').value) || 8,
                governmentTaxRate: parseFloat(governmentTaxCharge?.querySelector('.charge-amount').value) || 18
            };
        }

        // Êõ¥Êñ∞Èò∂Ê¢ØÁîµ‰ª∑ÊòéÁªÜ
        function updateTieredBreakdown(totalUsage) {
            const tierItems = document.querySelectorAll('.tier-item');
            const breakdownRows = document.getElementById('tier-breakdown-rows');
            const currentLanguage = getCurrentLanguage();
            let html = '';
            let remainingUsage = totalUsage;
            let subtotal = 0;

            tierItems.forEach((tier, index) => {
                const tierLabel = tier.querySelector('.tier-label').textContent;
                const tierRate = parseFloat(tier.querySelector('.tier-rate').value) || 0;
                const tierMaxInput = tier.querySelector('.tier-max');
                let tierMax;

                if (tierMaxInput.value === 'Êó†ÈôêÂà∂' || tierMaxInput.value === 'Unlimited') {
                    tierMax = Infinity;
                } else {
                    tierMax = parseFloat(tierMaxInput.value) || 0;
                }

                const tierMin = index === 0 ? 0 : parseFloat(tierItems[index - 1].querySelector('.tier-max').value) + 1;
                const tierCapacity = tierMax === Infinity ? remainingUsage : Math.min(tierMax - tierMin + 1, remainingUsage);
                const usageInTier = Math.min(remainingUsage, tierCapacity);
                const tierCost = usageInTier * tierRate;

                subtotal += tierCost;

                const rangeText = tierMax === Infinity ? `${tierMin}+` : `${tierMin}-${tierMax}`;

                html += `
                    <div class="breakdown-row">
                        <span>${tierLabel}</span>
                        <span>${rangeText}</span>
                        <span>‚Çπ${tierRate.toFixed(2)}</span>
                        <span>${usageInTier}</span>
                        <span>‚Çπ${tierCost.toFixed(2)}</span>
                    </div>
                `;

                remainingUsage -= usageInTier;
            });

            breakdownRows.innerHTML = html;
            document.getElementById('tier-subtotal').textContent = `‚Çπ${Math.round(subtotal)}`;
        }

        // Êõ¥Êñ∞ÂàÜÊó∂Áîµ‰ª∑ÊòéÁªÜ
        function updateTimeBreakdown() {
            const peakUsage = parseFloat(document.getElementById('peak-usage').value) || 0;
            const standardUsage = parseFloat(document.getElementById('standard-usage').value) || 0;
            const valleyUsage = parseFloat(document.getElementById('valley-usage').value) || 0;

            const timePeriodsContainer = document.getElementById('time-periods-container');
            const peakRate = parseFloat(timePeriodsContainer.querySelector('[data-period="peak"] .period-rate').value) || 9.50;
            const standardRate = parseFloat(timePeriodsContainer.querySelector('[data-period="standard"] .period-rate').value) || 7.00;
            const valleyRate = parseFloat(timePeriodsContainer.querySelector('[data-period="valley"] .period-rate').value) || 4.50;

            const peakStart = timePeriodsContainer.querySelector('[data-period="peak"] .time-start').value;
            const peakEnd = timePeriodsContainer.querySelector('[data-period="peak"] .time-end').value;
            const standardStart = timePeriodsContainer.querySelector('[data-period="standard"] .time-start').value;
            const standardEnd = timePeriodsContainer.querySelector('[data-period="standard"] .time-end').value;
            const valleyStart = timePeriodsContainer.querySelector('[data-period="valley"] .time-start').value;
            const valleyEnd = timePeriodsContainer.querySelector('[data-period="valley"] .time-end').value;

            const currentLanguage = getCurrentLanguage();
            const peakCost = peakUsage * peakRate;
            const standardCost = standardUsage * standardRate;
            const valleyCost = valleyUsage * valleyRate;
            const subtotal = peakCost + standardCost + valleyCost;

            const html = `
                <div class="breakdown-row">
                    <span>${currentLanguage === 'en' ? 'Peak Period' : 'È´òÂ≥∞Êó∂ÊÆµ'}</span>
                    <span>${peakStart}-${peakEnd}</span>
                    <span>‚Çπ${peakRate.toFixed(2)}</span>
                    <span>${peakUsage}</span>
                    <span>‚Çπ${peakCost.toFixed(2)}</span>
                </div>
                <div class="breakdown-row">
                    <span>${currentLanguage === 'en' ? 'Standard Period' : 'Âπ≥Â≥∞Êó∂ÊÆµ'}</span>
                    <span>${standardStart}-${standardEnd}</span>
                    <span>‚Çπ${standardRate.toFixed(2)}</span>
                    <span>${standardUsage}</span>
                    <span>‚Çπ${standardCost.toFixed(2)}</span>
                </div>
                <div class="breakdown-row">
                    <span>${currentLanguage === 'en' ? 'Valley Period' : 'Ë∞∑ÂÄºÊó∂ÊÆµ'}</span>
                    <span>${valleyStart}-${valleyEnd}</span>
                    <span>‚Çπ${valleyRate.toFixed(2)}</span>
                    <span>${valleyUsage}</span>
                    <span>‚Çπ${valleyCost.toFixed(2)}</span>
                </div>
            `;

            document.getElementById('time-breakdown-rows').innerHTML = html;
            document.getElementById('time-subtotal').textContent = `‚Çπ${Math.round(subtotal)}`;
        }

        // Êõ¥Êñ∞Âõ∫ÂÆöÁîµ‰ª∑ÊòéÁªÜ
        function updateFlatBreakdown(rate, usage, total) {
            document.getElementById('flat-rate-display').textContent = `‚Çπ${rate.toFixed(2)}/kWh`;
            document.getElementById('flat-usage-display').textContent = `${usage} kWh`;
            document.getElementById('flat-total-display').textContent = `‚Çπ${Math.round(total)}`;
        }

        // ‰øùÂ≠òÊ®°Êùø
        function saveTemplate() {
            const currentLanguage = getCurrentLanguage();
            const message = currentLanguage === 'en' ? 'Template saved as draft' : 'Ê®°ÊùøÂ∑≤‰øùÂ≠ò‰∏∫ËçâÁ®ø';
            alert(message);
        }

        // ‰øùÂ≠òËçâÁ®ø
        function saveDraft() {
            const currentLanguage = getCurrentLanguage();
            const message = currentLanguage === 'en' ? 'Draft saved' : 'ËçâÁ®øÂ∑≤‰øùÂ≠ò';
            alert(message);
        }

        // ÂèëÂ∏ÉÊ®°Êùø
        function publishTemplate() {
            const currentLanguage = getCurrentLanguage();
            const message = currentLanguage === 'en' ? 'Template published successfully' : 'Ê®°ÊùøÂ∑≤ÂèëÂ∏ÉÊàêÂäü';
            alert(message);

            // Ê†áËÆ∞Áîµ‰ª∑Ê®°ÊùøÊµÅÁ®ã‰∏∫ÂÆåÊàê
            if (window.markStepCompleted) {
                window.markStepCompleted('template');
            } else {
                // Ë∑®È°µÈù¢ÈÄö‰ø°Ôºå‰øùÂ≠òÂÆåÊàêÁä∂ÊÄÅ
                let workflowProgress = JSON.parse(localStorage.getItem('workflowProgress') || '{}');
                workflowProgress.template = true;
                localStorage.setItem('workflowProgress', JSON.stringify(workflowProgress));
            }

            // Ë∑≥ËΩ¨ÂõûÁîµ‰ª∑Ê®°ÁâàÈ°µÈù¢
            setTimeout(() => {
                window.location.href = 'pricing-templates.html';
            }, 1500);
        }

        // ËøîÂõûÁîµ‰ª∑Ê®°ÁâàÈ°µÈù¢
        function goBackToPricingTemplates() {
            window.location.href = 'pricing-templates.html';
        }

        // Êõ¥Êñ∞Ê≠•È™§5ÁöÑÈÖçÁΩÆÊ±áÊÄª
        function updateConfigurationSummary() {
            const currentLanguage = getCurrentLanguage();

            // Âü∫Êú¨ÈÖçÁΩÆ
            const templateName = document.getElementById('template-name').value || '-';
            const billingPeriod = document.getElementById('billing-period');
            const billingDate = document.getElementById('billing-date');

            document.getElementById('summary-template-name').textContent = templateName;
            document.getElementById('summary-billing-cycle').textContent = billingPeriod.options[billingPeriod.selectedIndex].text;
            document.getElementById('summary-billing-date').textContent = billingDate.options[billingDate.selectedIndex].text;

            // Ë¥πÁéáÁªìÊûÑ
            const tariffType = document.getElementById('tariff-type').value;
            const tariffTypeText = {
                'flat': currentLanguage === 'en' ? 'Flat Rate' : 'Âõ∫ÂÆöÂçï‰ª∑',
                'tiered': currentLanguage === 'en' ? 'Tiered Rate' : 'Èò∂Ê¢ØÁîµ‰ª∑',
                'time-of-use': currentLanguage === 'en' ? 'Time-of-Use' : 'ÂàÜÊó∂Áîµ‰ª∑'
            };

            document.getElementById('summary-tariff-type').textContent = tariffTypeText[tariffType] || '-';

            // ÈöêËóèÊâÄÊúâË¥πÁéáËØ¶ÊÉÖ
            document.querySelectorAll('.tariff-detail-summary').forEach(detail => {
                detail.style.display = 'none';
            });

            // ÊòæÁ§∫ÂØπÂ∫îÁöÑË¥πÁéáËØ¶ÊÉÖ
            switch (tariffType) {
                case 'flat':
                    document.getElementById('flat-summary').style.display = 'block';
                    const flatRate = document.getElementById('flat-rate').value;
                    document.getElementById('summary-flat-rate').textContent = `‚Çπ${flatRate}/kWh`;
                    break;

                case 'tiered':
                    document.getElementById('tiered-summary').style.display = 'block';
                    updateTieredSummary();
                    break;

                case 'time-of-use':
                    document.getElementById('time-of-use-summary').style.display = 'block';
                    updateTimeOfUseSummary();
                    break;
            }

            // ÈôÑÂä†Ë¥πÁî®Ê±áÊÄª
            updateChargesSummary();
        }

        // Êõ¥Êñ∞Èò∂Ê¢ØÁîµ‰ª∑Ê±áÊÄª
        function updateTieredSummary() {
            const tierItems = document.querySelectorAll('.tier-item');
            const summaryRows = document.getElementById('tiered-summary-rows');
            let html = '';

            tierItems.forEach((tier, index) => {
                const tierLabel = tier.querySelector('.tier-label').textContent;
                const tierRate = parseFloat(tier.querySelector('.tier-rate').value) || 0;
                const tierMaxInput = tier.querySelector('.tier-max');

                let rangeText;
                if (tierMaxInput.value === 'Êó†ÈôêÂà∂' || tierMaxInput.value === 'Unlimited') {
                    const tierMin = index === 0 ? 0 : parseFloat(tierItems[index - 1].querySelector('.tier-max').value) + 1;
                    rangeText = `${tierMin}+`;
                } else {
                    const tierMin = index === 0 ? 0 : parseFloat(tierItems[index - 1].querySelector('.tier-max').value) + 1;
                    const tierMax = parseFloat(tierMaxInput.value) || 0;
                    rangeText = `${tierMin}-${tierMax}`;
                }

                html += `
                    <div class="detail-row">
                        <span>${tierLabel}</span>
                        <span>${rangeText}</span>
                        <span>‚Çπ${tierRate.toFixed(2)}</span>
                    </div>
                `;
            });

            summaryRows.innerHTML = html;
        }

        // Êõ¥Êñ∞ÂàÜÊó∂Áîµ‰ª∑Ê±áÊÄª
        function updateTimeOfUseSummary() {
            const periodItems = document.querySelectorAll('.time-period-item');
            const summaryRows = document.getElementById('time-of-use-summary-rows');
            let html = '';

            periodItems.forEach(period => {
                const periodName = period.querySelector('.editable-period-name').textContent;
                const timeStart = period.querySelector('.time-start').value;
                const timeEnd = period.querySelector('.time-end').value;
                const rate = parseFloat(period.querySelector('.period-rate').value) || 0;

                html += `
                    <div class="detail-row">
                        <span>${periodName}</span>
                        <span>${timeStart}-${timeEnd}</span>
                        <span>‚Çπ${rate.toFixed(2)}</span>
                    </div>
                `;
            });

            summaryRows.innerHTML = html;
        }

        // Êõ¥Êñ∞ÈôÑÂä†Ë¥πÁî®Ê±áÊÄª
        function updateChargesSummary() {
            const chargeItems = document.querySelectorAll('.charge-item');
            const summaryRows = document.getElementById('charges-summary-rows');
            const currentLanguage = getCurrentLanguage();
            let html = '';

            chargeItems.forEach(item => {
                const chargeName = item.querySelector('h5').textContent;
                const chargeMethod = item.querySelector('.charge-method');
                const chargeAmount = item.querySelector('.charge-amount');
                const chargeUnit = item.querySelector('.charge-unit');

                let methodText = '';
                switch (chargeMethod.value) {
                    case 'fixed':
                        methodText = currentLanguage === 'en' ? 'Fixed Amount' : 'Âõ∫ÂÆöÈáëÈ¢ù';
                        break;
                    case 'percentage':
                        methodText = currentLanguage === 'en' ? 'Percentage' : 'ÁôæÂàÜÊØî';
                        break;
                    case 'per-unit':
                        methodText = currentLanguage === 'en' ? 'Per Unit' : 'ÊåâÁî®ÁîµÈáè';
                        break;
                }

                html += `
                    <div class="detail-row">
                        <span>${chargeName}</span>
                        <span>${methodText}</span>
                        <span>${chargeAmount.value}${chargeUnit.textContent}</span>
                    </div>
                `;
            });

            summaryRows.innerHTML = html;
        }

        // Âú®ÂàáÊç¢Âà∞Ê≠•È™§5Êó∂Êõ¥Êñ∞Ê±áÊÄª
        function showStep(step) {
            // ÈöêËóèÊâÄÊúâÊ≠•È™§ÂÜÖÂÆπ
            const panels = document.querySelectorAll('.step-content-panel');
            panels.forEach(panel => {
                panel.classList.remove('active');
            });

            // ÊòæÁ§∫ÂΩìÂâçÊ≠•È™§ÂÜÖÂÆπ
            const currentPanel = document.getElementById(`step-${step}`);
            if (currentPanel) {
                currentPanel.classList.add('active');
            }

            // Êõ¥Êñ∞Ê≠•È™§ÂØºËà™Ê†∑Âºè
            const stepItems = document.querySelectorAll('.step-item');
            stepItems.forEach((item, index) => {
                item.classList.remove('active');
                if (index + 1 === step) {
                    item.classList.add('active');
                }
            });

            // Â¶ÇÊûúÊòØÊ≠•È™§5ÔºåÊõ¥Êñ∞ÈÖçÁΩÆÊ±áÊÄª
            if (step === 5) {
                updateConfigurationSummary();
            }
        }

        // ÁîµË¥πÁ±ªÂûãÂç°ÁâáÈÄâÊã©
        function selectTariffType(type) {
            // ÁßªÈô§ÊâÄÊúâÂç°ÁâáÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.tariff-card').forEach(card => {
                card.classList.remove('selected');
            });

            // ÈÄâ‰∏≠ÂΩìÂâçÂç°Áâá
            const selectedCard = document.querySelector(`[data-type="${type}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }

            // Êõ¥Êñ∞ÈöêËóèÂ≠óÊÆµ
            document.getElementById('tariff-type').value = type;

            // ÊòæÁ§∫ÂØπÂ∫îÁöÑÈÖçÁΩÆÂå∫ÂüüÔºàÂ¶ÇÊûúÈúÄË¶ÅÁöÑËØùÔºâ
            showTariffSettings(type);

            // Êõ¥Êñ∞ÊµãËØïËæìÂÖ•ÁïåÈù¢
            updateTestInputs();

            console.log('Selected tariff type:', type);
        }

        // ÊòæÁ§∫ÂØπÂ∫îÁöÑË¥πÁéáËÆæÁΩÆÂå∫Âüü
        function showTariffSettings(type) {
            // ÈöêËóèÊâÄÊúâËÆæÁΩÆÂå∫Âüü
            document.querySelectorAll('.tariff-settings').forEach(setting => {
                setting.style.display = 'none';
            });

            // ÊòæÁ§∫ÂØπÂ∫îÁöÑËÆæÁΩÆÂå∫Âüü
            const settingId = type + '-settings';
            const settingElement = document.getElementById(settingId);
            if (settingElement) {
                settingElement.style.display = 'block';
            }
        }

        // Èò∂Ê¢ØÁîµ‰ª∑ÁÆ°ÁêÜÂáΩÊï∞
        let tierCounter = 3;

        function addTier() {
            tierCounter++;
            const tiersContainer = document.getElementById('tiers-container');
            const lastTier = tiersContainer.lastElementChild;

            // Êõ¥Êñ∞ÊúÄÂêé‰∏Ä‰∏™Èò∂Ê¢ØÁöÑÊúÄÂ§ßÂÄº‰∏∫Êï∞Â≠ó
            const lastTierMax = lastTier.querySelector('.tier-max');
            if (lastTierMax.value === 'Êó†ÈôêÂà∂' || lastTierMax.value === 'Unlimited') {
                lastTierMax.type = 'number';
                lastTierMax.value = '500';
                lastTierMax.removeAttribute('readonly');
                lastTierMax.setAttribute('onchange', 'updateTierRanges()');
            }

            const newTierItem = document.createElement('div');
            newTierItem.className = 'tier-item';
            newTierItem.setAttribute('data-tier', tierCounter);

            const currentLanguage = getCurrentLanguage();
            const tierLabel = currentLanguage === 'en' ? `Tier ${tierCounter}` : `Á¨¨${getChineseNumber(tierCounter)}Èò∂Ê¢Ø`;

            newTierItem.innerHTML = `
                <div class="tier-header">
                    <span class="tier-label" data-zh="Á¨¨${getChineseNumber(tierCounter)}Èò∂Ê¢Ø" data-en="Tier ${tierCounter}">${tierLabel}</span>
                    <button type="button" class="btn-remove" onclick="removeTier(${tierCounter})">
                        <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                    </button>
                </div>
                <div class="tier-config">
                    <div class="tier-range">
                        <label data-zh="Áî®ÁîµËåÉÂõ¥ (kWh)" data-en="Usage Range (kWh)">Áî®ÁîµËåÉÂõ¥ (kWh)</label>
                        <div class="range-inputs">
                            <input type="number" class="form-input tier-min" value="${parseInt(lastTierMax.value) + 1}" min="0" readonly>
                            <span>-</span>
                            <input type="text" class="form-input tier-max" value="${currentLanguage === 'en' ? 'Unlimited' : 'Êó†ÈôêÂà∂'}" data-zh="Êó†ÈôêÂà∂" data-en="Unlimited" readonly>
                        </div>
                    </div>
                    <div class="tier-price">
                        <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                        <input type="number" class="form-input tier-rate" value="10.00" min="0" step="0.01">
                    </div>
                </div>
            `;

            tiersContainer.appendChild(newTierItem);
            updateTierRanges();
        }

        function removeTier(tierNumber) {
            if (tierNumber === 1) return; // ‰∏çËÉΩÂà†Èô§Á¨¨‰∏ÄÈò∂Ê¢Ø

            const tierItem = document.querySelector(`[data-tier="${tierNumber}"]`);
            if (tierItem) {
                tierItem.remove();
                updateTierRanges();
                updateTierLabels();
            }
        }

        function updateTierRanges() {
            const tierItems = document.querySelectorAll('.tier-item');

            tierItems.forEach((tier, index) => {
                const tierMin = tier.querySelector('.tier-min');
                const tierMax = tier.querySelector('.tier-max');

                if (index === 0) {
                    tierMin.value = 0;
                } else {
                    const prevTierMax = tierItems[index - 1].querySelector('.tier-max');
                    tierMin.value = parseInt(prevTierMax.value) + 1;
                }

                // ÊúÄÂêé‰∏Ä‰∏™Èò∂Ê¢ØËÆæ‰∏∫Êó†ÈôêÂà∂
                if (index === tierItems.length - 1) {
                    const currentLanguage = getCurrentLanguage();
                    tierMax.type = 'text';
                    tierMax.value = currentLanguage === 'en' ? 'Unlimited' : 'Êó†ÈôêÂà∂';
                    tierMax.setAttribute('data-zh', 'Êó†ÈôêÂà∂');
                    tierMax.setAttribute('data-en', 'Unlimited');
                    tierMax.setAttribute('readonly', true);
                }
            });
        }

        function updateTierLabels() {
            const tierItems = document.querySelectorAll('.tier-item');
            const currentLanguage = getCurrentLanguage();

            tierItems.forEach((tier, index) => {
                const tierNumber = index + 1;
                tier.setAttribute('data-tier', tierNumber);

                const tierLabel = tier.querySelector('.tier-label');
                const removeBtn = tier.querySelector('.btn-remove');

                if (currentLanguage === 'en') {
                    tierLabel.textContent = `Tier ${tierNumber}`;
                } else {
                    tierLabel.textContent = `Á¨¨${getChineseNumber(tierNumber)}Èò∂Ê¢Ø`;
                }

                tierLabel.setAttribute('data-zh', `Á¨¨${getChineseNumber(tierNumber)}Èò∂Ê¢Ø`);
                tierLabel.setAttribute('data-en', `Tier ${tierNumber}`);

                // Á¨¨‰∏ÄÈò∂Ê¢Ø‰∏çËÉΩÂà†Èô§
                if (tierNumber === 1) {
                    removeBtn.style.display = 'none';
                } else {
                    removeBtn.style.display = 'block';
                    removeBtn.setAttribute('onclick', `removeTier(${tierNumber})`);
                }
            });
        }

        function getChineseNumber(num) {
            const numbers = ['', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', '‰∏É', 'ÂÖ´', '‰πù', 'ÂçÅ'];
            return numbers[num] || num.toString();
        }

        // ÂàÜÊó∂Áîµ‰ª∑Êó∂ÊÆµÁÆ°ÁêÜÂáΩÊï∞
        let periodCounter = 3;

        function addTimePeriod() {
            periodCounter++;
            const periodsContainer = document.getElementById('time-periods-container');
            const currentLanguage = getCurrentLanguage();

            const periodId = `custom-period-${periodCounter}`;
            const periodName = currentLanguage === 'en' ? `Custom Period ${periodCounter}` : `Ëá™ÂÆö‰πâÊó∂ÊÆµ${periodCounter}`;

            const newPeriodItem = document.createElement('div');
            newPeriodItem.className = 'time-period-item';
            newPeriodItem.setAttribute('data-period', periodId);

            newPeriodItem.innerHTML = `
                <div class="period-header">
                    <div class="period-icon-select">
                        <select class="form-input period-icon-dropdown" onchange="updatePeriodIcon(this)">
                            <option value="üî¥">üî¥</option>
                            <option value="üü°">üü°</option>
                            <option value="üü¢">üü¢</option>
                            <option value="üîµ" selected>üîµ</option>
                            <option value="üü†">üü†</option>
                            <option value="üü£">üü£</option>
                        </select>
                    </div>
                    <h5 contenteditable="true" class="editable-period-name" data-zh="${periodName}" data-en="${periodName}">${periodName}</h5>
                    <button type="button" class="btn-remove-period" onclick="removeTimePeriod('${periodId}')">
                        <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                    </button>
                </div>
                <div class="period-config">
                    <div class="time-range">
                        <label data-zh="Êó∂Èó¥ÊÆµ" data-en="Time Range">Êó∂Èó¥ÊÆµ</label>
                        <div class="time-inputs">
                            <input type="time" class="form-input time-start" value="00:00">
                            <span>-</span>
                            <input type="time" class="form-input time-end" value="01:00">
                        </div>
                    </div>
                    <div class="period-price">
                        <label data-zh="Áîµ‰ª∑ (‚Çπ/kWh)" data-en="Rate (‚Çπ/kWh)">Áîµ‰ª∑ (‚Çπ/kWh)</label>
                        <input type="number" class="form-input period-rate" value="5.00" min="0" step="0.01">
                    </div>
                </div>
            `;

            periodsContainer.appendChild(newPeriodItem);
            updateTimeOfUseTestInputs();
        }

        function removeTimePeriod(periodId) {
            // Á¨¨‰∏Ä‰∏™Êó∂ÊÆµ‰∏çËÉΩÂà†Èô§
            if (periodId === 'peak') return;

            const periodItem = document.querySelector(`[data-period="${periodId}"]`);
            if (periodItem) {
                periodItem.remove();
                updateTimeOfUseTestInputs();
            }
        }

        function updatePeriodIcon(selectElement) {
            const selectedIcon = selectElement.value;
            // ÂõæÊ†áÂ∑≤ÁªèÂú®dropdown‰∏≠ÊòæÁ§∫Ôºå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂ§ÑÁêÜ
            console.log('Period icon updated to:', selectedIcon);
        }

        function updateTimeOfUseTestInputs() {
            const timeTestContainer = document.getElementById('time-of-use-test-inputs');
            const timeUsageInputs = timeTestContainer.querySelector('.time-usage-inputs');
            const periodItems = document.querySelectorAll('.time-period-item');

            // Ê∏ÖÁ©∫Áé∞ÊúâËæìÂÖ•Ê°Ü
            timeUsageInputs.innerHTML = '';

            // ‰∏∫ÊØè‰∏™Êó∂ÊÆµÂàõÂª∫ËæìÂÖ•Ê°Ü
            periodItems.forEach(period => {
                const periodId = period.getAttribute('data-period');
                const periodName = period.querySelector('.editable-period-name').textContent;

                const usagePeriodDiv = document.createElement('div');
                usagePeriodDiv.className = 'usage-period';

                usagePeriodDiv.innerHTML = `
                    <label>${periodName}Áî®ÁîµÈáè(kWh)</label>
                    <input type="number" id="${periodId}-usage" class="form-input" value="50" min="0" step="1" onchange="updateTotalTimeUsageFromInputs()">
                `;

                timeUsageInputs.appendChild(usagePeriodDiv);
            });
        }

        function updateTotalTimeUsageFromInputs() {
            const periodItems = document.querySelectorAll('.time-period-item');
            let total = 0;

            periodItems.forEach(period => {
                const periodId = period.getAttribute('data-period');
                const usageInput = document.getElementById(`${periodId}-usage`);
                if (usageInput) {
                    total += parseFloat(usageInput.value) || 0;
                }
            });

            document.getElementById('total-usage-display').textContent = `${total} kWh`;
            return total;
        }

        // ÈôÑÂä†Ë¥πÁî®ÁÆ°ÁêÜÂáΩÊï∞
        let chargeCounter = 3;

        function addAdditionalCharge() {
            chargeCounter++;
            const chargesContainer = document.getElementById('additional-charges-container');
            const currentLanguage = getCurrentLanguage();

            const chargeId = `custom-charge-${chargeCounter}`;
            const chargeName = currentLanguage === 'en' ? `Custom Charge ${chargeCounter}` : `Ëá™ÂÆö‰πâË¥πÁî®${chargeCounter}`;

            const newChargeItem = document.createElement('div');
            newChargeItem.className = 'charge-item';
            newChargeItem.setAttribute('data-charge-id', chargeId);

            newChargeItem.innerHTML = `
                <div class="charge-header">
                    <div class="charge-info">
                        <h5 contenteditable="true" class="editable-title" data-zh="${chargeName}" data-en="${chargeName}">${chargeName}</h5>
                        <p contenteditable="true" class="editable-desc" data-zh="ËØ∑ËæìÂÖ•Ë¥πÁî®ËØ¥Êòé" data-en="Enter charge description">ËØ∑ËæìÂÖ•Ë¥πÁî®ËØ¥Êòé</p>
                    </div>
                    <button type="button" class="btn-remove-charge" onclick="removeAdditionalCharge('${chargeId}')">
                        <span data-zh="Âà†Èô§" data-en="Remove">Âà†Èô§</span>
                    </button>
                </div>
                <div class="charge-config">
                    <div class="charge-type">
                        <label data-zh="ËÆ°Ë¥πÊñπÂºè" data-en="Billing Method">ËÆ°Ë¥πÊñπÂºè</label>
                        <select class="form-input charge-method" onchange="updateChargeConfig(this)">
                            <option value="fixed" data-zh="Âõ∫ÂÆöÈáëÈ¢ù" data-en="Fixed Amount">Âõ∫ÂÆöÈáëÈ¢ù</option>
                            <option value="percentage" data-zh="ÁôæÂàÜÊØî" data-en="Percentage">ÁôæÂàÜÊØî</option>
                            <option value="per-unit" data-zh="ÊåâÁî®ÁîµÈáè" data-en="Per Unit">ÊåâÁî®ÁîµÈáè</option>
                        </select>
                    </div>
                    <div class="charge-value">
                        <label data-zh="Ë¥πÁî®ÈáëÈ¢ù" data-en="Amount">Ë¥πÁî®ÈáëÈ¢ù</label>
                        <div class="value-input-group">
                            <input type="number" class="form-input charge-amount" value="0" min="0" step="0.01">
                            <span class="charge-unit" data-zh="‚Çπ/Êúà" data-en="‚Çπ/month">‚Çπ/Êúà</span>
                        </div>
                    </div>
                </div>
            `;

            chargesContainer.appendChild(newChargeItem);

            // ‰∏∫Êñ∞Ê∑ªÂä†ÁöÑÂÖÉÁ¥†Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
            const newAmountInput = newChargeItem.querySelector('.charge-amount');
            const newMethodSelect = newChargeItem.querySelector('.charge-method');

            newAmountInput.addEventListener('input', updateChargesPreview);
            newMethodSelect.addEventListener('change', updateChargesPreview);

            updateChargesPreview();
        }

        function removeAdditionalCharge(chargeId) {
            // Âõ∫ÂÆöË¥π‰∏çËÉΩÂà†Èô§
            if (chargeId === 'fixed-fee') return;

            const chargeItem = document.querySelector(`[data-charge-id="${chargeId}"]`);
            if (chargeItem) {
                chargeItem.remove();
                updateChargesPreview();
            }
        }

        function updateChargeConfig(selectElement) {
            const chargeItem = selectElement.closest('.charge-item');
            const chargeUnit = chargeItem.querySelector('.charge-unit');
            const selectedMethod = selectElement.value;
            const currentLanguage = getCurrentLanguage();

            switch (selectedMethod) {
                case 'fixed':
                    const fixedUnit = currentLanguage === 'en' ? '‚Çπ/month' : '‚Çπ/Êúà';
                    chargeUnit.textContent = fixedUnit;
                    chargeUnit.setAttribute('data-zh', '‚Çπ/Êúà');
                    chargeUnit.setAttribute('data-en', '‚Çπ/month');
                    break;
                case 'percentage':
                    chargeUnit.textContent = '%';
                    chargeUnit.setAttribute('data-zh', '%');
                    chargeUnit.setAttribute('data-en', '%');
                    break;
                case 'per-unit':
                    chargeUnit.textContent = '‚Çπ/kWh';
                    chargeUnit.setAttribute('data-zh', '‚Çπ/kWh');
                    chargeUnit.setAttribute('data-en', '‚Çπ/kWh');
                    break;
            }

            updateChargesPreview();
        }

        function updateChargesPreview() {
            const previewContainer = document.getElementById('charges-preview');
            const chargeItems = document.querySelectorAll('.charge-item');
            const currentLanguage = getCurrentLanguage();

            let previewHTML = '';

            chargeItems.forEach(item => {
                const chargeName = item.querySelector('h5').textContent;
                const chargeMethod = item.querySelector('.charge-method');
                const chargeAmount = item.querySelector('.charge-amount');
                const chargeUnit = item.querySelector('.charge-unit');

                let methodText = '';
                switch (chargeMethod.value) {
                    case 'fixed':
                        methodText = currentLanguage === 'en' ? 'Fixed Amount' : 'Âõ∫ÂÆöÈáëÈ¢ù';
                        break;
                    case 'percentage':
                        methodText = currentLanguage === 'en' ? 'Percentage' : 'ÁôæÂàÜÊØî';
                        break;
                    case 'per-unit':
                        methodText = currentLanguage === 'en' ? 'Per Unit' : 'ÊåâÁî®ÁîµÈáè';
                        break;
                }

                previewHTML += `
                    <div class="summary-row">
                        <span>${chargeName}</span>
                        <span>${methodText}</span>
                        <span>${chargeAmount.value}${chargeUnit.textContent}</span>
                    </div>
                `;
            });

            previewContainer.innerHTML = previewHTML;
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñÈ¢ÑËßà
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateChargesPreview();
                // ‰∏∫Áé∞ÊúâÁöÑËæìÂÖ•Ê°ÜÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                addChargeEventListeners();
            }, 100);
        });

        function addChargeEventListeners() {
            // ‰∏∫ÊâÄÊúâË¥πÁî®ÈáëÈ¢ùËæìÂÖ•Ê°ÜÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.querySelectorAll('.charge-amount').forEach(input => {
                input.addEventListener('input', updateChargesPreview);
            });

            // ‰∏∫ÊâÄÊúâËÆ°Ë¥πÊñπÂºèÈÄâÊã©Ê°ÜÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.querySelectorAll('.charge-method').forEach(select => {
                select.addEventListener('change', updateChargesPreview);
            });
        }

        // Êõ¥Êñ∞"Êó†ÈôêÂà∂"ÊñáÊú¨ÁöÑËØ≠Ë®Ä
        function updateUnlimitedTexts() {
            const currentLanguage = getCurrentLanguage();
            const unlimitedInputs = document.querySelectorAll('input[data-zh="Êó†ÈôêÂà∂"]');

            unlimitedInputs.forEach(input => {
                if (input.value === 'Êó†ÈôêÂà∂' || input.value === 'Unlimited') {
                    input.value = currentLanguage === 'en' ? 'Unlimited' : 'Êó†ÈôêÂà∂';
                }
            });
        }

        // ‰øùÊåÅÂêëÂêéÂÖºÂÆπÊÄß
        function selectBillingMethodFromDropdown(value) {
            selectTariffType(value);
        }
    </script>

    <style>
        /* È°µÈù¢Ê†áÈ¢òÊ†∑Âºè */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-8);
        }

        .header-center {
            flex: 1;
            text-align: center;
        }

        .header-center h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-left,
        .header-right {
            flex: 0 0 auto;
            padding: var(--space-6) var(--space-8) 0 var(--space-8);
            gap: var(--space-6);
        }

        .header-left {
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
        }

        .header-text {
            display: flex;
            flex-direction: column;
        }

        .header-title-section {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-1);
        }

        .header-title-section h1 {
            font-size: 28px;
            font-weight: var(--font-weight-medium);
            margin: 0;
            color: var(--text-primary);
        }

        .template-type {
            background: var(--surface);
            color: var(--text-secondary);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: var(--font-weight-medium);
        }

        /* ËÆæËÆ°Âô®Â∏ÉÂ±ÄÊ†∑Âºè */
        .designer-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .steps-sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e9ecef;
            padding: 32px 24px;
        }

        .steps-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 8px 0;
        }

        .steps-header p {
            color: #718096;
            font-size: 14px;
            margin: 0 0 32px 0;
        }

        .step-item {
            display: flex;
            align-items: center;
            padding: 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .step-item:hover {
            background: #f7fafc;
        }

        .step-item.active {
            background: #000;
            color: white;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .step-item.active .step-number {
            background: white;
            color: #000;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .step-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        .content-area {
            flex: 1;
            background: #f8f9fa;
            padding: 32px;
            overflow-y: auto;
        }

        .step-content-panel {
            display: none;
            width: 100%;
            max-width: none;
        }

        .step-content-panel.active {
            display: block;
        }

        /* ËÆæÁΩÆÈ°µÈù¢Ê†∑Âºè - ÂèÇËÄÉÁ≥ªÁªüËÆæÁΩÆ */
        .settings-section {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
            width: 100%;
            box-sizing: border-box;
        }

        .section-header {
            margin-bottom: 24px;
            border-bottom: 1px solid #f1f3f4;
            padding-bottom: 16px;
        }

        .section-header h3 {
            color: #2d3748;
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 8px 0;
        }

        .section-header p {
            color: #718096;
            font-size: 14px;
            margin: 0;
        }

        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #374151;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-select {
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Èò∂Ê¢ØÁîµ‰ª∑ËÆæÁΩÆÊ†∑Âºè */
        .tariff-settings {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-header h4 {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #000;
            color: #000;
        }

        .btn-outline:hover {
            background: #000;
            color: white;
        }

        /* Èò∂Ê¢ØÈ°πÁõÆÊ†∑Âºè */
        .tier-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .tier-header {
            background: #f8f9fa;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tier-label {
            font-weight: 600;
            color: #2d3748;
        }

        .btn-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .btn-remove:hover {
            background: #dc2626;
        }

        .tier-config {
            padding: 16px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .tier-range label,
        .tier-price label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .range-inputs,
        .time-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .range-inputs input,
        .time-inputs input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }

        .range-inputs span,
        .time-inputs span {
            color: #6b7280;
            font-weight: 500;
        }

        /* ÂàÜÊó∂Áîµ‰ª∑Ê†∑Âºè */
        .time-period-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .period-header {
            background: #f8f9fa;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .period-icon {
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .period-header h5 {
            margin: 0;
            color: #2d3748;
            font-weight: 600;
        }

        /* Êó∂ÊÆµÂõæÊ†áÈÄâÊã©ÂíåÁºñËæëÊ†∑Âºè */
        .period-icon-select {
            margin-right: 12px;
        }

        .period-icon-dropdown {
            width: 60px;
            padding: 4px 8px;
            font-size: 16px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
        }

        .editable-period-name {
            outline: none;
            border: 1px solid transparent;
            padding: 2px 4px;
            border-radius: 4px;
            transition: border-color 0.2s ease;
            flex: 1;
        }

        .editable-period-name:focus {
            border-color: #3b82f6;
            background: white;
        }

        .btn-remove-period {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .btn-remove-period:hover {
            background: #dc2626;
        }

        .period-config {
            padding: 16px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .time-range label,
        .period-price label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        /* Âõ∫ÂÆöÁîµ‰ª∑Ê†∑Âºè */
        .flat-rate-config {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }

        .flat-rate-config .form-group {
            margin-bottom: 16px;
        }

        .flat-rate-config .form-group:last-child {
            margin-bottom: 0;
        }

        /* ÈôÑÂä†Ë¥πÁî®Ê†∑Âºè */
        .additional-charges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .additional-charges-header h4 {
            margin: 0;
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
        }

        .charge-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .charge-header {
            background: #f8f9fa;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .charge-info h5 {
            margin: 0 0 4px 0;
            color: #2d3748;
            font-weight: 600;
            font-size: 16px;
        }

        .charge-info p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        .editable-title,
        .editable-desc {
            outline: none;
            border: 1px solid transparent;
            padding: 2px 4px;
            border-radius: 4px;
            transition: border-color 0.2s ease;
        }

        .editable-title:focus,
        .editable-desc:focus {
            border-color: #3b82f6;
            background: white;
        }

        .btn-remove-charge {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .btn-remove-charge:hover {
            background: #dc2626;
        }

        .charge-config {
            padding: 16px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .charge-type label,
        .charge-value label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .value-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .value-input-group input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }

        .charge-unit {
            color: #6b7280;
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
        }

        /* Ë¥πÁî®È¢ÑËßàÊ†∑Âºè */
        .charges-summary {
            margin-top: 24px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }

        .charges-summary h4 {
            margin: 0 0 16px 0;
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
        }

        .summary-table {
            width: 100%;
        }

        .summary-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-row.header {
            font-weight: 600;
            color: #374151;
            background: #f8f9fa;
            padding: 12px 16px;
            margin: 0 -16px 8px -16px;
            border-radius: 4px;
        }

        .summary-row:not(.header) {
            color: #6b7280;
        }

        .summary-row span:last-child {
            font-weight: 500;
            color: #2d3748;
        }

        /* Ë¥πÁéáÊµãËØïÊ†∑Âºè */
        .test-inputs-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .time-usage-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .usage-period {
            display: flex;
            flex-direction: column;
        }

        .usage-period label {
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .total-usage {
            text-align: center;
            padding: 12px;
            background: #f3f4f6;
            border-radius: 6px;
            font-weight: 600;
            color: #2d3748;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-header h4 {
            margin: 0;
            color: #2d3748;
            font-size: 18px;
            font-weight: 600;
        }

        /* Ë¥¶ÂçïÊ±áÊÄªË°®Ê†∑Âºè */
        .bill-summary-table {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .bill-table-header {
            background: #f8f9fa;
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            gap: 16px;
            padding: 16px;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .bill-item {
            display: grid;
            grid-template-columns: 2fr 1fr 2fr;
            gap: 16px;
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            align-items: center;
        }

        .bill-item:last-child {
            border-bottom: none;
        }

        .bill-item.total {
            background: #f8f9fa;
            font-weight: 600;
            color: #2d3748;
            border-top: 2px solid #e5e7eb;
        }

        .bill-item span:nth-child(2) {
            font-weight: 600;
            color: #059669;
        }

        .bill-item.total span:nth-child(2) {
            color: #dc2626;
            font-size: 18px;
        }

        /* ÁîµÈáèË¥πÊòéÁªÜÊ†∑Âºè */
        .electricity-detail {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .detail-header {
            background: #f8f9fa;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-header h5 {
            margin: 0;
            color: #2d3748;
            font-weight: 600;
        }

        .detail-toggle {
            background: white;
            color: #000;
            border: 1px solid #000;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .detail-toggle:hover {
            background: #f8f9fa;
        }

        .detail-breakdown {
            padding: 16px;
        }

        .breakdown-table {
            width: 100%;
        }

        .breakdown-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 12px;
            padding: 12px 0;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 8px;
        }

        .breakdown-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
            color: #6b7280;
        }

        .breakdown-row:last-child {
            border-bottom: none;
        }

        .breakdown-subtotal {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 12px;
            padding: 12px 0;
            border-top: 2px solid #e5e7eb;
            font-weight: 600;
            color: #2d3748;
            margin-top: 8px;
        }

        .breakdown-simple {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            color: #2d3748;
            justify-content: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .breakdown-simple span:last-child {
            font-weight: 600;
            color: #059669;
        }

        /* ËÆ°ÁÆóÊåâÈíÆÂå∫ÂüüÊ†∑Âºè */
        .calculation-section {
            margin: 20px 0;
            text-align: left;
        }

        .calculate-btn {
            margin: 0;
        }


        /* ÈÖçÁΩÆÊ±áÊÄªÊ†∑Âºè */
        .summary-section {
            margin-bottom: 32px;
        }

        .summary-section h4 {
            color: #374151;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-table {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 16px;
        }

        .detail-header {
            background: #f8f9fa;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            padding: 12px 16px;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            color: #6b7280;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .tariff-detail-summary {
            margin-top: 16px;
        }

        .tier-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .tier-setting:last-child {
            margin-bottom: 0;
        }

        .tier-setting label {
            color: #4a5568;
            font-weight: 500;
            margin: 0;
        }

        .tier-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tier-input input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            text-align: right;
        }

        .tier-input .unit {
            color: #6b7280;
            font-size: 14px;
        }

        /* Ê≠•È™§ÂØºËà™Ê†∑Âºè */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        .nav-left {
            display: flex;
            gap: 12px;
        }

        .nav-right {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #000;
            color: white;
        }

        .btn-primary:hover {
            background: #374151;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* ËÆ°ÁÆóÁªìÊûúÊ†∑Âºè */
        .calculation-results {
            margin-top: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .calculation-results h4 {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 16px 0;
        }

        .result-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .result-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .result-label {
            color: #6b7280;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .result-value {
            color: #1f2937;
            font-size: 18px;
            font-weight: 600;
        }

        .result-value.total {
            color: #059669;
            font-size: 20px;
        }

        /* Ê±áÊÄªÁΩëÊ†ºÊ†∑Âºè */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-label {
            color: #4a5568;
            font-weight: 500;
        }

        .summary-value {
            color: #2d3748;
            font-weight: 600;
        }

        /* ÁîµË¥πÁ±ªÂûãÂç°ÁâáÊ†∑Âºè */
        .tariff-type-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .tariff-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tariff-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .tariff-card.selected {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #f8faff 0%, #f1f5ff 100%);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15);
        }

        .tariff-card.selected::before {
            content: '‚úì';
            position: absolute;
            top: 16px;
            right: 16px;
            background: #3b82f6;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .card-header {
            margin-bottom: 16px;
        }

        .card-icon {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        .card-header h4 {
            color: #1f2937;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .card-description {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
            margin: 0 0 16px 0;
        }

        .card-features {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .feature-tag {
            background: #f3f4f6;
            color: #374151;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .tariff-card.selected .feature-tag {
            background: #dbeafe;
            color: #1e40af;
        }

        /* ÂÖ®ÂÆΩË°®ÂçïÁªÑ */
        .form-group.full-width {
            grid-column: 1 / -1;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .designer-layout {
                flex-direction: column;
            }

            .steps-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .result-cards {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .tariff-type-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>