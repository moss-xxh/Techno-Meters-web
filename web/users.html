<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-zh="ç”¨æˆ·ç®¡ç†" data-en="User Management">ç”¨æˆ·ç®¡ç†</title>
    <link rel="stylesheet" href="assets/css/common.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <h1 data-zh="èƒ½æºç®¡ç†ç³»ç»Ÿ" data-en="Energy Management System">èƒ½æºç®¡ç†ç³»ç»Ÿ</h1>
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link" data-zh="ä»ªè¡¨ç›˜" data-en="Dashboard">ä»ªè¡¨ç›˜</a>
                <a href="device-management.html" class="nav-link" data-zh="è®¾å¤‡ç®¡ç†" data-en="Device Management">è®¾å¤‡ç®¡ç†</a>
                <a href="space-management.html" class="nav-link" data-zh="å»ºç­‘ç®¡ç†" data-en="Building Management">å»ºç­‘ç®¡ç†</a>
                <a href="user-management.html" class="nav-link active" data-zh="ç”¨æˆ·ç®¡ç†" data-en="User Management">ç”¨æˆ·ç®¡ç†</a>
                <a href="bills.html" class="nav-link" data-zh="è´¦å•ç®¡ç†" data-en="Bill Management">è´¦å•ç®¡ç†</a>
            </div>
            <div class="nav-actions" style="overflow: visible !important;">
                <div class="lang-dropdown">
                    <select id="language-select" class="form-select lang-select">
                        <option value="zh" data-zh="ä¸­æ–‡" data-en="Chinese">ä¸­æ–‡</option>
                        <option value="en" data-zh="English" data-en="English">English</option>
                    </select>
                </div>
                <div class="user-menu" style="position: relative; overflow: visible !important;">
                    <input type="checkbox" id="user-dropdown-toggle" style="display: none;">
                    <label for="user-dropdown-toggle" style="display: flex; align-items: center; cursor: pointer; gap: 8px;">
                        <div class="user-avatar">ç®¡</div>
                        <span data-zh="ç®¡ç†å‘˜" data-en="Admin">ç®¡ç†å‘˜</span>
                        <span style="font-size: 12px; margin-left: 4px;">â–¼</span>
                    </label>
                    <div class="dropdown-menu" style="position: fixed; top: 64px; right: 20px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); min-width: 120px; display: none; z-index: 9999; padding: 4px 0;">
                        <label for="logout-confirm-toggle" style="display: flex; align-items: center; padding: 12px 16px; color: #dc2626; font-size: 14px; cursor: pointer; gap: 8px;">
                            <span style="font-size: 16px;">ğŸšª</span>
                            <span data-zh="é€€å‡ºç™»å½•" data-en="Logout">é€€å‡ºç™»å½•</span>
                        </label>
                    </div>
                </div>
                <style>
                    #user-dropdown-toggle:checked + label + .dropdown-menu { display: block !important; }
                    #logout-confirm-toggle:checked + .logout-modal { display: flex !important; }
                </style>
            </div>
        </div>
    </nav>

    <!-- é€€å‡ºç¡®è®¤å¼¹çª— -->
    <input type="checkbox" id="logout-confirm-toggle" style="display: none;">
    <div class="logout-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; z-index: 99999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; padding: 32px; max-width: 420px; width: 90%; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);">
            <div style="text-align: center; font-size: 48px; margin-bottom: 20px;">âš ï¸</div>
            <h3 style="text-align: center; font-size: 20px; font-weight: 600; color: #1f2937; margin: 0 0 12px 0;">ç¡®è®¤é€€å‡º</h3>
            <p style="text-align: center; color: #6b7280; font-size: 16px; margin: 0 0 28px 0;">æ‚¨ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿé€€å‡ºåéœ€è¦é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <label for="logout-confirm-toggle" style="padding: 12px 24px; background: #f3f4f6; color: #374151; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; min-width: 80px; text-align: center;">å–æ¶ˆ</label>
                <a href="index.html" style="padding: 12px 24px; background: #dc2626; color: white; border-radius: 8px; text-decoration: none; font-size: 14px; font-weight: 500; min-width: 80px; text-align: center;">ç¡®è®¤é€€å‡º</a>
            </div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <div class="container">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="page-header">
                <h2 data-zh="ç”¨æˆ·ç®¡ç†" data-en="User Management">ç”¨æˆ·ç®¡ç†</h2>
                <p data-zh="ç®¡ç†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯å’Œè´¦æˆ·çŠ¶æ€" data-en="Manage system users and account status">ç®¡ç†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯å’Œè´¦æˆ·çŠ¶æ€</p>
            </div>

            <!-- ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡ -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">ğŸ‘¥</div>
                    <div class="metric-content">
                        <div class="metric-value">2,847</div>
                        <div class="metric-label" data-zh="æ€»ç”¨æˆ·æ•°" data-en="Total Users">æ€»ç”¨æˆ·æ•°</div>
                        <div class="metric-change positive">
                            <span>+12%</span>
                            <span data-zh="è¾ƒä¸Šæœˆ" data-en="vs last month">è¾ƒä¸Šæœˆ</span>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon">âœ…</div>
                    <div class="metric-content">
                        <div class="metric-value">2,715</div>
                        <div class="metric-label" data-zh="æ´»è·ƒç”¨æˆ·" data-en="Active Users">æ´»è·ƒç”¨æˆ·</div>
                        <div class="metric-change positive">
                            <span>+8.3%</span>
                            <span data-zh="è¾ƒä¸Šæœˆ" data-en="vs last month">è¾ƒä¸Šæœˆ</span>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon">ğŸ†•</div>
                    <div class="metric-content">
                        <div class="metric-value">156</div>
                        <div class="metric-label" data-zh="æœ¬æœˆæ–°å¢" data-en="New This Month">æœ¬æœˆæ–°å¢</div>
                        <div class="metric-change positive">
                            <span>+23%</span>
                            <span data-zh="è¾ƒä¸Šæœˆ" data-en="vs last month">è¾ƒä¸Šæœˆ</span>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon">âš ï¸</div>
                    <div class="metric-content">
                        <div class="metric-value">132</div>
                        <div class="metric-label" data-zh="å¾…å®¡æ ¸" data-en="Pending Review">å¾…å®¡æ ¸</div>
                        <div class="metric-change negative">
                            <span>+5</span>
                            <span data-zh="éœ€å¤„ç†" data-en="need action">éœ€å¤„ç†</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æœç´¢å’Œæ“ä½œåŒºåŸŸ -->
            <div class="search-section">
                <div class="search-controls">
                    <input type="text" id="user-search" class="form-input" placeholder="æœç´¢ç”¨æˆ·..." data-zh-placeholder="æœç´¢ç”¨æˆ·..." data-en-placeholder="Search users...">
                    <select id="status-filter" class="form-select">
                        <option value="all" data-zh="å…¨éƒ¨çŠ¶æ€" data-en="All Status">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="active" data-zh="æ´»è·ƒ" data-en="Active">æ´»è·ƒ</option>
                        <option value="inactive" data-zh="åœç”¨" data-en="Inactive">åœç”¨</option>
                        <option value="pending" data-zh="å¾…å®¡æ ¸" data-en="Pending">å¾…å®¡æ ¸</option>
                    </select>
                    <select id="type-filter" class="form-select">
                        <option value="all" data-zh="å…¨éƒ¨ç±»å‹" data-en="All Types">å…¨éƒ¨ç±»å‹</option>
                        <option value="residential" data-zh="å±…æ°‘ç”¨æˆ·" data-en="Residential">å±…æ°‘ç”¨æˆ·</option>
                        <option value="commercial" data-zh="å•†ä¸šç”¨æˆ·" data-en="Commercial">å•†ä¸šç”¨æˆ·</option>
                        <option value="industrial" data-zh="å·¥ä¸šç”¨æˆ·" data-en="Industrial">å·¥ä¸šç”¨æˆ·</option>
                    </select>
                </div>
                <div class="search-actions">
                    <button class="btn btn-primary" onclick="showAddUserDialog()">
                        <span>+</span>
                        <span data-zh="æ·»åŠ ç”¨æˆ·" data-en="Add User">æ·»åŠ ç”¨æˆ·</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportUsers()">
                        <span>ğŸ“Š</span>
                        <span data-zh="å¯¼å‡º" data-en="Export">å¯¼å‡º</span>
                    </button>
                </div>
            </div>

            <!-- ç”¨æˆ·åˆ—è¡¨è¡¨æ ¼ -->
            <div class="table-container">
                <div class="table-header">
                    <h3 class="table-title" data-zh="ç”¨æˆ·åˆ—è¡¨" data-en="User List">ç”¨æˆ·åˆ—è¡¨</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" onclick="refreshUsers()">
                            <span>ğŸ”„</span>
                            <span data-zh="åˆ·æ–°" data-en="Refresh">åˆ·æ–°</span>
                        </button>
                    </div>
                </div>

                <table class="table" id="users-table">
                    <thead>
                        <tr>
                            <th data-sortable data-zh="ç”¨æˆ·ä¿¡æ¯" data-en="User Info">ç”¨æˆ·ä¿¡æ¯</th>
                            <th data-sortable data-zh="ç”¨æˆ·ç±»å‹" data-en="Type">ç”¨æˆ·ç±»å‹</th>
                            <th data-sortable data-zh="æ³¨å†Œæ—¶é—´" data-en="Registration">æ³¨å†Œæ—¶é—´</th>
                            <th data-sortable data-zh="çŠ¶æ€" data-en="Status">çŠ¶æ€</th>
                            <th data-sortable data-zh="æˆ¿é—´å·" data-en="Room">æˆ¿é—´å·</th>
                            <th data-sortable data-zh="æœ¬æœˆç”¨é‡" data-en="Monthly Usage">æœ¬æœˆç”¨é‡</th>
                            <th data-zh="æ“ä½œ" data-en="Actions">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <!-- æ•°æ®ç”±JavaScriptç”Ÿæˆ -->
                    </tbody>
                </table>

                <!-- åˆ†é¡µ -->
                <div class="pagination">
                    <button class="btn btn-secondary" id="prev-page" disabled>
                        <span>â€¹</span>
                        <span data-zh="ä¸Šä¸€é¡µ" data-en="Previous">ä¸Šä¸€é¡µ</span>
                    </button>
                    <div class="page-info">
                        <span data-zh="ç¬¬" data-en="Page">ç¬¬</span>
                        <span id="current-page">1</span>
                        <span data-zh="é¡µï¼Œå…±" data-en="of">é¡µï¼Œå…±</span>
                        <span id="total-pages">142</span>
                        <span data-zh="é¡µ" data-en="pages">é¡µ</span>
                    </div>
                    <button class="btn btn-secondary" id="next-page">
                        <span data-zh="ä¸‹ä¸€é¡µ" data-en="Next">ä¸‹ä¸€é¡µ</span>
                        <span>â€º</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/common.js"></script>
    <script>
        // ç”¨æˆ·æ•°æ®
        const usersData = [
            {
                id: '001',
                userId: '140070110346',
                name: 'å¼ æ˜å',
                nameEn: 'Zhang Minghua',
                avatar: 'å¼ ',
                email: 'zhang.minghua@email.com',
                phone: '138****8888',
                type: 'residential',
                status: 'active',
                registrationDate: '2024-01-15',
                monthlyUsage: 382,
                address: 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·',
                checkinStatus: 'checked_in', // checked_in, checked_out, never_checked_in
                roomNumber: 'A-101',
                checkinDate: '2024-01-15'
            },
            {
                id: '002',
                userId: '140070110347',
                name: 'æå°çº¢',
                nameEn: 'Li Xiaohong',
                avatar: 'æ',
                email: 'li.xiaohong@email.com',
                phone: '139****6666',
                type: 'commercial',
                status: 'active',
                registrationDate: '2024-02-20',
                monthlyUsage: 1256,
                address: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºé™†å®¶å˜´é‡‘èåŸ',
                checkinStatus: 'checked_out',
                roomNumber: null,
                checkinDate: null,
                checkoutDate: '2024-11-01'
            },
            {
                id: '003',
                userId: '140070110348',
                name: 'ç‹å»ºå›½',
                nameEn: 'Wang Jianguo',
                avatar: 'ç‹',
                email: 'wang.jianguo@email.com',
                phone: '137****9999',
                type: 'industrial',
                status: 'pending',
                registrationDate: '2024-03-10',
                monthlyUsage: 5430,
                address: 'æ·±åœ³å¸‚å—å±±åŒºç§‘æŠ€å›­åŒ—åŒº',
                checkinStatus: 'never_checked_in',
                roomNumber: null,
                checkinDate: null
            },
            {
                id: '004',
                userId: '140070110349',
                name: 'é™ˆå¿—å¼º',
                nameEn: 'Chen Zhiqiang',
                avatar: 'é™ˆ',
                email: 'chen.zhiqiang@email.com',
                phone: '136****7777',
                type: 'residential',
                status: 'active',
                registrationDate: '2024-01-25',
                monthlyUsage: 198,
                address: 'å¹¿å·å¸‚å¤©æ²³åŒºç æ±Ÿæ–°åŸ',
                checkinStatus: 'checked_in',
                roomNumber: 'B-201',
                checkinDate: '2024-01-25'
            },
            {
                id: '005',
                userId: '140070110350',
                name: 'åˆ˜ç¾ä¸½',
                nameEn: 'Liu Meili',
                avatar: 'åˆ˜',
                email: 'liu.meili@email.com',
                phone: '135****5555',
                type: 'commercial',
                status: 'inactive',
                registrationDate: '2024-02-14',
                monthlyUsage: 0,
                address: 'æ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯',
                checkinStatus: 'never_checked_in',
                roomNumber: null,
                checkinDate: null
            },
            {
                id: '006',
                userId: '140070110351',
                name: 'é»„æ°¸å¼º',
                nameEn: 'Huang Yongqiang',
                avatar: 'é»„',
                email: 'huang.yongqiang@email.com',
                phone: '134****4444',
                type: 'residential',
                status: 'active',
                registrationDate: '2024-03-05',
                monthlyUsage: 678,
                address: 'æˆéƒ½å¸‚é«˜æ–°åŒºå¤©åºœå¤§é“'
            },
            {
                id: '007',
                userId: '140070110352',
                name: 'å‘¨æ™“ç‡•',
                nameEn: 'Zhou Xiaoyan',
                avatar: 'å‘¨',
                email: 'zhou.xiaoyan@email.com',
                phone: '133****3333',
                type: 'residential',
                status: 'pending',
                registrationDate: '2024-03-18',
                monthlyUsage: 123,
                address: 'æ­¦æ±‰å¸‚æ­¦æ˜ŒåŒºå…‰è°·å¤§é“'
            },
            {
                id: '008',
                userId: '140070110353',
                name: 'å´å¤§ä¼Ÿ',
                nameEn: 'Wu Dawei',
                avatar: 'å´',
                email: 'wu.dawei@email.com',
                phone: '132****2222',
                type: 'industrial',
                status: 'active',
                registrationDate: '2024-01-30',
                monthlyUsage: 8512,
                address: 'è¥¿å®‰å¸‚é«˜æ–°åŒºç§‘æŠ€è·¯'
            },
            {
                id: '009',
                userId: '140070110354',
                name: 'éƒ‘å°èŠ³',
                nameEn: 'Zheng Xiaofang',
                avatar: 'éƒ‘',
                email: 'zheng.xiaofang@email.com',
                phone: '131****1111',
                type: 'commercial',
                status: 'active',
                registrationDate: '2024-02-28',
                monthlyUsage: 2289,
                address: 'å—äº¬å¸‚å»ºé‚ºåŒºå¥¥ä½“ä¸­å¿ƒ'
            },
            {
                id: '010',
                userId: '140070110355',
                name: 'å­™å»ºå',
                nameEn: 'Sun Jianhua',
                avatar: 'å­™',
                email: 'sun.jianhua@email.com',
                phone: '130****0000',
                type: 'residential',
                status: 'active',
                registrationDate: '2024-03-12',
                monthlyUsage: 734,
                address: 'é‡åº†å¸‚æ¸åŒ—åŒºé¾™æºªè¡—é“'
            }
        ];

        let currentPage = 1;
        let filteredUsers = [...usersData];

        // æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼
        function renderUsersTable() {
            const tbody = document.getElementById('users-tbody');
            const itemsPerPage = 10;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageUsers = filteredUsers.slice(startIndex, endIndex);

            const typeTexts = {
                zh: {
                    residential: 'å±…æ°‘',
                    commercial: 'å•†ä¸š',
                    industrial: 'å·¥ä¸š'
                },
                en: {
                    residential: 'Residential',
                    commercial: 'Commercial',
                    industrial: 'Industrial'
                }
            };

            const statusTexts = {
                zh: {
                    active: 'æ´»è·ƒ',
                    inactive: 'åœç”¨',
                    pending: 'å¾…å®¡æ ¸'
                },
                en: {
                    active: 'Active',
                    inactive: 'Inactive',
                    pending: 'Pending'
                }
            };

            const actionTexts = {
                zh: {
                    view: 'æŸ¥çœ‹',
                    edit: 'ç¼–è¾‘',
                    delete: 'åˆ é™¤'
                },
                en: {
                    view: 'View',
                    edit: 'Edit',
                    delete: 'Delete'
                }
            };

            tbody.innerHTML = pageUsers.map(user => {
                const displayName = getCurrentLanguage() === 'zh' ? user.name : user.nameEn;
                const userType = typeTexts[getCurrentLanguage()][user.type];
                const userStatus = statusTexts[getCurrentLanguage()][user.status];

                return `
                    <tr>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">${user.avatar}</div>
                                <div>
                                    <div class="user-name">${displayName}</div>
                                    <div class="user-details">
                                        <span>${user.userId}</span> â€¢
                                        <span>${user.email}</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>${userType}</td>
                        <td>${EnergySystem.formatDate(user.registrationDate)}</td>
                        <td>
                            <span class="status status-${user.status}">${userStatus}</span>
                        </td>
                        <td>
                            ${user.roomNumber ? `<span class="room-number">${user.roomNumber}</span>` :
                              `<span class="no-room">${getCurrentLanguage() === 'zh' ? 'æœªåˆ†é…' : 'Not Assigned'}</span>`}
                        </td>
                        <td>${user.monthlyUsage.toLocaleString()} kWh</td>
                        <td>
                            <div class="actions">
                                <button class="btn btn-secondary btn-sm" onclick="viewUser('${user.id}')">
                                    ${actionTexts[getCurrentLanguage()].view}
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="editUser('${user.id}')">
                                    ${actionTexts[getCurrentLanguage()].edit}
                                </button>
                                ${user.checkinStatus === 'checked_in' ?
                                    `<button class="btn btn-warning btn-sm" onclick="checkoutUser('${user.id}')">
                                        ${getCurrentLanguage() === 'zh' ? 'é€€ç§Ÿ' : 'Check-out'}
                                    </button>` :
                                    (user.checkinStatus === 'checked_out' || user.checkinStatus === 'never_checked_in') ?
                                    `<button class="btn btn-success btn-sm" onclick="checkinUser('${user.id}')">
                                        ${getCurrentLanguage() === 'zh' ? 'å…¥é©»' : 'Check-in'}
                                    </button>` : ''
                                }
                                <button class="btn btn-secondary btn-sm" onclick="deleteUser('${user.id}')">
                                    ${actionTexts[getCurrentLanguage()].delete}
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');

            updatePagination();
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination() {
            const totalPages = Math.ceil(filteredUsers.length / 10);
            document.getElementById('current-page').textContent = currentPage;
            document.getElementById('total-pages').textContent = totalPages;

            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
        }

        // æœç´¢å’Œè¿‡æ»¤
        function handleFilter() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const typeFilter = document.getElementById('type-filter').value;

            filteredUsers = usersData.filter(user => {
                const nameMatch = user.name.toLowerCase().includes(searchTerm) ||
                                 user.nameEn.toLowerCase().includes(searchTerm) ||
                                 user.userId.includes(searchTerm) ||
                                 user.email.toLowerCase().includes(searchTerm);

                const statusMatch = statusFilter === 'all' || user.status === statusFilter;
                const typeMatch = typeFilter === 'all' || user.type === typeFilter;

                return nameMatch && statusMatch && typeMatch;
            });

            currentPage = 1;
            renderUsersTable();
        }

        // ç”¨æˆ·æ“ä½œå‡½æ•°
        function viewUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                showNotification(`æŸ¥çœ‹ç”¨æˆ·: ${user.name}`, 'info');
            }
        }

        function editUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                showNotification(`ç¼–è¾‘ç”¨æˆ·: ${user.name}`, 'info');
            }
        }

        function deleteUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                showConfirmDialog(
                    `ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${user.name} å—ï¼Ÿ`,
                    (confirmed) => {
                        if (confirmed) {
                            showNotification(`å·²åˆ é™¤ç”¨æˆ·: ${user.name}`, 'success');
                        }
                    }
                );
            }
        }

        // å…¥é©»åŠŸèƒ½
        function checkinUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                showConfirmDialog(
                    `ç¡®å®šè¦ä¸ºç”¨æˆ· ${user.name} åŠç†å…¥é©»æ‰‹ç»­å—ï¼Ÿ`,
                    (confirmed) => {
                        if (confirmed) {
                            // æ¨¡æ‹Ÿåˆ†é…æˆ¿é—´
                            const availableRooms = ['A-102', 'A-103', 'B-202', 'B-203', 'C-301'];
                            const randomRoom = availableRooms[Math.floor(Math.random() * availableRooms.length)];

                            // æ›´æ–°ç”¨æˆ·çŠ¶æ€
                            user.checkinStatus = 'checked_in';
                            user.roomNumber = randomRoom;
                            user.checkinDate = new Date().toISOString().split('T')[0];
                            user.checkoutDate = null;

                            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
                            renderUsersTable();
                            showNotification(`${user.name} å…¥é©»æˆåŠŸï¼åˆ†é…æˆ¿é—´ï¼š${randomRoom}`, 'success');
                        }
                    }
                );
            }
        }

        // é€€ç§ŸåŠŸèƒ½
        function checkoutUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                showConfirmDialog(
                    `ç¡®å®šè¦ä¸ºç”¨æˆ· ${user.name} åŠç†é€€ç§Ÿæ‰‹ç»­å—ï¼Ÿå½“å‰æˆ¿é—´ï¼š${user.roomNumber}`,
                    (confirmed) => {
                        if (confirmed) {
                            // æ›´æ–°ç”¨æˆ·çŠ¶æ€
                            user.checkinStatus = 'checked_out';
                            user.checkoutDate = new Date().toISOString().split('T')[0];
                            const oldRoom = user.roomNumber;
                            user.roomNumber = null;

                            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
                            renderUsersTable();
                            showNotification(`${user.name} é€€ç§ŸæˆåŠŸï¼å·²é‡Šæ”¾æˆ¿é—´ï¼š${oldRoom}`, 'success');
                        }
                    }
                );
            }
        }

        function showAddUserDialog() {
            showNotification('æ‰“å¼€æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡†', 'info');
        }

        function exportUsers() {
            showNotification('æ­£åœ¨å¯¼å‡ºç”¨æˆ·æ•°æ®...', 'info');
        }

        function refreshUsers() {
            showLoading(document.querySelector('.table-container'));

            setTimeout(() => {
                hideLoading(document.querySelector('.table-container'));
                renderUsersTable();
                showNotification('ç”¨æˆ·æ•°æ®å·²åˆ·æ–°', 'success');
            }, 1000);
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®å½“å‰é¡µé¢å¯¼èˆª
            setActiveNavigation('users.html');

            // åˆå§‹åŒ–è¯­è¨€ç³»ç»Ÿ
            initLanguageSystem();

            // æ¸²æŸ“åˆå§‹è¡¨æ ¼
            renderUsersTable();

            // ç»‘å®šæœç´¢å’Œè¿‡æ»¤äº‹ä»¶
            document.getElementById('user-search').addEventListener('input', EnergySystem.debounce(handleFilter, 300));
            document.getElementById('status-filter').addEventListener('change', handleFilter);
            document.getElementById('type-filter').addEventListener('change', handleFilter);

            // åˆ†é¡µäº‹ä»¶
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderUsersTable();
                }
            });

            document.getElementById('next-page').addEventListener('click', () => {
                const totalPages = Math.ceil(filteredUsers.length / 10);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderUsersTable();
                }
            });

            // å¯ç”¨è¡¨æ ¼æ’åº
            EnergySystem.createTableSort('users-table');

            // ç›‘å¬è¯­è¨€å˜åŒ–
            window.addEventListener('languageChanged', () => {
                renderUsersTable();
            });
        });

        // æ·»åŠ æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            .search-section {
                background: var(--background);
                border: var(--border);
                border-radius: var(--radius);
                padding: var(--space-6);
                margin-bottom: var(--space-8);
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: var(--space-4);
            }

            .search-controls {
                display: flex;
                gap: var(--space-4);
                flex: 1;
            }

            .search-controls .form-input {
                min-width: 300px;
            }

            .search-actions {
                display: flex;
                gap: var(--space-3);
            }

            .actions {
                display: flex;
                gap: var(--space-2);
            }

            /* æˆ¿é—´å·æ ·å¼ */
            .room-number {
                background: #e3f2fd;
                color: #1976d2;
                padding: 4px 8px;
                border-radius: 4px;
                font-weight: 500;
                font-size: 12px;
            }

            .no-room {
                color: #999;
                font-style: italic;
                font-size: 12px;
            }

            .btn-sm {
                padding: var(--space-1) var(--space-2);
                font-size: 12px;
            }

            .user-details {
                font-size: 12px;
                color: var(--text-tertiary);
                margin-top: var(--space-1);
            }

            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: var(--space-4);
                padding: var(--space-6);
                background: var(--surface);
                border-top: var(--border);
            }

            .page-info {
                font-size: 14px;
                color: var(--text-secondary);
            }

            @media (max-width: 768px) {
                .search-section {
                    flex-direction: column;
                    align-items: stretch;
                }

                .search-controls {
                    flex-direction: column;
                }

                .search-controls .form-input {
                    min-width: auto;
                }

                .actions {
                    flex-direction: column;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>