<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-zh="è®¾å¤‡è¯¦æƒ…" data-en="Device Details">è®¾å¤‡è¯¦æƒ…</title>
    <link rel="stylesheet" href="assets/css/common.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <img src="logo.png" alt="Logo" class="nav-logo">
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link" data-zh="ä»ªè¡¨ç›˜" data-en="Dashboard">ä»ªè¡¨ç›˜</a>
                <a href="pricing-templates.html" class="nav-link" data-zh="ç”µä»·æ¨¡ç‰ˆ" data-en="Pricing Templates">ç”µä»·æ¨¡ç‰ˆ</a>
                <a href="space-management.html" class="nav-link" data-zh="ç©ºé—´ç®¡ç†" data-en="Space Management">ç©ºé—´ç®¡ç†</a>
                <a href="device-management.html" class="nav-link active" data-zh="è®¾å¤‡ç®¡ç†" data-en="Device Management">è®¾å¤‡ç®¡ç†</a>
                <a href="user-management.html" class="nav-link" data-zh="ç”¨æˆ·ç®¡ç†" data-en="User Management">ç”¨æˆ·ç®¡ç†</a>
                <a href="bills.html" class="nav-link" data-zh="è´¦å•ç®¡ç†" data-en="Bill Management">è´¦å•ç®¡ç†</a>
            </div>
            <div class="nav-actions">
                <div class="lang-dropdown">
                    <select id="language-select" class="form-select lang-select">
                        <option value="zh" data-zh="ä¸­æ–‡" data-en="Chinese">ä¸­æ–‡</option>
                        <option value="en" data-zh="English" data-en="English">English</option>
                    </select>
                </div>
                <div class="user-menu">
                    <div class="user-avatar">ç®¡</div>
                    <span data-zh="ç®¡ç†å‘˜" data-en="Admin">ç®¡ç†å‘˜</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <div class="content-layout">
            <div class="main-container">
                <!-- è¿”å›æŒ‰é’® -->
                <div class="page-header">
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="goBack()">
                            <span data-zh="â† è¿”å›è®¾å¤‡ç®¡ç†" data-en="â† Back to Device Management">â† è¿”å›è®¾å¤‡ç®¡ç†</span>
                        </button>
                    </div>
                </div>

                <!-- è®¾å¤‡åŸºç¡€ä¿¡æ¯å¡ç‰‡ -->
                <div class="device-info-card">
                    <div class="device-info-header">
                        <h3 data-zh="è®¾å¤‡ä¿¡æ¯" data-en="Device Information">è®¾å¤‡ä¿¡æ¯</h3>
                        <span id="device-status" class="device-status status-online" data-zh="åœ¨çº¿" data-en="Online">åœ¨çº¿</span>
                    </div>
                    <div class="device-info-grid">
                        <div class="info-item">
                            <label data-zh="è®¾å¤‡ID" data-en="Device ID">è®¾å¤‡ID</label>
                            <span id="device-id-display">-</span>
                        </div>
                        <div class="info-item">
                            <label data-zh="è®¾å¤‡åç§°" data-en="Device Name">è®¾å¤‡åç§°</label>
                            <span id="device-name-display">-</span>
                        </div>
                        <div class="info-item">
                            <label data-zh="ä½ç½®" data-en="Position">ä½ç½®</label>
                            <span id="device-position-display">-</span>
                        </div>
                        <div class="info-item">
                            <label data-zh="å€ç‡" data-en="Ratio">å€ç‡</label>
                            <span id="device-ratio-display">-</span>
                        </div>
                        <div class="info-item">
                            <label data-zh="å¤‡æ³¨" data-en="Remarks">å¤‡æ³¨</label>
                            <span id="device-remarks-display">-</span>
                        </div>
                    </div>
                </div>

                <!-- æ—¶é—´é€‰æ‹©å’Œè¯»æ•°è¡¨æ ¼ -->
                <div class="readings-section">
                    <div class="section-header">
                        <div class="header-left">
                            <h3 id="readings-title" data-zh="ç”µè¡¨è¯»æ•°" data-en="Meter Readings">ç”µè¡¨è¯»æ•°</h3>
                            <select id="year-picker" class="form-select">
                                <option value="2023" data-zh="2023å¹´" data-en="2023">2023å¹´</option>
                                <option value="2024" data-zh="2024å¹´" data-en="2024">2024å¹´</option>
                                <option value="2025" data-zh="2025å¹´" data-en="2025" selected>2025å¹´</option>
                                <option value="2026" data-zh="2026å¹´" data-en="2026">2026å¹´</option>
                            </select>
                        </div>
                        <div class="header-right">
                            <button class="btn btn-primary" onclick="exportData()">
                                <span data-zh="å¯¼å‡ºæ•°æ®" data-en="Export Data">å¯¼å‡ºæ•°æ®</span>
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="table" id="readings-table">
                            <thead id="table-head">
                                <!-- è¡¨å¤´ç”±JavaScriptç”Ÿæˆ -->
                            </thead>
                            <tbody id="readings-tbody">
                                <!-- æ•°æ®ç”±JavaScriptç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>

                    <!-- åˆ†é¡µ -->
                    <div class="pagination">
                        <button class="btn btn-secondary" id="prev-page" disabled>
                            <span>â€¹</span>
                            <span data-zh="ä¸Šä¸€é¡µ" data-en="Previous">ä¸Šä¸€é¡µ</span>
                        </button>
                        <div class="page-info">
                            <span data-zh="ç¬¬" data-en="Page">ç¬¬</span>
                            <span id="current-page">1</span>
                            <span data-zh="é¡µï¼Œå…±" data-en="of">é¡µï¼Œå…±</span>
                            <span id="total-pages">1</span>
                            <span data-zh="é¡µ" data-en="pages">é¡µ</span>
                        </div>
                        <button class="btn btn-secondary" id="next-page">
                            <span data-zh="ä¸‹ä¸€é¡µ" data-en="Next">ä¸‹ä¸€é¡µ</span>
                            <span>â€º</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/common.js"></script>
    <script>
        // è·å–å½“å‰è¯­è¨€
        function getDeviceDetailLanguage() {
            return document.getElementById('language-select')?.value || 'zh';
        }

        // å¼ºåˆ¶ç¿»è¯‘æ‰€æœ‰é™æ€æ–‡æœ¬
        function forceTranslateStaticText() {
            const currentLang = getDeviceDetailLanguage();
            console.log('å¼ºåˆ¶ç¿»è¯‘é™æ€æ–‡æœ¬ï¼Œå½“å‰è¯­è¨€:', currentLang);

            // ç¿»è¯‘æ‰€æœ‰å¸¦æœ‰data-zhå’Œdata-enå±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-zh][data-en]').forEach(element => {
                const zhText = element.getAttribute('data-zh');
                const enText = element.getAttribute('data-en');
                if (zhText && enText) {
                    element.textContent = currentLang === 'en' ? enText : zhText;
                }
            });

            console.log('é™æ€æ–‡æœ¬ç¿»è¯‘å®Œæˆ');
        }

        // è®¾å¤‡è¯¦æƒ…æ•°æ®
        let deviceData = null;
        let readingsData = [];
        let currentPage = 1;
        let currentTimeType = 'daily';
        let itemsPerPage = 12; // æŒ‰å°æ—¶æ˜¾ç¤º12å°æ—¶ï¼ŒæŒ‰æœˆæ˜¾ç¤º12ä¸ªæœˆ

        // ä»URLå‚æ•°è·å–è®¾å¤‡ID
        function getDeviceIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿæ¯å°æ—¶è¯»æ•°æ•°æ®
        function generateHourlyData(selectedDate) {
            const readings = [];
            const date = new Date(selectedDate);
            const startOfDay = new Date(date.getFullYear(), date.getMonth(), date.getDate());

            // ç”Ÿæˆ24å°æ—¶çš„æ•°æ®
            for (let hour = 0; hour < 24; hour++) {
                const time = new Date(startOfDay.getTime() + hour * 60 * 60 * 1000);
                const voltage = (220 + Math.random() * 10 - 5).toFixed(1); // 220V Â± 5V
                const current = (Math.random() * 10 + 5).toFixed(2); // 5-15A
                const power = (voltage * current / 1000).toFixed(3); // kW
                const energy = (Math.random() * 2 + 1).toFixed(3); // 1-3 kWh
                const totalEnergy = (hour * 2.5 + Math.random() * 5).toFixed(3); // ç´¯è®¡

                readings.push({
                    time: time.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }),
                    voltage: voltage,
                    current: current,
                    power: power,
                    energy: energy,
                    totalEnergy: totalEnergy
                });
            }
            return readings;
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿæ¯æœˆè¯»æ•°æ•°æ®
        function generateMonthlyData(selectedYear) {
            const readings = [];
            const year = parseInt(selectedYear);

            // å¹´åˆå§‹è¯»æ•°
            let currentReading = 1000 + Math.random() * 100;

            // ç”Ÿæˆ12ä¸ªæœˆçš„æ•°æ®
            for (let month = 0; month < 12; month++) {
                const monthNumber = (month + 1).toString().padStart(2, '0');
                const monthName = `${year}/${monthNumber}`;
                const startReading = currentReading; // å¼€å§‹è¯»æ•° = ä¸Šæœˆç»“æŸè¯»æ•°
                const monthlyUsage = 300 + Math.random() * 200; // æœˆç”¨ç”µé‡ 300-500 kWh
                const endReading = startReading + monthlyUsage; // ç»“æŸè¯»æ•° = å¼€å§‹è¯»æ•° + ç”¨ç”µé‡

                readings.push({
                    month: monthName,
                    startReading: startReading.toFixed(1),
                    endReading: endReading.toFixed(1),
                    usage: monthlyUsage.toFixed(1)
                });

                // ä¸‹ä¸ªæœˆçš„å¼€å§‹è¯»æ•° = æœ¬æœˆçš„ç»“æŸè¯»æ•°
                currentReading = endReading;
            }
            return readings.reverse();
        }

        // æ¸²æŸ“è¡¨å¤´
        function renderTableHeader() {
            const currentLang = getDeviceDetailLanguage();
            const thead = document.getElementById('table-head');
            thead.innerHTML = `
                <tr>
                    <th>${currentLang === 'en' ? 'Month' : 'æœˆä»½'}</th>
                    <th>${currentLang === 'en' ? 'Start Reading (kWh)' : 'å¼€å§‹è¯»æ•° (kWh)'}</th>
                    <th>${currentLang === 'en' ? 'End Reading (kWh)' : 'ç»“æŸè¯»æ•° (kWh)'}</th>
                    <th>${currentLang === 'en' ? 'Usage (kWh)' : 'ç”¨ç”µé‡ (kWh)'}</th>
                    <th>${currentLang === 'en' ? 'Actions' : 'æ“ä½œ'}</th>
                </tr>
            `;
        }

        // æ¸²æŸ“è¯»æ•°è¡¨æ ¼
        function renderReadingsTable() {
            renderTableHeader();

            const tbody = document.getElementById('readings-tbody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageReadings = readingsData.slice(startIndex, endIndex);

            const currentLang = getDeviceDetailLanguage();
            tbody.innerHTML = pageReadings.map((reading, index) => `
                <tr>
                    <td><strong>${reading.month}</strong></td>
                    <td>${reading.startReading}</td>
                    <td>${reading.endReading}</td>
                    <td><strong>${reading.usage}</strong></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="showMonthlyDetail('${reading.month}', ${reading.startReading}, ${reading.endReading}, ${reading.usage})">
                            ${currentLang === 'en' ? 'Details' : 'è¯¦æƒ…'}
                        </button>
                    </td>
                </tr>
            `).join('');

            updatePagination();
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination() {
            const totalPages = Math.ceil(readingsData.length / itemsPerPage);
            document.getElementById('current-page').textContent = currentPage;
            document.getElementById('total-pages').textContent = totalPages;
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
        }

        // è¿”å›è®¾å¤‡ç®¡ç†é¡µé¢
        function goBack() {
            window.location.href = 'device-management.html';
        }

        // åŠ è½½å¹´åº¦æ•°æ®
        function loadYearlyData() {
            const yearPicker = document.getElementById('year-picker');
            const selectedYear = yearPicker.value || new Date().getFullYear().toString();

            readingsData = generateMonthlyData(selectedYear);
            itemsPerPage = 12; // 12ä¸ªæœˆæ¯é¡µ
            renderReadingsTable();
        }

        // å¯¼å‡ºæ•°æ®åŠŸèƒ½
        function exportData() {
            if (!readingsData.length) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }

            // åˆ›å»ºCSVå†…å®¹
            const currentLang = getDeviceDetailLanguage();
            const headers = currentLang === 'en' ?
                ['Month', 'Start Reading (kWh)', 'End Reading (kWh)', 'Usage (kWh)'] :
                ['æœˆä»½', 'å¼€å§‹è¯»æ•°(kWh)', 'ç»“æŸè¯»æ•°(kWh)', 'ç”¨ç”µé‡(kWh)'];
            const csvContent = [
                headers.join(','),
                ...readingsData.map(row => [
                    row.month,
                    row.startReading,
                    row.endReading,
                    row.usage
                ].join(','))
            ].join('\n');

            // æ·»åŠ BOMä»¥æ”¯æŒä¸­æ–‡
            const bom = '\uFEFF';
            const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8' });

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.href = url;

            // è®¾ç½®æ–‡ä»¶å
            const deviceName = deviceData ?
                (currentLang === 'en' ? (deviceData.nameEn || deviceData.name) : deviceData.name) :
                (currentLang === 'en' ? 'Device' : 'è®¾å¤‡');
            const yearPicker = document.getElementById('year-picker');
            const selectedYear = yearPicker.value || new Date().getFullYear().toString();
            link.download = currentLang === 'en' ?
                `${deviceName}_${selectedYear}_Meter_Readings.csv` :
                `${deviceName}_${selectedYear}å¹´ç”µè¡¨åº¦æ•°.csv`;

            // è§¦å‘ä¸‹è½½
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            alert(currentLang === 'en' ? 'Data exported successfully!' : 'æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

        // æ˜¾ç¤ºæœˆåº¦è¯¦æƒ… - å®Œå…¨æŒ‰ç…§bill-detail.htmlå¤åˆ¶
        function showMonthlyDetail(month, startReading, endReading, usage) {
            console.log('æ˜¾ç¤ºæœˆåº¦è¯¦æƒ…:', month);

            const currentLang = getDeviceDetailLanguage();

            // åˆ›å»ºå³ä¾§æŠ½å±‰ - å®Œå…¨æŒ‰ç…§bill-detail.htmlçš„ç»“æ„
            const drawer = document.createElement('div');
            drawer.className = 'right-drawer';
            drawer.innerHTML = `
                <div class="drawer-overlay" onclick="closeMonthlyDetail()"></div>
                <div class="drawer-content">
                    <div class="drawer-header">
                        <h3>${currentLang === 'en' ? `Electricity Usage Details â€” ${month}` : `ç”µé‡è´¹æ˜ç»†â€”â€”${month}`}</h3>
                        <button class="drawer-close" onclick="closeMonthlyDetail()">Ã—</button>
                    </div>
                    <div class="drawer-body">
                        <!-- æ¨¡å— -->
                        <div class="drawer-usage-module">
                            <div class="drawer-module-header">
                                <div class="drawer-header-left">
                                </div>
                                <div class="drawer-header-right">
                                    <button class="drawer-export-btn" onclick="exportDrawerData()">
                                        ğŸ“Š <span>${currentLang === 'en' ? 'Export' : 'å¯¼å‡º'}</span>
                                    </button>
                                </div>
                            </div>

                            <!-- è¡¨æ ¼è§†å›¾ -->
                            <div id="drawer-table-view" class="drawer-usage-view active">
                                <div class="drawer-table-container">
                                    <div class="drawer-daily-table">
                                        <div class="drawer-daily-table-header" id="drawer-table-header">
                                            <span>${currentLang === 'en' ? 'Date' : 'æ—¥æœŸ'}</span>
                                            <span>${currentLang === 'en' ? 'Start Reading' : 'å¼€å§‹è¯»æ•°'}</span>
                                            <span>${currentLang === 'en' ? 'End Reading' : 'ç»“æŸè¯»æ•°'}</span>
                                            <span>${currentLang === 'en' ? 'Usage (kWh)' : 'ç”¨ç”µé‡(kWh)'}</span>
                                            <span></span>
                                        </div>
                                        <div class="drawer-daily-table-body" id="drawer-table-body">
                                            <!-- æ•°æ®å°†ä»ä¸»é¡µé¢å¤åˆ¶ -->
                                        </div>
                                    </div>
                                </div>
                                <!-- æ¯å°æ—¶è¯¦æƒ…é¢æ¿ï¼ˆåœ¨è¡¨æ ¼è§†å›¾ä¸­ï¼Œç”¨äºå³ä¾§æ˜¾ç¤ºï¼‰ -->
                                <div id="drawer-hourly-details-panel" class="drawer-hourly-details-panel" style="display: none;">
                                    <div class="drawer-hourly-header">
                                        <h4 id="drawer-selected-date-title">${currentLang === 'en' ? 'Hourly Details' : 'æ¯å°æ—¶æ˜ç»†'}</h4>
                                        <button class="drawer-hourly-close" onclick="closeDrawerHourlyDetails()">Ã—</button>
                                    </div>
                                    <div class="drawer-hourly-content" id="drawer-hourly-details-content">
                                        <!-- æ¯å°æ—¶æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(drawer);

            // é˜»æ­¢æŠ½å±‰å†…çš„æ»šåŠ¨äº‹ä»¶å†’æ³¡åˆ°ä¸»é¡µé¢
            const drawerContent = drawer.querySelector('.drawer-content');
            if (drawerContent) {
                drawerContent.addEventListener('wheel', function(e) {
                    e.stopPropagation();
                }, { passive: false });

                drawerContent.addEventListener('touchmove', function(e) {
                    e.stopPropagation();
                }, { passive: false });
            }

            // å¤åˆ¶æ•°æ®åˆ°æŠ½å±‰
            copyDataToDrawer(month, usage);

            // æ·»åŠ æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                drawer.classList.add('show');
                // ç¦ç”¨ä¸»é¡µé¢æ»šåŠ¨
                document.body.style.overflow = 'hidden';
            }, 10);
        }

        // å¤åˆ¶æ•°æ®åˆ°æŠ½å±‰ - æŒ‰ç…§bill-detail.htmlå®ç°
        function copyDataToDrawer(month, totalUsage) {
            const drawerTableBody = document.getElementById('drawer-table-body');
            if (!drawerTableBody) {
                console.error('drawer-table-body not found!');
                return;
            }

            // ç”Ÿæˆæœˆåº¦æ•°æ®
            const year = month.split('/')[0];
            const monthNum = parseInt(month.split('/')[1]);
            const daysInMonth = new Date(year, monthNum, 0).getDate();

            drawerTableBody.innerHTML = '';

            for (let day = 1; day <= daysInMonth; day++) {
                const dailyUsage = (totalUsage / daysInMonth).toFixed(1);
                const dailyCost = (dailyUsage * 6.5).toFixed(2);
                const dateStr = `${month}/${day.toString().padStart(2, '0')}`;

                const newRow = document.createElement('div');
                newRow.className = 'drawer-daily-table-row';
                newRow.style.cursor = 'pointer';
                newRow.setAttribute('data-date', dateStr);
                const startReading = Math.floor(Math.random() * 1000) + 5000;
                const endReading = startReading + parseFloat(dailyUsage);

                newRow.innerHTML = `
                    <span class="drawer-daily-date">${dateStr}</span>
                    <span class="drawer-start-reading">${startReading.toFixed(1)}</span>
                    <span class="drawer-end-reading">${endReading.toFixed(1)}</span>
                    <span class="drawer-daily-usage">${dailyUsage}</span>
                    <span class="drawer-expand-icon">â–¶</span>
                `;

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - ç‚¹å‡»æ•´è¡Œè§¦å‘toggle
                newRow.addEventListener('click', function() {
                    console.log('Table row clicked, date:', dateStr);
                    toggleDrawerHourlyDetails(dateStr, dailyUsage, day);
                });

                drawerTableBody.appendChild(newRow);
            }
        }


        // åˆ‡æ¢æ¯å°æ—¶è¯¦æƒ…æ˜¾ç¤º/éšè— - æŒ‰ç…§bills.htmlçš„toggleé€»è¾‘
        function toggleDrawerHourlyDetails(date, dailyUsage, day) {
            console.log('toggleDrawerHourlyDetails called:', date, dailyUsage);

            const clickedRow = document.querySelector(`[data-date="${date}"]`);
            const expandIcon = clickedRow ? clickedRow.querySelector('.drawer-expand-icon') : null;
            const hourlyPanel = document.getElementById('drawer-hourly-details-panel');
            const drawer = document.querySelector('.right-drawer');

            if (!clickedRow || !expandIcon || !hourlyPanel || !drawer) {
                console.error('Required elements not found');
                return;
            }

            // æ£€æŸ¥å½“å‰çŠ¶æ€
            const isExpanded = drawer.classList.contains('expanded') && hourlyPanel.style.display === 'block';

            if (!isExpanded) {
                // å±•å¼€çŠ¶æ€ï¼šæ˜¾ç¤ºè¯¦æƒ…

                // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€å’Œå›¾æ ‡
                document.querySelectorAll('.drawer-daily-table-row').forEach(rowEl => {
                    rowEl.classList.remove('selected');
                    const icon = rowEl.querySelector('.drawer-expand-icon');
                    if (icon) {
                        icon.textContent = 'â–¶';
                    }
                });

                // è®¾ç½®å½“å‰è¡Œä¸ºé€‰ä¸­çŠ¶æ€
                clickedRow.classList.add('selected');
                expandIcon.textContent = 'â–¼';

                // æ‰©å±•æŠ½å±‰
                drawer.classList.add('expanded');

                // æ˜¾ç¤ºæ¯å°æ—¶è¯¦æƒ…é¢æ¿
                hourlyPanel.style.display = 'block';

                // æ›´æ–°è¯¦æƒ…é¢æ¿æ ‡é¢˜
                const title = document.getElementById('drawer-selected-date-title');
                if (title) {
                    const currentLang = getDeviceDetailLanguage();
                    title.textContent = currentLang === 'en' ? `${date} Hourly Details` : `${date} æ¯å°æ—¶æ˜ç»†`;
                }

                // ç”Ÿæˆæ¯å°æ—¶æ•°æ®
                generateHourlyDetailsContent(date, dailyUsage);

            } else {
                // æ”¶èµ·çŠ¶æ€ï¼šéšè—è¯¦æƒ…

                // æ¸…é™¤é€‰ä¸­çŠ¶æ€
                clickedRow.classList.remove('selected');
                expandIcon.textContent = 'â–¶';

                // æ”¶ç¼©æŠ½å±‰
                drawer.classList.remove('expanded');

                // éšè—è¯¦æƒ…é¢æ¿
                hourlyPanel.style.display = 'none';
            }
        }

        // ç”Ÿæˆæ¯å°æ—¶è¯¦æƒ…å†…å®¹
        function generateHourlyDetailsContent(date, dailyUsage) {
            const content = document.getElementById('drawer-hourly-details-content');
            if (!content) {
                console.error('Hourly details content not found');
                return;
            }

            const currentLang = getDeviceDetailLanguage();

            let hourlyHTML = `
                <div class="drawer-hourly-table">
                    <div class="drawer-hourly-table-header">
                        <span>${currentLang === 'en' ? 'Time' : 'æ—¶é—´'}</span>
                        <span>${currentLang === 'en' ? 'Start Reading' : 'å¼€å§‹è¯»æ•°'}</span>
                        <span>${currentLang === 'en' ? 'End Reading' : 'ç»“æŸè¯»æ•°'}</span>
                        <span>${currentLang === 'en' ? 'Usage (kWh)' : 'ç”¨ç”µé‡(kWh)'}</span>
                    </div>
                    <div class="drawer-hourly-table-body">
            `;

            for (let hour = 0; hour < 24; hour++) {
                const hourlyUsage = (parseFloat(dailyUsage) / 24).toFixed(2);
                let rate, period, cost;

                // åˆ†æ—¶ç”µä»·é€»è¾‘
                if ((hour >= 9 && hour < 12) || (hour >= 18 && hour < 22)) {
                    period = currentLang === 'en' ? 'Peak' : 'å³°æ—¶';
                    rate = '8.50';
                    cost = (hourlyUsage * 8.50).toFixed(2);
                } else if ((hour >= 6 && hour < 9) || (hour >= 12 && hour < 18)) {
                    period = currentLang === 'en' ? 'Standard' : 'å¹³æ—¶';
                    rate = '6.20';
                    cost = (hourlyUsage * 6.20).toFixed(2);
                } else {
                    period = currentLang === 'en' ? 'Valley' : 'è°·æ—¶';
                    rate = '3.80';
                    cost = (hourlyUsage * 3.80).toFixed(2);
                }

                const baseReading = 5000 + hour * 10 + Math.random() * 5;
                const hourlyStartReading = baseReading.toFixed(1);
                const hourlyEndReading = (baseReading + parseFloat(hourlyUsage)).toFixed(1);

                hourlyHTML += `
                    <div class="drawer-hourly-table-row">
                        <span>${hour.toString().padStart(2, '0')}:00</span>
                        <span>${hourlyStartReading}</span>
                        <span>${hourlyEndReading}</span>
                        <span>${hourlyUsage}</span>
                    </div>
                `;
            }

            hourlyHTML += `
                    </div>
                </div>
            `;

            content.innerHTML = hourlyHTML;
        }

        // å…³é—­æ¯å°æ—¶è¯¦æƒ… - æŒ‰ç…§bills.htmlçš„æ”¶ç¼©é€»è¾‘
        function closeDrawerHourlyDetails() {
            // æ”¶ç¼©æŠ½å±‰
            const drawer = document.querySelector('.right-drawer');
            drawer.classList.remove('expanded');

            // éšè—è¯¦æƒ…é¢æ¿
            const hourlyPanel = document.getElementById('drawer-hourly-details-panel');
            if (hourlyPanel) {
                hourlyPanel.style.display = 'none';
            }

            // æ¸…é™¤é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.drawer-daily-table-row').forEach(rowEl => {
                rowEl.classList.remove('selected');
            });
        }


        // å¯¼å‡ºæŠ½å±‰æ•°æ®
        function exportDrawerData() {
            console.log('exportDrawerData called');
            alert('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        // å…³é—­æœˆåº¦è¯¦æƒ…
        function closeMonthlyDetail() {
            const drawer = document.querySelector('.right-drawer');
            if (drawer) {
                drawer.classList.add('hide');
                // æ¢å¤ä¸»é¡µé¢æ»šåŠ¨
                document.body.style.overflow = '';
                setTimeout(() => {
                    document.body.removeChild(drawer);
                }, 300);
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            const deviceId = getDeviceIdFromUrl();
            if (!deviceId) {
                alert('è®¾å¤‡IDä¸å­˜åœ¨');
                goBack();
                return;
            }

            // æ¨¡æ‹Ÿè®¾å¤‡æ•°æ®ï¼ˆå®é™…åº”ä»åç«¯è·å–ï¼‰
            deviceData = {
                id: deviceId,
                name: deviceId === 'MTR001' ? '1å·æ¥¼ä¸»ç”µè¡¨' : deviceId === 'MTR002' ? '2å·æ¥¼ä¸»ç”µè¡¨' : deviceId === 'MTR003' ? '3å±‚ä¸œä¾§åˆ†ç”µè¡¨' : `è®¾å¤‡ ${deviceId}`,
                nameEn: deviceId === 'MTR001' ? 'Building 1 Main Meter' : deviceId === 'MTR002' ? 'Building 2 Main Meter' : deviceId === 'MTR003' ? 'Floor 3 East Sub-meter' : `Device ${deviceId}`,
                position: deviceId === 'MTR001' ? 'building-1' : deviceId === 'MTR002' ? 'building-2' : deviceId === 'MTR003' ? 'building-1' : 'building-1',
                ratio: deviceId === 'MTR003' ? '10' : '1',
                remarks: 'ä¸»è¦ç›‘æ§è®¾å¤‡',
                remarksEn: 'Main monitoring device',
                status: deviceId === 'MTR003' ? 'offline' : 'online'
            };

            // å¡«å……è®¾å¤‡ä¿¡æ¯ï¼ˆæ”¯æŒè¯­è¨€åˆ‡æ¢ï¼‰
            const currentLang = getDeviceDetailLanguage();
            document.getElementById('device-id-display').textContent = deviceData.id;
            document.getElementById('device-name-display').textContent = currentLang === 'en' ? (deviceData.nameEn || deviceData.name) : deviceData.name;

            // ä½ç½®ç¿»è¯‘
            const positionMap = currentLang === 'en' ? {
                'building-1': 'Building 1',
                'building-2': 'Building 2',
                'parking': 'Parking',
                'outdoor': 'Outdoor Area'
            } : {
                'building-1': '1å·æ¥¼',
                'building-2': '2å·æ¥¼',
                'parking': 'åœè½¦åœº',
                'outdoor': 'å®¤å¤–åŒºåŸŸ'
            };
            document.getElementById('device-position-display').textContent = positionMap[deviceData.position] || deviceData.position || '-';
            document.getElementById('device-ratio-display').textContent = deviceData.ratio || '1';
            document.getElementById('device-remarks-display').textContent = currentLang === 'en' ? (deviceData.remarksEn || deviceData.remarks) : deviceData.remarks || '-';

            // è®¾ç½®çŠ¶æ€
            const statusElement = document.getElementById('device-status');
            statusElement.textContent = deviceData.status === 'online' ?
                (currentLang === 'en' ? 'Online' : 'åœ¨çº¿') :
                (currentLang === 'en' ? 'Offline' : 'ç¦»çº¿');
            statusElement.className = `device-status ${deviceData.status === 'online' ? 'status-online' : 'status-offline'}`;

            // é¡µé¢æ ‡é¢˜å·²åˆ é™¤

            // åˆå§‹åŒ–å¹´ä»½é€‰æ‹©å™¨
            const currentYear = new Date().getFullYear().toString();
            document.getElementById('year-picker').value = currentYear;

            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            document.getElementById('year-picker').addEventListener('change', loadYearlyData);

            // å¼ºåˆ¶ç¿»è¯‘é™æ€æ–‡æœ¬
            setTimeout(forceTranslateStaticText, 50);

            // æ·»åŠ è¯­è¨€åˆ‡æ¢äº‹ä»¶ç›‘å¬å™¨
            const languageSelect = document.getElementById('language-select');
            if (languageSelect) {
                languageSelect.addEventListener('change', function() {
                    console.log('è¯­è¨€åˆ‡æ¢åˆ°:', this.value);
                    // é‡æ–°ç¿»è¯‘é™æ€æ–‡æœ¬
                    forceTranslateStaticText();
                    // é‡æ–°æ¸²æŸ“è¡¨æ ¼ä»¥åº”ç”¨æ–°è¯­è¨€
                    renderReadingsTable();
                });
            }

            // é»˜è®¤åŠ è½½å½“å‰å¹´ä»½æ•°æ®
            loadYearlyData();

            // åˆ†é¡µäº‹ä»¶
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderReadingsTable();
                }
            });

            document.getElementById('next-page').addEventListener('click', () => {
                const totalPages = Math.ceil(readingsData.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderReadingsTable();
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
    </script>

    <style>
        /* æ ¸å¿ƒå¸ƒå±€æ ·å¼ - ä¸å…¶ä»–é¡µé¢ä¿æŒä¸€è‡´ */
        .content-layout {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--space-12) var(--space-8);
            gap: var(--space-6);
        }

        .main-container {
            flex: 1;
            min-width: 0;
        }

        /* ä¿®å¤å¯¼èˆªæ logoæ ·å¼ */
        .nav-logo {
            height: 32px;
            width: auto;
        }

        /* é¡µé¢ç‰¹å®šæ ·å¼ */
        .page-header {
            margin-bottom: var(--space-8);
        }

        .header-actions {
            margin-bottom: var(--space-4);
        }

        .page-header h2 {
            font-size: 28px;
            font-weight: var(--font-weight-medium);
            margin: 0 0 var(--space-2) 0;
            color: var(--text-primary);
        }

        .page-header p {
            color: var(--text-secondary);
            margin: 0;
            font-size: 16px;
        }

        /* è®¾å¤‡ä¿¡æ¯å¡ç‰‡ */
        .device-info-card {
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .device-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }

        .device-info-header h3 {
            font-size: 20px;
            font-weight: var(--font-weight-medium);
            margin: 0;
            color: var(--text-primary);
        }

        .device-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-5);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .info-item label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .info-item span {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: var(--font-weight-regular);
        }

        /* è¯»æ•°åŒºåŸŸ */
        .readings-section {
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        /* ç¡®ä¿è¡¨æ ¼å®¹å™¨æ ·å¼ä¸å…¶ä»–é¡µé¢ä¸€è‡´ */
        .readings-section .table-container {
            border: none;
            border-radius: 0;
        }

        .section-header {
            padding: var(--space-6);
            border-bottom: var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            flex-wrap: nowrap;
            white-space: nowrap;
        }

        .header-left h3 {
            font-size: 20px;
            font-weight: var(--font-weight-medium);
            margin: 0;
            color: var(--text-primary);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .header-left .form-select {
            min-width: 120px;
            flex-shrink: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .header-right .btn {
            white-space: nowrap;
            flex-shrink: 0;
        }

        .year-display {
            font-size: 16px;
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
            padding: var(--space-2) var(--space-3);
            background: var(--surface);
            border: var(--border);
            border-radius: var(--radius);
            white-space: nowrap;
        }

        /* è®¾å¤‡çŠ¶æ€æ ·å¼ */
        .device-status {
            padding: var(--space-1) var(--space-2);
            border-radius: calc(var(--radius) / 2);
            font-size: 12px;
            font-weight: var(--font-weight-medium);
            display: inline-block;
            min-width: 48px;
            text-align: center;
        }

        .status-online {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .status-offline {
            background: rgba(255, 149, 0, 0.1);
            color: var(--warning);
        }

        /* è¡¨æ ¼æ ·å¼å¢å¼º */
        .table td:first-child {
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }

        .table th:not(:first-child),
        .table td:not(:first-child) {
            font-family: var(--font-primary);
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-6);
            background: var(--surface);
            border-top: var(--border);
        }

        .page-info {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* å³ä¾§æŠ½å±‰æ ·å¼ */
        .right-drawer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .right-drawer.show {
            opacity: 1;
            visibility: visible;
        }

        .right-drawer.hide {
            opacity: 0;
            visibility: hidden;
        }

        .drawer-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .drawer-content {
            position: absolute;
            top: 0;
            right: 0;
            width: 900px;
            max-width: 90vw;
            height: 100%;
            background: var(--background);
            box-shadow: var(--shadow-elevated);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            overscroll-behavior: contain;
        }

        .right-drawer.show .drawer-content {
            transform: translateX(0);
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-6);
            border-bottom: var(--border);
            flex-shrink: 0;
            background: var(--surface);
        }

        .drawer-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: var(--font-weight-medium);
        }

        .drawer-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: var(--space-2);
            line-height: 1;
            transition: all 0.15s ease;
            border-radius: 50%;
        }

        .drawer-close:hover {
            color: var(--text-primary);
            background: var(--divider);
        }

        .drawer-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-6);
        }

        /* Tabå¯¼èˆªæ ·å¼ */
        .drawer-view-tabs {
            display: flex;
            background: var(--surface);
            border-bottom: var(--border);
        }

        .drawer-tab-btn {
            flex: 1;
            padding: var(--space-4) var(--space-6);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 14px;
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 3px solid transparent;
        }

        .drawer-tab-btn:hover {
            color: var(--text-primary);
            background: rgba(0, 0, 0, 0.05);
        }

        .drawer-tab-btn.active {
            color: var(--accent);
            background: var(--background);
            border-bottom-color: var(--accent);
        }

        /* Tabå†…å®¹æ ·å¼ */
        .drawer-usage-view {
            display: none;
        }

        .drawer-usage-view.active {
            display: block;
        }


        /* è¯¦æƒ…å†…å®¹æ ·å¼ */
        .detail-summary {
            background: var(--surface);
            border: var(--border);
            border-radius: var(--radius);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--divider);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item.highlight {
            background: rgba(0, 102, 204, 0.05);
            margin: 0 calc(-1 * var(--space-6));
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius);
        }

        .summary-item label {
            font-weight: var(--font-weight-medium);
            color: var(--text-secondary);
        }

        .summary-item span {
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }

        .time-of-use-section {
            margin-bottom: var(--space-6);
        }

        .time-of-use-section h4 {
            margin: 0 0 var(--space-4) 0;
            font-size: 16px;
            font-weight: var(--font-weight-medium);
        }

        .detail-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .detail-table th {
            background: var(--surface);
            padding: var(--space-3) var(--space-4);
            text-align: left;
            font-weight: var(--font-weight-medium);
            font-size: 14px;
            color: var(--text-secondary);
            border-bottom: var(--border);
        }

        .detail-table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: var(--border);
            font-size: 14px;
        }

        .detail-table tbody tr:hover {
            background: var(--surface);
        }

        .detail-table .total-row {
            background: var(--surface);
            font-weight: var(--font-weight-medium);
        }

        .detail-table .total-row:hover {
            background: var(--surface);
        }

        .time-period {
            padding: var(--space-1) var(--space-2);
            border-radius: calc(var(--radius) / 2);
            font-size: 12px;
            font-weight: var(--font-weight-medium);
            text-align: center;
            display: inline-block;
            min-width: 40px;
        }

        .time-period.peak {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error);
        }

        .time-period.normal {
            background: rgba(255, 149, 0, 0.1);
            color: var(--warning);
        }

        .time-period.valley {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .fee-breakdown {
            background: var(--surface);
            border: var(--border);
            border-radius: var(--radius);
            padding: var(--space-6);
        }

        .fee-breakdown h4 {
            margin: 0 0 var(--space-4) 0;
            font-size: 16px;
            font-weight: var(--font-weight-medium);
        }

        .fee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--divider);
        }

        .fee-item:last-child {
            border-bottom: none;
        }

        .fee-item.total {
            background: rgba(0, 102, 204, 0.05);
            margin: var(--space-3) calc(-1 * var(--space-6)) 0;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius);
            border-bottom: none;
        }

        .fee-item label {
            color: var(--text-secondary);
        }

        .fee-item span {
            color: var(--text-primary);
            font-weight: var(--font-weight-medium);
        }

        /* ä»bills.htmlå¤åˆ¶çš„æ ·å¼ */
        .user-info {
            margin-bottom: var(--space-6);
            padding: var(--space-4);
            background: var(--surface);
            border-radius: var(--radius);
        }

        .user-info h4 {
            margin: 0 0 var(--space-2) 0;
            font-size: 16px;
            font-weight: var(--font-weight-medium);
        }

        .user-info p {
            margin: 0;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .pricing-info {
            margin-bottom: var(--space-8);
        }

        .pricing-info h5 {
            margin: 0 0 var(--space-4) 0;
            font-size: 16px;
            font-weight: var(--font-weight-medium);
        }

        .pricing-rules {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .rule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            border-radius: var(--radius);
            border-left: 4px solid;
        }

        .rule-item.peak {
            background: rgba(220, 53, 69, 0.1);
            border-left-color: var(--error);
        }

        .rule-item.standard {
            background: rgba(0, 102, 204, 0.1);
            border-left-color: var(--accent);
        }

        .rule-item.valley {
            background: rgba(40, 167, 69, 0.1);
            border-left-color: var(--success);
        }

        .rule-time {
            font-weight: var(--font-weight-medium);
            flex: 1;
        }

        .rule-price {
            font-size: 14px;
            color: var(--text-secondary);
            background: var(--background);
            padding: var(--space-1) var(--space-2);
            border-radius: calc(var(--radius) / 2);
        }

        .daily-breakdown h5 {
            margin: 0 0 var(--space-4) 0;
            font-size: 16px;
            font-weight: var(--font-weight-medium);
        }

        .daily-list {
            max-height: 300px;
            overflow-y: auto;
            border: var(--border);
            border-radius: var(--radius);
        }

        .daily-item {
            border-bottom: var(--border);
            background: var(--background);
            transition: all 0.15s ease;
        }

        .daily-item:last-child {
            border-bottom: none;
        }

        .daily-item:hover {
            background: var(--surface);
        }

        .daily-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            cursor: pointer;
        }

        .daily-date {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 1;
        }

        .date-text {
            font-weight: var(--font-weight-medium);
            min-width: 40px;
        }

        .daily-total {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .daily-cost {
            font-family: 'Monaco', 'Courier New', monospace;
            font-weight: var(--font-weight-medium);
            margin-right: var(--space-4);
        }

        .expand-icon {
            font-size: 12px;
            color: var(--text-tertiary);
            transition: transform 0.15s ease;
        }

        .hourly-breakdown {
            background: var(--surface);
            border-top: var(--border);
        }

        .hourly-header {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--divider);
            font-size: 12px;
            font-weight: var(--font-weight-semibold);
            color: var(--text-secondary);
        }

        .hourly-item {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--divider);
            font-size: 13px;
            border-left: 3px solid;
        }

        .hourly-item:last-child {
            border-bottom: none;
        }

        .hourly-item.peak {
            border-left-color: var(--error);
        }

        .hourly-item.standard {
            border-left-color: var(--accent);
        }

        .hourly-item.valley {
            border-left-color: var(--success);
        }

        .period-name {
            font-weight: var(--font-weight-medium);
        }

        .hourly-usage,
        .hourly-rate,
        .hourly-cost {
            font-family: 'Monaco', 'Courier New', monospace;
            text-align: right;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .daily-list::-webkit-scrollbar,
        .drawer-body::-webkit-scrollbar {
            width: 6px;
        }

        .daily-list::-webkit-scrollbar-track,
        .drawer-body::-webkit-scrollbar-track {
            background: var(--surface);
        }

        .daily-list::-webkit-scrollbar-thumb,
        .drawer-body::-webkit-scrollbar-thumb {
            background: var(--divider);
            border-radius: 3px;
        }

        .daily-list::-webkit-scrollbar-thumb:hover,
        .drawer-body::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* æŠ½å±‰è¡¨æ ¼å’Œå†…å®¹æ ·å¼ - ä»bill-detail.htmlå®Œå…¨å¤åˆ¶ */
        .drawer-table-container {
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            padding: var(--space-6);
            box-shadow: var(--shadow);
        }

        .drawer-daily-table {
            border: var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .drawer-daily-table-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1.2fr 30px;
            gap: var(--space-3);
            background: var(--surface);
            padding: var(--space-4);
            font-weight: var(--font-weight-medium);
            font-size: 14px;
            color: var(--text-secondary);
        }

        .drawer-daily-table-body {
            max-height: 550px;
            overflow-y: auto;
        }

        .drawer-daily-table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1.2fr 30px;
            gap: var(--space-3);
            padding: var(--space-4);
            border-bottom: var(--border);
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .drawer-daily-table-row:hover {
            background: var(--surface);
        }

        .drawer-daily-table-row:last-child {
            border-bottom: none;
        }

        .drawer-daily-table-row.selected {
            background: #000000 !important;
            color: white !important;
            transform: scale(1.02);
        }

        .drawer-daily-table-row.selected span {
            color: white !important;
        }

        .drawer-expand-icon {
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.15s ease;
            font-weight: bold;
        }

        .drawer-daily-table-row.selected .drawer-expand-icon {
            color: white !important;
        }


        /* æŠ½å±‰æ‰©å±•åŠŸèƒ½ - æŒ‰ç…§bills.htmlå¤åˆ¶ */
        .right-drawer {
            transition: all 0.3s ease;
        }

        .right-drawer.expanded .drawer-content {
            width: 1150px; /* è¡¨æ ¼600px + è¯¦æƒ…500px + é—´éš™50px */
            max-width: 90vw;
        }

        .right-drawer.expanded .drawer-usage-view.active {
            display: flex;
            gap: var(--space-6);
        }

        .right-drawer.expanded .drawer-table-container {
            flex: 0 0 auto;
            width: 600px; /* å›ºå®šå®½åº¦ï¼Œä¿æŒåŸæ¥å¤§å° */
            height: 100%;
        }

        /* è§†å›¾å±•å¼€æ—¶çš„ç‰¹æ®Šæ ·å¼ - åªå¯¹æ¿€æ´»çš„è§†å›¾åº”ç”¨flexå¸ƒå±€ */
        .right-drawer.expanded #drawer-table-view.active {
            display: flex !important;
            gap: var(--space-6);
        }

        /* æ¯å°æ—¶è¯¦æƒ…é¢æ¿ */
        .drawer-hourly-details-panel {
            flex: 0 0 auto;
            width: 500px; /* å›ºå®šå®½åº¦çš„è¯¦æƒ…é¢æ¿ */
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            height: fit-content;
            align-self: flex-start;
        }

        .drawer-hourly-header {
            padding: var(--space-4) var(--space-6);
            border-bottom: var(--border);
            background: var(--surface);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drawer-hourly-header h4 {
            margin: 0;
            font-size: 16px;
            font-weight: var(--font-weight-medium);
        }

        .drawer-hourly-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.15s ease;
        }

        .drawer-hourly-close:hover {
            background: var(--divider);
            color: var(--text-primary);
        }

        .drawer-hourly-content {
            padding: var(--space-6);
            max-height: calc(100% - 80px);
            overflow-y: auto;
        }

        .drawer-hourly-table {
            border: var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .drawer-hourly-table-header {
            display: grid;
            grid-template-columns: 80px 100px 100px 100px;
            gap: var(--space-2);
            background: var(--surface);
            padding: var(--space-3);
            font-weight: var(--font-weight-medium);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .drawer-hourly-table-row {
            display: grid;
            grid-template-columns: 80px 100px 100px 100px;
            gap: var(--space-2);
            padding: var(--space-3);
            border-bottom: var(--border);
            font-size: 13px;
            align-items: center;
        }

        .drawer-hourly-table-row:last-child {
            border-bottom: none;
        }

        .drawer-hourly-table-row:hover {
            background: var(--surface);
        }

        .drawer-hourly-table-row.peak {
            background: rgba(220, 53, 69, 0.05);
            border-left: 3px solid var(--error);
        }

        .drawer-hourly-table-row.standard {
            background: rgba(0, 102, 204, 0.05);
            border-left: 3px solid var(--accent);
        }

        .drawer-hourly-table-row.valley {
            background: rgba(40, 167, 69, 0.05);
            border-left: 3px solid var(--success);
        }

        .rate-badge {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: var(--font-weight-medium);
            text-align: center;
        }

        .rate-badge.peak {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error);
        }

        .rate-badge.standard {
            background: rgba(0, 102, 204, 0.1);
            color: var(--accent);
        }

        .rate-badge.valley {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        /* æŠ½å±‰æ—¥å†æ ·å¼ */
        .drawer-calendar-container {
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            padding: var(--space-6);
            box-shadow: var(--shadow);
        }

        .drawer-calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }

        .drawer-calendar-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: var(--font-weight-medium);
        }

        .drawer-calendar-toggle {
            display: flex;
            background: var(--surface);
            border-radius: var(--radius);
            padding: var(--space-1);
        }

        .drawer-calendar-toggle-btn {
            padding: var(--space-2) var(--space-4);
            border: none;
            background: transparent;
            border-radius: calc(var(--radius) - 2px);
            font-size: 14px;
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.15s ease;
            color: var(--text-secondary);
        }

        .drawer-calendar-toggle-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .drawer-calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .drawer-weekday {
            text-align: center;
            font-size: 12px;
            font-weight: var(--font-weight-semibold);
            color: var(--text-secondary);
            padding: var(--space-2);
        }

        .drawer-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .drawer-calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            min-height: 50px;
        }

        .drawer-calendar-day:hover {
            background: var(--divider);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .drawer-calendar-legend {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            margin-top: var(--space-4);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-dot.low-usage {
            background: var(--success);
        }

        .legend-dot.medium-usage {
            background: var(--warning);
        }

        .legend-dot.high-usage {
            background: var(--error);
        }

        /* æŠ½å±‰å›¾è¡¨æ ·å¼ */
        .drawer-chart-container {
            background: var(--background);
            border: var(--border);
            border-radius: var(--radius);
            padding: var(--space-6);
            box-shadow: var(--shadow);
        }

        .drawer-export-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--surface);
            border: var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .drawer-export-btn:hover {
            background: var(--divider);
        }

        .drawer-header-left h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .content-layout {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .content-layout {
                padding: var(--space-8) var(--space-4);
            }

            .device-info-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-4);
            }

            .header-left {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-2);
            }

            .header-right {
                align-self: stretch;
                justify-content: flex-start;
            }

            .table {
                font-size: 14px;
            }

            .table th,
            .table td {
                padding: var(--space-3) var(--space-2);
            }

            .page-header h2 {
                font-size: 24px;
            }
        }
    </style>
</body>
</html>