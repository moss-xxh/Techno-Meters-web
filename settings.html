<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-zh="ç³»ç»Ÿè®¾ç½®" data-en="Settings">ç³»ç»Ÿè®¾ç½®</title>
    <link rel="stylesheet" href="assets/css/common.css">
    <link rel="stylesheet" href="assets/css/navbar.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <img src="logo.png" alt="Logo" class="nav-logo">
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link" data-zh="ä»ªè¡¨ç›˜" data-en="Dashboard">ä»ªè¡¨ç›˜</a>
                <a href="device-management.html" class="nav-link" data-zh="è®¾å¤‡ç®¡ç†" data-en="Device Management">è®¾å¤‡ç®¡ç†</a>
                <a href="space-management.html" class="nav-link" data-zh="å»ºç­‘ç®¡ç†" data-en="Building Management">å»ºç­‘ç®¡ç†</a>
                <a href="user-management.html" class="nav-link" data-zh="ç”¨æˆ·ç®¡ç†" data-en="User Management">ç”¨æˆ·ç®¡ç†</a>
                <a href="bills.html" class="nav-link" data-zh="è´¦å•ç®¡ç†" data-en="Bill Management">è´¦å•ç®¡ç†</a>
            </div>
            <div class="nav-actions" style="overflow: visible !important;">
                <div class="lang-dropdown">
                    <select id="language-select" class="form-select lang-select">
                        <option value="zh" data-zh="ä¸­æ–‡" data-en="Chinese">ä¸­æ–‡</option>
                        <option value="en" data-zh="English" data-en="English">English</option>
                    </select>
                </div>
                <div class="user-menu" style="position: relative; overflow: visible !important;">
                    <input type="checkbox" id="user-dropdown-toggle" style="display: none;">
                    <label for="user-dropdown-toggle" style="display: flex; align-items: center; cursor: pointer; gap: 8px;">
                        <div class="user-avatar">ç®¡</div>
                        <span data-zh="ç®¡ç†å‘˜" data-en="Admin">ç®¡ç†å‘˜</span>
                        <span style="font-size: 12px; margin-left: 4px;">â–¼</span>
                    </label>
                    <div class="dropdown-menu" style="position: fixed; top: 64px; right: 20px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); min-width: 120px; display: none; z-index: 9999; padding: 4px 0;">
                        <label for="logout-confirm-toggle" style="display: flex; align-items: center; padding: 12px 16px; color: #dc2626; font-size: 14px; cursor: pointer; gap: 8px;">
                            <span style="font-size: 16px;">ğŸšª</span>
                            <span data-zh="é€€å‡ºç™»å½•" data-en="Logout">é€€å‡ºç™»å½•</span>
                        </label>
                    </div>
                </div>
                <style>
                    #user-dropdown-toggle:checked + label + .dropdown-menu { display: block !important; }
                    #user-dropdown-toggle:checked + label span:last-child { transform: rotate(180deg); }
                    #logout-confirm-toggle:checked + .logout-modal { display: flex !important; }
                </style>
            </div>
        </div>
    </nav>

    <!-- é€€å‡ºç¡®è®¤å¼¹çª— -->
    <input type="checkbox" id="logout-confirm-toggle" style="display: none;">
    <div class="logout-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; z-index: 99999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; padding: 32px; max-width: 420px; width: 90%; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);">
            <div style="text-align: center; font-size: 48px; margin-bottom: 20px;">âš ï¸</div>
            <h3 style="text-align: center; font-size: 20px; font-weight: 600; color: #1f2937; margin: 0 0 12px 0;">ç¡®è®¤é€€å‡º</h3>
            <p style="text-align: center; color: #6b7280; font-size: 16px; margin: 0 0 28px 0;">æ‚¨ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿé€€å‡ºåéœ€è¦é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
            <div style="display: flex; gap: 12px; justify-content: center;">
                <label for="logout-confirm-toggle" style="padding: 12px 24px; background: #f3f4f6; color: #374151; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; min-width: 80px; text-align: center;">å–æ¶ˆ</label>
                <a href="index.html" style="padding: 12px 24px; background: #dc2626; color: white; border-radius: 8px; text-decoration: none; font-size: 14px; font-weight: 500; min-width: 80px; text-align: center;">ç¡®è®¤é€€å‡º</a>
            </div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <div class="content-layout">
            <div class="main-container">
                <!-- é¡µé¢æ ‡é¢˜ -->
                <div class="page-header">
                    <h2 data-zh="ç³»ç»Ÿè®¾ç½®" data-en="System Settings">ç³»ç»Ÿè®¾ç½®</h2>
                    <p data-zh="é…ç½®ç³»ç»Ÿå‚æ•°å’Œè´¦å•ç»“ç®—è§„åˆ™" data-en="Configure system parameters and billing rules">é…ç½®ç³»ç»Ÿå‚æ•°å’Œè´¦å•ç»“ç®—è§„åˆ™</p>
                </div>

                <!-- è®¾ç½®åŒºåŸŸ -->
                <div class="settings-container">
                    <!-- è´¦å•è®¾ç½® -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="è´¦å•è®¾ç½®" data-en="Billing Settings">è´¦å•è®¾ç½®</h3>
                            <p data-zh="é…ç½®è´¦å•ç”Ÿæˆå’Œç»“ç®—è§„åˆ™" data-en="Configure billing generation and settlement rules">é…ç½®è´¦å•ç”Ÿæˆå’Œç»“ç®—è§„åˆ™</p>
                        </div>

                        <div class="settings-form">
                            <div class="form-group">
                                <label for="billing-cycle" data-zh="è´¦å•ç»“ç®—å‘¨æœŸ*" data-en="Billing Cycle*">è´¦å•ç»“ç®—å‘¨æœŸ*</label>
                                <select id="billing-cycle" name="billingCycle" class="form-select">
                                    <option value="monthly" data-zh="æ¯æœˆç»“ç®—" data-en="Monthly">æ¯æœˆç»“ç®—</option>
                                    <option value="quarterly" data-zh="æ¯å­£åº¦ç»“ç®—" data-en="Quarterly">æ¯å­£åº¦ç»“ç®—</option>
                                    <option value="bi-monthly" data-zh="åŒæœˆç»“ç®—" data-en="Bi-monthly">åŒæœˆç»“ç®—</option>
                                </select>
                                <small class="form-hint" data-zh="è®¾ç½®ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆè´¦å•çš„å‘¨æœŸ" data-en="Set the period for automatic bill generation">è®¾ç½®ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆè´¦å•çš„å‘¨æœŸ</small>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="billing-date" data-zh="è´¦å•ç”Ÿæˆæ—¥æœŸ" data-en="Bill Generation Date">è´¦å•ç”Ÿæˆæ—¥æœŸ</label>
                                    <select id="billing-date" name="billingDate" class="form-select">
                                        <option value="1" selected>1å·</option>
                                        <option value="15">15å·</option>
                                        <option value="last-day" data-zh="æœˆæœ«" data-en="Last day">æœˆæœ«</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="due-days" data-zh="ä»˜æ¬¾æœŸé™(å¤©)" data-en="Payment Due(days)">ä»˜æ¬¾æœŸé™(å¤©)</label>
                                    <input type="number" id="due-days" name="dueDays" class="form-input"
                                           value="30" min="1" max="90">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="late-fee-rate" data-zh="æ»çº³é‡‘æ¯”ä¾‹(%)" data-en="Late Fee Rate(%)">æ»çº³é‡‘æ¯”ä¾‹(%)</label>
                                    <input type="number" id="late-fee-rate" name="lateFeeRate" class="form-input"
                                           value="1.5" min="0" max="10" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="grace-period" data-zh="å®½é™æœŸ(å¤©)" data-en="Grace Period(days)">å®½é™æœŸ(å¤©)</label>
                                    <input type="number" id="grace-period" name="gracePeriod" class="form-input"
                                           value="7" min="0" max="30">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç”µè´¹è®¾ç½® -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="ç”µè´¹è®¾ç½®" data-en="Electricity Tariff">ç”µè´¹è®¾ç½®</h3>
                            <p data-zh="é…ç½®ç”µè´¹å•ä»·å’Œè®¡ç®—è§„åˆ™" data-en="Configure electricity rates and calculation rules">é…ç½®ç”µè´¹å•ä»·å’Œè®¡ç®—è§„åˆ™</p>
                        </div>

                        <div class="settings-form">
                            <div class="form-group">
                                <label for="tariff-type" data-zh="ç”µè´¹ç±»å‹" data-en="Tariff Type">ç”µè´¹ç±»å‹</label>
                                <select id="tariff-type" name="tariffType" class="form-select">
                                    <option value="flat" data-zh="å›ºå®šå•ä»·" data-en="Flat Rate">å›ºå®šå•ä»·</option>
                                    <option value="tiered" selected data-zh="é˜¶æ¢¯ç”µä»·" data-en="Tiered Rate">é˜¶æ¢¯ç”µä»·</option>
                                    <option value="time-of-use" data-zh="åˆ†æ—¶ç”µä»·" data-en="Time-of-Use">åˆ†æ—¶ç”µä»·</option>
                                </select>
                            </div>

                            <!-- é˜¶æ¢¯ç”µä»·è®¾ç½® -->
                            <div id="tiered-settings" class="tariff-settings">
                                <h4 data-zh="é˜¶æ¢¯ç”µä»·è®¾ç½®" data-en="Tiered Rate Settings">é˜¶æ¢¯ç”µä»·è®¾ç½®</h4>

                                <div class="tier-setting">
                                    <label data-zh="ç¬¬ä¸€é˜¶æ¢¯ (0-100 kWh)" data-en="Tier 1 (0-100 kWh)">ç¬¬ä¸€é˜¶æ¢¯ (0-100 kWh)</label>
                                    <div class="tier-input">
                                        <input type="number" id="tier1-rate" name="tier1Rate" class="form-input"
                                               value="5.50" min="0" step="0.01">
                                        <span class="unit">â‚¹/kWh</span>
                                    </div>
                                </div>

                                <div class="tier-setting">
                                    <label data-zh="ç¬¬äºŒé˜¶æ¢¯ (101-300 kWh)" data-en="Tier 2 (101-300 kWh)">ç¬¬äºŒé˜¶æ¢¯ (101-300 kWh)</label>
                                    <div class="tier-input">
                                        <input type="number" id="tier2-rate" name="tier2Rate" class="form-input"
                                               value="7.25" min="0" step="0.01">
                                        <span class="unit">â‚¹/kWh</span>
                                    </div>
                                </div>

                                <div class="tier-setting">
                                    <label data-zh="ç¬¬ä¸‰é˜¶æ¢¯ (300+ kWh)" data-en="Tier 3 (300+ kWh)">ç¬¬ä¸‰é˜¶æ¢¯ (300+ kWh)</label>
                                    <div class="tier-input">
                                        <input type="number" id="tier3-rate" name="tier3Rate" class="form-input"
                                               value="9.00" min="0" step="0.01">
                                        <span class="unit">â‚¹/kWh</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fixed-charge" data-zh="å›ºå®šè´¹ç”¨(â‚¹/æœˆ)" data-en="Fixed Charge(â‚¹/month)">å›ºå®šè´¹ç”¨(â‚¹/æœˆ)</label>
                                    <input type="number" id="fixed-charge" name="fixedCharge" class="form-input"
                                           value="150" min="0" step="1">
                                </div>
                                <div class="form-group">
                                    <label for="meter-rent" data-zh="ç”µè¡¨ç§Ÿé‡‘(â‚¹/æœˆ)" data-en="Meter Rent(â‚¹/month)">ç”µè¡¨ç§Ÿé‡‘(â‚¹/æœˆ)</label>
                                    <input type="number" id="meter-rent" name="meterRent" class="form-input"
                                           value="25" min="0" step="1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç¨è´¹è®¾ç½® -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="ç¨è´¹è®¾ç½®" data-en="Tax Settings">ç¨è´¹è®¾ç½®</h3>
                            <p data-zh="é…ç½®å„é¡¹ç¨è´¹å’Œé™„åŠ è´¹" data-en="Configure taxes and additional charges">é…ç½®å„é¡¹ç¨è´¹å’Œé™„åŠ è´¹</p>
                        </div>

                        <div class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="gst-rate" data-zh="GSTç¨ç‡(%)" data-en="GST Rate(%)">GSTç¨ç‡(%)</label>
                                    <input type="number" id="gst-rate" name="gstRate" class="form-input"
                                           value="18" min="0" max="50" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="service-charge" data-zh="æœåŠ¡è´¹(%)" data-en="Service Charge(%)">æœåŠ¡è´¹(%)</label>
                                    <input type="number" id="service-charge" name="serviceCharge" class="form-input"
                                           value="2.5" min="0" max="10" step="0.1">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fuel-surcharge" data-zh="ç‡ƒæ–™é™„åŠ è´¹(%)" data-en="Fuel Surcharge(%)">ç‡ƒæ–™é™„åŠ è´¹(%)</label>
                                    <input type="number" id="fuel-surcharge" name="fuelSurcharge" class="form-input"
                                           value="1.25" min="0" max="5" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="regulatory-charge" data-zh="ç›‘ç®¡è´¹(%)" data-en="Regulatory Charge(%)">ç›‘ç®¡è´¹(%)</label>
                                    <input type="number" id="regulatory-charge" name="regulatoryCharge" class="form-input"
                                           value="0.5" min="0" max="2" step="0.01">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç³»ç»Ÿè®¾ç½® -->
                    <div class="settings-section">
                        <div class="section-header">
                            <h3 data-zh="ç³»ç»Ÿè®¾ç½®" data-en="System Settings">ç³»ç»Ÿè®¾ç½®</h3>
                            <p data-zh="é…ç½®ç³»ç»ŸåŸºæœ¬å‚æ•°" data-en="Configure basic system parameters">é…ç½®ç³»ç»ŸåŸºæœ¬å‚æ•°</p>
                        </div>

                        <div class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="company-name" data-zh="å…¬å¸åç§°" data-en="Company Name">å…¬å¸åç§°</label>
                                    <input type="text" id="company-name" name="companyName" class="form-input"
                                           value="å°åº¦èƒ½æºç®¡ç†æœ‰é™å…¬å¸" placeholder="è¯·è¾“å…¥å…¬å¸åç§°">
                                </div>
                                <div class="form-group">
                                    <label for="contact-phone" data-zh="è”ç³»ç”µè¯" data-en="Contact Phone">è”ç³»ç”µè¯</label>
                                    <input type="tel" id="contact-phone" name="contactPhone" class="form-input"
                                           value="+91 98765 43210" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="company-address" data-zh="å…¬å¸åœ°å€" data-en="Company Address">å…¬å¸åœ°å€</label>
                                <textarea id="company-address" name="companyAddress" class="form-textarea"
                                          rows="2" placeholder="è¯·è¾“å…¥å…¬å¸åœ°å€">Mumbai, Maharashtra, India</textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="currency" data-zh="é»˜è®¤è´§å¸" data-en="Default Currency">é»˜è®¤è´§å¸</label>
                                    <select id="currency" name="currency" class="form-select">
                                        <option value="INR" selected>â‚¹ å°åº¦å¢æ¯” (INR)</option>
                                        <option value="USD">$ ç¾å…ƒ (USD)</option>
                                        <option value="EUR">â‚¬ æ¬§å…ƒ (EUR)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="time-zone" data-zh="æ—¶åŒº" data-en="Time Zone">æ—¶åŒº</label>
                                    <select id="time-zone" name="timeZone" class="form-select">
                                        <option value="Asia/Kolkata" selected>Asia/Kolkata (IST)</option>
                                        <option value="UTC">UTC</option>
                                        <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¿å­˜æŒ‰é’® -->
                    <div class="settings-actions">
                        <button type="button" class="btn btn-secondary" onclick="resetSettings()">
                            <span data-zh="é‡ç½®" data-en="Reset">é‡ç½®</span>
                        </button>
                        <button type="button" class="btn btn-primary" onclick="saveSettings()">
                            <span data-zh="ä¿å­˜è®¾ç½®" data-en="Save Settings">ä¿å­˜è®¾ç½®</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/navbar.js"></script>
    <script src="assets/js/common.js"></script>
    <script>
        // è®¾ç½®æ•°æ®
        const defaultSettings = {
            billing: {
                cycle: 'monthly',
                date: '1',
                dueDays: 30,
                lateFeeRate: 1.5,
                gracePeriod: 7
            },
            tariff: {
                type: 'tiered',
                tier1Rate: 5.50,
                tier2Rate: 7.25,
                tier3Rate: 9.00,
                fixedCharge: 150,
                meterRent: 25
            },
            tax: {
                gstRate: 18,
                serviceCharge: 2.5,
                fuelSurcharge: 1.25,
                regulatoryCharge: 0.5
            },
            system: {
                companyName: 'å°åº¦èƒ½æºç®¡ç†æœ‰é™å…¬å¸',
                contactPhone: '+91 98765 43210',
                companyAddress: 'Mumbai, Maharashtra, India',
                currency: 'INR',
                timeZone: 'Asia/Kolkata'
            }
        };

        function loadSettings() {
            const savedSettings = localStorage.getItem('systemSettings');
            const settings = savedSettings ? JSON.parse(savedSettings) : defaultSettings;

            // åŠ è½½è´¦å•è®¾ç½®
            document.getElementById('billing-cycle').value = settings.billing.cycle;
            document.getElementById('billing-date').value = settings.billing.date;
            document.getElementById('due-days').value = settings.billing.dueDays;
            document.getElementById('late-fee-rate').value = settings.billing.lateFeeRate;
            document.getElementById('grace-period').value = settings.billing.gracePeriod;

            // åŠ è½½ç”µè´¹è®¾ç½®
            document.getElementById('tariff-type').value = settings.tariff.type;
            document.getElementById('tier1-rate').value = settings.tariff.tier1Rate;
            document.getElementById('tier2-rate').value = settings.tariff.tier2Rate;
            document.getElementById('tier3-rate').value = settings.tariff.tier3Rate;
            document.getElementById('fixed-charge').value = settings.tariff.fixedCharge;
            document.getElementById('meter-rent').value = settings.tariff.meterRent;

            // åŠ è½½ç¨è´¹è®¾ç½®
            document.getElementById('gst-rate').value = settings.tax.gstRate;
            document.getElementById('service-charge').value = settings.tax.serviceCharge;
            document.getElementById('fuel-surcharge').value = settings.tax.fuelSurcharge;
            document.getElementById('regulatory-charge').value = settings.tax.regulatoryCharge;

            // åŠ è½½ç³»ç»Ÿè®¾ç½®
            document.getElementById('company-name').value = settings.system.companyName;
            document.getElementById('contact-phone').value = settings.system.contactPhone;
            document.getElementById('company-address').value = settings.system.companyAddress;
            document.getElementById('currency').value = settings.system.currency;
            document.getElementById('time-zone').value = settings.system.timeZone;
        }

        function saveSettings() {
            const settings = {
                billing: {
                    cycle: document.getElementById('billing-cycle').value,
                    date: document.getElementById('billing-date').value,
                    dueDays: parseInt(document.getElementById('due-days').value),
                    lateFeeRate: parseFloat(document.getElementById('late-fee-rate').value),
                    gracePeriod: parseInt(document.getElementById('grace-period').value)
                },
                tariff: {
                    type: document.getElementById('tariff-type').value,
                    tier1Rate: parseFloat(document.getElementById('tier1-rate').value),
                    tier2Rate: parseFloat(document.getElementById('tier2-rate').value),
                    tier3Rate: parseFloat(document.getElementById('tier3-rate').value),
                    fixedCharge: parseInt(document.getElementById('fixed-charge').value),
                    meterRent: parseInt(document.getElementById('meter-rent').value)
                },
                tax: {
                    gstRate: parseFloat(document.getElementById('gst-rate').value),
                    serviceCharge: parseFloat(document.getElementById('service-charge').value),
                    fuelSurcharge: parseFloat(document.getElementById('fuel-surcharge').value),
                    regulatoryCharge: parseFloat(document.getElementById('regulatory-charge').value)
                },
                system: {
                    companyName: document.getElementById('company-name').value.trim(),
                    contactPhone: document.getElementById('contact-phone').value.trim(),
                    companyAddress: document.getElementById('company-address').value.trim(),
                    currency: document.getElementById('currency').value,
                    timeZone: document.getElementById('time-zone').value
                }
            };

            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!settings.system.companyName) {
                alert('è¯·å¡«å†™å…¬å¸åç§°');
                return;
            }

            try {
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('systemSettings', JSON.stringify(settings));

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                if (typeof EnergySystem !== 'undefined') {
                    EnergySystem.showNotification('è®¾ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    alert('è®¾ç½®ä¿å­˜æˆåŠŸï¼');
                }

                console.log('è®¾ç½®å·²ä¿å­˜:', settings);
            } catch (error) {
                console.error('ä¿å­˜è®¾ç½®æ—¶å‡ºé”™:', error);
                alert('ä¿å­˜è®¾ç½®å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function resetSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ')) {
                loadSettingsFromData(defaultSettings);
                if (typeof EnergySystem !== 'undefined') {
                    EnergySystem.showNotification('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'info');
                } else {
                    alert('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼');
                }
            }
        }

        function loadSettingsFromData(settings) {
            // åŠ è½½è´¦å•è®¾ç½®
            document.getElementById('billing-cycle').value = settings.billing.cycle;
            document.getElementById('billing-date').value = settings.billing.date;
            document.getElementById('due-days').value = settings.billing.dueDays;
            document.getElementById('late-fee-rate').value = settings.billing.lateFeeRate;
            document.getElementById('grace-period').value = settings.billing.gracePeriod;

            // åŠ è½½ç”µè´¹è®¾ç½®
            document.getElementById('tariff-type').value = settings.tariff.type;
            document.getElementById('tier1-rate').value = settings.tariff.tier1Rate;
            document.getElementById('tier2-rate').value = settings.tariff.tier2Rate;
            document.getElementById('tier3-rate').value = settings.tariff.tier3Rate;
            document.getElementById('fixed-charge').value = settings.tariff.fixedCharge;
            document.getElementById('meter-rent').value = settings.tariff.meterRent;

            // åŠ è½½ç¨è´¹è®¾ç½®
            document.getElementById('gst-rate').value = settings.tax.gstRate;
            document.getElementById('service-charge').value = settings.tax.serviceCharge;
            document.getElementById('fuel-surcharge').value = settings.tax.fuelSurcharge;
            document.getElementById('regulatory-charge').value = settings.tax.regulatoryCharge;

            // åŠ è½½ç³»ç»Ÿè®¾ç½®
            document.getElementById('company-name').value = settings.system.companyName;
            document.getElementById('contact-phone').value = settings.system.contactPhone;
            document.getElementById('company-address').value = settings.system.companyAddress;
            document.getElementById('currency').value = settings.system.currency;
            document.getElementById('time-zone').value = settings.system.timeZone;
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è®¾ç½®é¡µé¢åŠ è½½å¼€å§‹');

            // æ£€æŸ¥EnergySystemæ˜¯å¦å¯ç”¨
            if (typeof EnergySystem !== 'undefined') {
                console.log('EnergySystemå¯ç”¨');
                EnergySystem.setActiveNavigation('settings.html');
                EnergySystem.initLanguageSystem();
            } else {
                console.log('EnergySystemä¸å¯ç”¨');
            }

            // åŠ è½½è®¾ç½®
            loadSettings();
            console.log('è®¾ç½®é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>

    <script>
        // æ·»åŠ è®¾ç½®é¡µé¢ç‰¹æœ‰æ ·å¼ - ä¸bills.htmlä¿æŒä¸€è‡´
        const style = document.createElement('style');
        style.textContent = `
            /* å¯¼èˆªæ æ ·å¼ - è¦†ç›–common.css */
            .navbar {
                height: 56px !important;
                overflow: hidden !important;
                background: rgba(255, 255, 255, 0.8) !important;
                backdrop-filter: blur(20px) !important;
                border-bottom: var(--border) !important;
                position: sticky !important;
                top: 0 !important;
                z-index: 1000 !important;
            }

            .nav-content {
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
                padding: 12px 20px !important;
                gap: 15px !important;
                height: 100% !important;
                max-width: none !important;
                margin: 0 !important;
            }

            .nav-brand {
                display: flex !important;
                align-items: center !important;
                flex-shrink: 0 !important;
            }

            .nav-menu {
                flex: 1 !important;
                display: flex !important;
                justify-content: center !important;
                gap: 20px !important;
            }

            .nav-actions {
                display: flex !important;
                align-items: center !important;
                gap: 15px !important;
            }

            .nav-logo {
                height: 32px !important;
                max-width: 150px !important;
                object-fit: contain !important;
                transition: all 0.2s ease !important;
            }

            .nav-logo:hover {
                transform: scale(1.02) !important;
            }

            /* å¸ƒå±€ç³»ç»Ÿ */
            .content-layout {
                display: flex;
                max-width: 1600px;
                margin: 0 auto;
                padding: var(--space-12) var(--space-8);
                gap: var(--space-6);
            }

            .main-container {
                flex: 1;
                min-width: 0;
                padding-top: 0;
            }

            /* é¡µé¢æ ‡é¢˜ */
            .page-header {
                margin-bottom: 32px;
                padding-bottom: 20px;
                border-bottom: 2px solid var(--border-color);
            }

            .page-header h2 {
                margin: 0 0 8px 0;
                font-size: 28px;
                font-weight: 700;
                color: var(--text-primary);
            }

            .page-header p {
                margin: 0;
                font-size: 16px;
                color: var(--text-secondary);
                line-height: 1.5;
            }

            /* è®¾ç½®å®¹å™¨ */
            .settings-container {
                display: flex;
                flex-direction: column;
                gap: 32px;
            }

            .settings-section {
                background: var(--background);
                border: var(--border);
                border-radius: var(--radius);
                padding: 32px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }

            .section-header {
                margin-bottom: 24px;
                padding-bottom: 16px;
                border-bottom: 2px solid var(--primary);
            }

            .section-header h3 {
                margin: 0 0 8px 0;
                font-size: 20px;
                font-weight: 600;
                color: var(--primary);
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .section-header h3::before {
                content: '';
                width: 4px;
                height: 20px;
                background: var(--primary);
                border-radius: 2px;
            }

            .section-header p {
                margin: 0;
                font-size: 14px;
                color: var(--text-secondary);
                line-height: 1.5;
            }

            /* è¡¨å•æ ·å¼ */
            .settings-form {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .form-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }

            .form-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .form-group label {
                font-size: 14px;
                font-weight: 500;
                color: var(--text-primary);
                display: flex;
                align-items: center;
                gap: 4px;
            }

            .form-group label[data-zh*="*"]::after,
            .form-group label[data-en*="*"]::after {
                content: '*';
                color: var(--error);
                font-weight: bold;
                margin-left: 2px;
            }

            .form-input,
            .form-select,
            .form-textarea {
                padding: 12px 16px;
                border: 2px solid var(--border-color);
                border-radius: var(--radius);
                background: var(--background);
                color: var(--text-primary);
                font-size: 14px;
                transition: all 0.2s ease;
                outline: none;
                font-family: inherit;
            }

            .form-input:focus,
            .form-select:focus,
            .form-textarea:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
                background: var(--background);
            }

            .form-input:hover,
            .form-select:hover {
                border-color: var(--accent);
            }

            .form-textarea {
                resize: vertical;
                min-height: 80px;
                font-family: inherit;
                line-height: 1.5;
            }

            .form-hint {
                font-size: 12px;
                color: var(--text-secondary);
                margin-top: 4px;
                font-style: italic;
            }

            /* é˜¶æ¢¯ç”µä»·è®¾ç½® */
            .tariff-settings {
                margin-top: 20px;
                padding: 20px;
                background: var(--surface);
                border-radius: var(--radius);
                border: 1px solid var(--border-color);
            }

            .tariff-settings h4 {
                margin: 0 0 16px 0;
                font-size: 16px;
                font-weight: 600;
                color: var(--text-primary);
            }

            .tier-setting {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 16px;
                padding: 12px;
                background: var(--background);
                border-radius: var(--radius);
                border: 1px solid var(--border-color);
            }

            .tier-setting:last-child {
                margin-bottom: 0;
            }

            .tier-setting label {
                font-size: 14px;
                font-weight: 500;
                color: var(--text-primary);
                flex: 1;
            }

            .tier-input {
                display: flex;
                align-items: center;
                gap: 8px;
                min-width: 150px;
            }

            .tier-input .form-input {
                width: 100px;
                margin: 0;
            }

            .tier-input .unit {
                font-size: 14px;
                color: var(--text-secondary);
                font-weight: 500;
            }

            /* æ“ä½œæŒ‰é’® */
            .settings-actions {
                display: flex;
                justify-content: flex-end;
                gap: 16px;
                padding: 24px 32px;
                background: var(--surface);
                border-top: var(--border);
                border-radius: 0 0 var(--radius) var(--radius);
                margin: 32px -32px -32px -32px;
            }

            /* è¯­è¨€ä¸‹æ‹‰åˆ—è¡¨æ ·å¼ */
            .lang-dropdown {
                display: flex;
                align-items: center;
            }

            .lang-select {
                min-width: 100px;
                padding: var(--space-2) var(--space-3);
                border: var(--border);
                border-radius: var(--radius);
                background: var(--background);
                font-size: 14px;
                font-weight: var(--font-weight-medium);
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .lang-select:focus {
                outline: 2px solid var(--accent);
                outline-offset: -2px;
            }

            .lang-select:hover {
                background: var(--surface);
            }

            /* æŒ‰é’®æ ·å¼ - ä¸bills.htmlä¿æŒä¸€è‡´ */
            .btn {
                padding: var(--space-2) var(--space-4);
                border: none;
                border-radius: var(--radius);
                font-family: inherit;
                font-size: 14px;
                font-weight: var(--font-weight-medium);
                cursor: pointer;
                transition: all 0.15s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: var(--space-2);
            }

            .btn-primary {
                background: var(--primary);
                color: white;
            }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: var(--shadow-hover);
            }

            .btn-secondary {
                background: var(--surface);
                color: var(--text-primary);
                border: var(--border);
            }

            .btn-secondary:hover {
                background: var(--divider);
            }

            /* å“åº”å¼è®¾è®¡ */
            @media (max-width: 1200px) {
                .content-layout {
                    flex-direction: column;
                }
            }

            @media (max-width: 768px) {
                .content-layout {
                    padding: var(--space-8) var(--space-4);
                }

                .settings-section {
                    padding: 20px;
                }

                .form-row {
                    grid-template-columns: 1fr;
                    gap: 16px;
                }

                .tier-setting {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 12px;
                }

                .tier-input {
                    justify-content: flex-end;
                }

                .settings-actions {
                    flex-direction: column;
                    margin: 24px -20px -20px -20px;
                    padding: 20px;
                }

                .nav-menu {
                    gap: 10px !important;
                }

                .page-header h2 {
                    font-size: 24px;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>